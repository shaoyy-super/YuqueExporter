+ 称子弹会飞向的位置（瞄准准心出现的位置）为锁定点，锁定点默认为碰撞体的中心。
+ 碰撞体大部分情况下只有一个，_<font style="color:#585A5A;">目前每条鱼只有一个</font>_
+ 锁定判定框原则上应严格匹配模型本身，即点击模型的任何部分都可以使得锁定技能锁定到该模型的锁定点上，并且不遮挡别的鱼
+ 目前的问题首先在于判定范围不合理，目前的单一长方体碰撞盒和模型贴合度较低，玩家很容易对锁定产生误判，需要对碰撞盒进行改进
    - 实践中碍于性能，并不能每个地方都很准确，但至少应该包含<font style="background-color:#fdbe3d;">尾部</font>的部分，在实际体验中，这是因为目前判定框模糊最大的影响是即将游出渔场的鱼无法锁定，导致缺少了“殊死一搏”的体验。此处的尾部指的是离场时，最后离场的部分。平移的鱼则没有尾部这个概念。
+ 另外，玩家可能会觉得没有点到上层的鱼而感到疑惑，需要修改一下锁定优先级
    - 如果有多个模型重叠，则选择<font style="background-color:#fdbe3d;">最上层的模型</font>，也就是看到什么鱼，点到什么鱼，锁定什么鱼。后续调整层级即可，理论上鱼的重要性和层级之间存在强关联。就玩家操作的直觉来说，模型在最上层的鱼是预期目标。

## 多锁定点
视情况添加多碰撞盒和多锁定点

<font style="color:#DF2A3F;background-color:#FBDE28;">必须</font>加锁定点的情况有以下两种：

1，boss为多体boss，例如双“美人鱼”，其每个部分都至少应有一个锁定点

_<font style="color:#585A5A;">目前是有两个碰撞盒但是只有一个锁定点，也就是点姐姐会锁到妹妹身上去，并不支持多锁定点。</font>_

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732074741068-beeb22a9-8ba5-457b-8f53-59eb873920ce.png)

2，boss的体积相当长或者大，游走时无法在一个屏幕内装下整个boss的情况。

+ 长条状需要在模型的长轴上，均匀设置锁定点，使得碰撞盒长度最接近N。

_<font style="color:#585A5A;">（N的大小稍后确定，暂定为30，作为参考，目前幽冥巨鲸的碰撞盒长度为72，宽度为15）</font>_

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732074741139-f628cb79-6343-4ad3-a212-23f788e17f33.png)

+ 巨型不规则的模型，按照骨骼和具体演出状态酌情设置锁定点，由美术决定，但最大的判定框长度不能超过M（暂定为60）
    - 假设有一个巨型boss艾克佐迪亚会出现，那么可以分为左右手左右脚和身子5个判定框。
    - ![](https://cdn.nlark.com/yuque/0/2024/jpeg/50113719/1732275010188-2da9c987-838e-4322-ab38-676b78a1db3b.jpeg)

以下情况<font style="background-color:#FBDE28;">酌情</font>添加多碰撞盒：

鱼的体积较大，并且鱼至少是精英鱼，并且单个碰撞盒难以贴合形状，按照以下规则

+ 如果有尾部，尤其需要包括尾部
+ 需要包括鱼的身体大部分
+ 不需要包括特效部分
+ 不需要包括始终在高速运动的部分，例如飞速旋转的球，高速甩动的尾巴等
+ 有碰撞盒但没有模型的部分在镜头中不能超过该碰撞盒的40%（目测即可）

如下图

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732276039958-f51746ff-ee84-43b8-8b22-fc1d6c8db56e.png)

其余情况不添加多碰撞盒

## 锁定道具
锁定和激光的消耗规则，即使用cd，使用消耗，均保持不变

### 手动切换锁定
+ 当开启了锁定或者激光技能，处于锁定中状态下，玩家点击某个位置，如果该位置检测到碰撞盒，则锁定该碰撞盒。
+ 如果该位置有多条鱼的多个碰撞盒，选择鱼分最大值最高的鱼。
+ 可能在特殊情况下，有一条鱼的多个碰撞盒重叠在一处，此种情况暂不做限制规则，锁定其中任意一个即可。
+ 另外，锁定需要按照激光同样的命中做法，即锁定情况下，只是播放子弹从炮台到目标位置的动画，其必定会命中目标。

### 自动切换锁定
在玩家开启锁定时，锁定的鱼被击杀或者整个碰撞盒出屏幕的状态下，可能会自动重新指定锁定点

1. 当玩家开启锁定或者击杀了鱼时，优先选择全场内鱼分最大值最高的鱼。_<font style="color:#585A5A;"></font>_
    1. 当该鱼有多个碰撞盒，锁定中心距离屏幕中心最近的一个碰撞盒。
2. 当整个碰撞盒出屏幕（渔场）后：
    1. 该鱼即将销毁，不会再进屏幕时，同1，自动切换锁定
    2. 该鱼并未销毁，但屏幕中没有其他碰撞盒，同1，自动切换锁定
    3. 该鱼并未销毁，屏幕中有其他碰撞盒，锁定中心离屏幕中心最近的一个碰撞盒

_<font style="color:#585A5A;"></font>_

_<font style="color:#585A5A;">另一种方案是有多个碰撞盒，点击多个碰撞盒中的任意一个都可以锁鱼，但锁定点只有一个，在鱼的中心位置，需要额外再让美术将一个碰撞盒设为主碰撞盒，或者选择原点距离最小的（position的X²+Y²最小的）碰撞盒</font>_

_<font style="color:#585A5A;">确实也可以选择硬锁屏幕外的点，竞品是允许这种事情发生的。</font>_

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732275466878-e585b4e0-4c29-4079-a72f-99ae5b7f490e.png)



+ 



## 锁定框测试
目前的碰撞盒和鱼的模型贴合程度不高

具体来讲，以下情况均无法锁定最上层的鱼

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732074740450-1d83ad2b-2472-48bd-b312-d589aa445c4f.png)![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732074740700-bb5cb8cb-2452-4da8-bfee-e862fdd86bc8.png)

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732074740581-a4ba5693-8d5d-48d7-b275-5c9b7d01b6cc.png)![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732074740567-df7e490c-9a53-458e-8dd2-a097ab50d5d8.png)

（没有锁定到鲨鱼上）



## 碰撞框
开发一种批量生成碰撞盒的工具

1. 单一碰撞盒生成：根据模型的外接长方体来生成碰撞盒
    1. 缩减率参数：可以选择相比起外接长方体缩减多少，例如缩减率为20,（%），长宽原本是（80，60），最终生成的碰撞盒长宽应该是（64,48），默认为0
    2. 高度参数：生成的碰撞盒应该可以控制高度，默认为30
2. 多碰撞盒生成，考虑将多个碰撞盒分别设置在其骨骼下，具体算法待定（相信前端！），整体来说是一个最优化问题，即如何让碰撞框和模型的非重叠部分最少。
    1. 骨骼层级参数：设置为1则为每个骨骼根节点下有一个碰撞框，类似下图中有5个，设置为n时，则选择最多n层的节点，例如，设置为2则是每个骨骼根节点的子节点下都有一个碰撞框，默认为1
    2. ![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732592095999-384e6b95-817a-483e-91ca-95632a7d636c.png)
    3. 高度参数：同上
    4. 手动模式：非批量的模式下，应当可以手动选择骨骼节点，只在这部分骨骼节点底下生成碰撞盒

## 竞品测试
经测试，竞品（捕鱼大作战）相对比较贴合但没有完全贴合，但是一些高动态的部分（例如狐狸的尾部等等）会被忽略，并且一些很细的地方的可点击部分比看上去大。可能使用了多个boxCollider。

[此处为语雀卡片，点击链接查看](https://www.yuque.com/ttk5k0/manpny/nxl5l7w13qxga2no#oqEOe)

[此处为语雀卡片，点击链接查看](https://www.yuque.com/ttk5k0/manpny/nxl5l7w13qxga2no#Gj4HV)

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732083521444-e377e1b0-136d-433e-abc6-0b9f8ffed7c8.png)

![都点到了底下的鱼](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732083586966-96df78c1-5c51-4436-9ac3-4193d02092bd.png)

 

![这里没有成功点到龙虾上，而是在大鱼上](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732084346293-4d73e5e5-b2ea-44d9-8180-bb93d6167a82.png)

![狐狸的尾巴点了是没用的，但是底下云的判定框要比看上去大很多](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732084469146-baf2fcc6-2813-42bc-ae69-9b663588203b.png)

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732074740989-339191ae-45e6-4df2-9bcb-7608af621049.png)



## 
