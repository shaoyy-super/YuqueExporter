# 多人房间定义
因为现在的AI做的比较假，希望在渔场内加入真人玩家。

预期渔场的档次越高，里面的真人玩家占比就越高。

# 多人房间规则
![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1733714657992-56baedb2-28b4-4d82-b466-238d74e040ee.png)

根据要求进行优化

## 房间创建、匹配、销毁
![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1733727556594-d7b64391-f91f-4cd6-abd6-45887b53371e.png)

1. 每次切换房间时有newroom_rate 概率创建空房间
2. 每次进入空房间时有emptyroom_time区间随机的时间不让其他玩家进

## <font style="color:#8A8F8D;">AI机器人</font>
<font style="color:#8A8F8D;">AI机器人不算真人玩家，且不占房间位置。</font>

<font style="color:#8A8F8D;">如果有真人玩家匹配进房间且坐在AI位置时，会走一遍【AI退出房间→等待玩家→真人玩家】的表现流程。</font>

<font style="color:#8A8F8D;"></font>

<font style="color:#8A8F8D;">*</font><font style="color:#000000;">每过一段时间有概率加入</font>

## 邀请加入
玩家可以通过好友系统，邀请在线的玩家进入当前自己所在的房间。（参见4）

若自己房间满、接受者点接受的时候房间满时有hint提示。具体规则和表现放在好友系统里。

# 多人房间表现预期
## 鱼
需要精英鱼和Boss鱼的出场、移动、受击、死亡都在房间内各个玩家间实时同步。

## 子弹
只需要记录子弹方向并模拟

## 渔场
渔场内座位分为12（左下右下）34（左上右上）。

3和4号玩家在自己视角会被镜像至12号座位，渔场内的鱼等不镜像。

可以接受12号位看Boss在顶部，34看Boss也在顶部。

## 道具
道具需要实时同步。

能看到玩家同时开狂暴/锁定集火Boss/精英，同时开召唤 出四条精英，轮流用冻结等。

### 道具使用提示和表现
需要对其他玩家的使用道具以及特定行为进行提示，在玩家头部新增一块显示状态的文字UI并增强部分表现，用于提醒玩家间比较常见的有交互的地方（抢鱼，留鱼，钱快花完）

1. 狂暴目前有视觉特效上的提示，较为明显，可以不设计额外机制
2. UI文字：
    1. id101 争夺boss：如果有多个玩家锁定了同一条boss数秒（FishUIDefine：lock_start_time）后，则会在玩家头顶（炮顶）显示【开始争夺XXXX（鱼名称）】例如，【开始争夺血红咆哮】，**不会在自己头上显示**，但自己和另一名玩家在争夺同一个boss或者精英时，对方部分会显示该文字，该文字是一个暂时状态，一段时间后消失
    2. id102 留鱼：满足以下条件时玩家头顶会出现一段时间的【全力相搏】的字样，该字样会在玩家对不同目标使用锁定，或者锁定的鱼离场后消失。
        1. 玩家被看到使用了至少2次冰冻
        2. 玩家在1次锁定中没有更改过目标
3. 使用冰冻的玩家会不断往外发出淡淡的冰冻冲击波特效，从视觉上提示是谁使用了冰冻
4. 新增表FishUI

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1734055686965-031d1c69-1ec3-4e30-9e78-ac3cbb6dcb75.png)

按优先级在玩家头顶显示文字，如果优先级相同，则后触发的优先

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732511775482-a1a466dd-ce4b-4def-9212-25878d048009.png) 

## 玩家加入表现
需要对玩家加入有更强表现

1. 有一个特殊的加入中UI，加强实时感，更吸引注意力，用于给VIP用户或者大额用户使用，_目前暂时先做成对所有玩家适用，之后会在VIP表中加入一定字段来限制。_
    1. 玩家开始加入房间（加载前）服务器收到加入消息后，将即将有玩家加入的消息发送给房间内的玩家，此时玩家房间内会浮现一块面板，显示某玩家正在加入中，位置大概如此：

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732511788085-cd7c3900-528d-4447-b56f-5bda6225063c.png)

面板上包括该玩家名称，最高炮倍，当前金币信息和VIP等级（也就是玩家本来就能看到的信息）

    2. ~~同时，语音播报有【新玩家加入房间】~~
    3. 该面板至少显示loadingUI_time秒，N秒后，该玩家加载好时就会消失，也就是仅短暂显示并吸引玩家注意力。如果玩家加载速度极快甚至不到N秒，那么炮台会在UI下面被加载出来，炮台和该加入UI互相独立，加载UI在N秒后消失



## 玩家离场表现
+ 玩家离场时会在显示技能状态的位置显示文字id301和302【玩家离开了，本轮收益±XXXXX】，其是离场和进场时金币之差。（程序字）
+ 该提示会在下一个该位置有人后消失
+ 特别的，当玩家自己新加入一个房间，也可以看到上一个在自己这个位置的人的得失，一段时间后消失，
+ 该结果只能由还留在房间里的人看到，离场的人自身无法看到

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732511812646-794f0517-1feb-4326-91fa-92b02dc992b5.png)

## 捕鱼狂热表现
1. 狂热状态是一个纯外观的表现，用于表现该玩家最近一段时间手气不错，具体算法也和运气有关
2. 如果玩家击杀boss鱼捕捉所用的子弹数较少，则开启狂暴。
    1. 击杀一条鱼的狂热计数=10*击杀boss花费炮的数学期望/玩家实际上所用炮数
    2. 此处玩家所用的炮数为上一次击杀boss后，发射了多少炮（无论是否击中boss，击中哪个boss），此处的数学期望为鱼的击杀概率的倒数，只看原本概率，不计算buff。
    3. 击杀时的狂热计数应>=1,否则不增加。
    4. 狂热计数每分钟减少一定值（fever_leak）
    5. 当玩家的狂热计数大于阈值（fever_limit）时，进入狂热状态，狂热计数减少到该值以下时，取消狂热状态
    6. 当玩家离开某个房间后，狂热计数清零。
    7. **狂热计数由服务器统计，狂热计数在击杀boss或者每分钟更新时和客户端同步**
    8. 需要前端先把狂热计数在某个位置显示出来再让策划去判断。
3. 狂热状态下，玩家的UI边缘会出现特效，鉴于炮身有自己的特效，所以选择特效生成在UI周围，放在 BatteryBase  的prefab里供调用。
4. <font style="color:#000000;">处于狂热状态，并且作为房间里狂热值最高的玩家，会获得一个手气王标识，其是一个icon+一个文字。该状态会在退出房间或者其他人成为手气王后消除。</font>
5. 击杀boss并进入狂热状态时，会有一句特殊的夸赞的语音（e.g. 今天的手气真是太棒了！）
6. ![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732511802387-aa254a50-3860-4f3f-9372-0df74ff545c5.png)

## 氛围感相关UI
[https://www.figma.com/design/zLvQBU2cOzkG4PJUo7Xe4B/%E6%B8%94%E5%9C%BA%E7%8A%B6%E6%80%81%E4%BA%92%E5%8A%A8%E5%92%8C%E6%98%BE%E7%A4%BA?node-id=0-1&t=k78UQM0yQg3KNJWf-1](https://www.figma.com/design/zLvQBU2cOzkG4PJUo7Xe4B/%E6%B8%94%E5%9C%BA%E7%8A%B6%E6%80%81%E4%BA%92%E5%8A%A8%E5%92%8C%E6%98%BE%E7%A4%BA?node-id=0-1&t=k78UQM0yQg3KNJWf-1)

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732501658189-d0a67d79-8ca6-40b6-beea-d4e5a2780db3.png)

# 好友系统
## 规则
目前希望玩家可以邀请特定玩家来到同一个房间内，于是设计好友系统，玩家可以拥有一个好友列表，可以观察到某个好友是否在线，并且邀请在线的好友加入当前房间/申请加入好友的房间。

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1730860207218-0ad683eb-3406-4f43-8ade-fd63053d68b3.png)

1. 玩家可以通过搜索其他玩家的id或者名称，在搜索结果中可以发送好友申请
2. 玩家可以收到其他玩家的好友申请，在通过后，双方会互相出现在对方的好友列表中。
3. 玩家有好友数量上限，任意一方的好友数量到达上限后，无法发送申请或者答应申请成为好友关系。
4. 玩家可以在好友列表中查看好友的在线状态，以及可以主动解除和某个好友的关系，一个人选择解除和对方的好友关系后，两人会互相在对方的好友列表中消失。
5. 当在某个房间中时，可以打开好友列表发送邀请给在线的并且解锁了本渔场的好友，对方答应并且房间仍然有空位时，对方可以加入
6. 当不在某个房间中时，可以向正在已解锁的渔场中的房间游戏的好友发去加入请求，对方答应并且房间仍有空位时，可以加入对方的房间
7. 当不在某个房间中时，可以向不在房间内，但是在线的好友发去一起游戏请求，对方答应后会将两人加入同一个房间中，取两人共同解锁的最高炮倍渔场，如果有多个渔场，取最新更新的渔场。
8. 特别的，金币为0的玩家无法进入任何房间，所以无法邀请或者被邀请。
9. ~~好友推荐~~
10. ~~查看名片~~
11. ~~修改备注~~
12. ~~聊天~~
13. ~~好友上限特权~~



*当某玩家的好友到达上限之后，该玩家继续同意好友申请时，好友申请仍然会消失，并且跳字，其他玩家向该玩家发送好友申请时也会跳字

*当房间位置满时，房间内的玩家发送邀请时会失败并且跳字，其他玩家答应了之前的邀请时也会失败并跳字

*一段时间过后，会自动取消一起游戏的邀请

## 
## 界面设计
### 入口
作为不和游玩直接相关的系统放在主界面左下角，游玩界面的折叠菜单中较为合理

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1730948714676-5da244ce-f10a-4e92-9874-5b2cb9d13618.png)

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1730948803593-fcab63c3-3f83-4789-8b3b-36cbd27c1fa8.png)

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1731038021483-0212b4c2-6bd5-4dbf-af7e-975605a02497.png)

英文会有点拥挤，可能需要安排一下背景适当拓宽

### 好友列表
应为悬浮窗口，做主界面和房间内通用的界面

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1730866212362-18578080-3ead-459f-800c-5a72af0ca942.png)

+ 好友列表是一个滑动列表，好友列表应为通用组件，其和好友申请列表以及搜索结果列表通用，区别在于右边的选项不同以及好友列表中会在左边显示在线和游玩状态。显示玩家是否在线，是否在某个渔场中游玩
    - 在线
    - 离线
    - 在【渔场名称】中捕鱼（【最低炮倍XXXXX】）
    - 在 冠军海域 中捕鱼（最低炮倍100）
+ 好友列表中应优先显示在线的好友
+ 其他状态：当没有任何好友时应在列表顶部显示文字“没有添加任何好友”

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1730865743869-64739c08-eec1-4e26-9ad5-1031eae3bae3.png)

1. 点击添加好友界面跳转到搜索界面（下文），其他状态：该按钮在有好友申请时会有红点+数字（申请人数）
2. 点击邀请按钮发送邀请，按钮样式变化，变为已发送（打勾），在上一条邀请对方未处理前，不可以再发送邀请
3. 未在线的玩家和不可邀请到本渔场（未解锁或者金币不足）的玩家按钮置灰，下方文字变为“离线”和“不可加入渔场”，能否加入当前渔场的判定目前应和主界面能否点进该渔场的判定相同。
4. 点击其他按钮出现其他选项，目前只有删除好友选项
5. 特别的，每次打开界面都认为是一次刷新，一般情况下在不退出界面时不刷新，但如果邀请某玩家，发现其允许加入的状态有所变化，例如其花光了金币不允许加入或者其删掉了好友，此时应该刷新列表。
6. 此外，还允许从多人房间内部的空位置上点击邀请好友，点击后实际上是会打开好友界面。

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732241482958-9fb9e738-84cf-4897-b3e4-2e62435ea1fb.png)

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1732241651535-ef31e8da-006f-41ee-8978-098052890432.png)

### 搜索界面/好友申请列表
显示输入框，搜索结果列表，好友申请列表和自己的id

*界面线框图仅作示意，搜索界面应该和好友列表界面大小一致

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1730881353380-a4a91009-59a1-4e33-aeac-50c269bfd68b.png)

+ 当未搜索时，显示好友申请滑动列表，按照时间从新到旧排序，最顶端应该是最新的申请。显示搜索框和搜索按钮以及自己的uid
+ ![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1730881893590-4b666709-e232-44d5-9455-d1d5106fa5c8.png)
1. 一个文本输入框，可以输入文本
2. 搜索按钮，点击后转到搜索结果状态
3. 确认和否决按钮，点击其中任意一个按钮后，该条申请会消失，点击确认会加好友，点击取消则是忽略请求。
4. 其他状态：如果没有好友申请，则会在列表顶部显示“目前没有好友申请”

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1730881273203-750d808f-52e8-4647-8cdf-9b5817613081.png)

+ 在点击搜索结果后，显示搜索结果，按照玩家id排列（暂定），最上方的玩家id最小
+ 搜索结果需要严格匹配，比如搜索【拉普兰德】不会搜索到名字为【拉普兰德的狗】的玩家，只会搜索到名字为【拉普兰德】这四个字的玩家。匹配名称或者uid的任意一个就行。
+ 其他状态：如果搜索结果为空，则会在列表顶部显示“未搜索到对应玩家”

![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1730882190992-818b1757-3678-430e-84ee-024d911cc135.png)

1. 点击右侧的按钮可以发送申请，不可以在已经有好友申请的情况下重复发送好友申请。

### 接收邀请
+ ![](https://cdn.nlark.com/yuque/0/2024/png/50113719/1730884173264-696bcdb6-cc43-4f23-a455-cc14919d5ab3.png)收到加入邀请的玩家会在屏幕侧边弹出提示，显示邀请人的信息，可以点击答应邀请或者忽略邀请。答应邀请后会加入对方的房间或者新创建的房间。
+ 同时有多条邀请时，旧的邀请向上挪动，新的邀请在底部插入，理论上，该邀请UI数量没有上限。
+ 邀请在一段时间后自动消失，体现在确认按钮周围的光圈特效上，每条申请的时间独立计算。





## 好友大奖提示
侧面弹出小框显示《好友XXXX击杀了XXXX获得了XXXXXX金币》，该功能类似于跑马灯，只不过是加入了好友的部分

+ 当好友击杀了某个boss时，会在侧边弹出额外的提示
+ 该提示可以堆叠，一段时间后消失
+ 可以在设置中关闭该提示

## 配置
默认好友上限

邀请消失时间



