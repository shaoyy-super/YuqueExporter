



# 一、前言


我们的项目主要是基于Git进行多分支开发，然后合并到主干(`develop`)进行版本发布，所以游戏功能是一致的。

现在要并行开发国内、海外版本，并且功能差异较大。比如国内有专属的新功能（周签到、充值活动）、炮台养成系统更复杂，这些差异通过现有的开发流程是难以满足的，因此要找其他管理方式。

## 1、方案调查
根据版本差异化需求，我们结合之前的项目经验以及其他团队的经验，列出了常见的两种解决方案：

### 1）多分支管理方案：
**  
**核心是不同版本拉取独立的分支，专门开发版本特有或差异化的功能，比如：



通用：**develop **没有差异的通用功能开发分支

国内：**cn/develop **国内差异化功能开发分支

海外：**outer/develop **海外差异化功能开发分支

并且通用`develop`分支要定期往各个特有分支合并，最后都基于特有分支`xxx/develop`发布版本

###   
2）多配置管理方案：
****

核心是利用Unity变体(Variant)机制，通过修改不同目录的配置表来满足功能的差异化，比如活动配置差异：



国内活动配置：`config/normal/cn/Activity.xlsm`

海外活动配置：`config/normal/outer/Activity.xlsm`



## 2、方案对比
### 1）多分支管理方案
  
 优点：    
1、分支独立，配置和代码都只关心当前分支的内容，开发的时候不用过多考虑其他分支的兼容性    
2、对应的界面开发也是独立的，减少界面差异的维护成本  
  
缺点：    
1、代码复用性差，不同版本可能只有少量功能差异，但是各自分支又是独立的，重复逻辑可能写多套    
2、通样的问题，配置表维护麻烦，可能相同的修改要在多个分支修改多次    
3、分支合并难以维护，由**通用分支**合并到各个**特有分支**时，以上提到的代码和配置表冲突几乎难以解决    
4、除了代码和配置表之外，还有其他本来可以复用的资产，也会存在制作多次的问题，要么就得提前规划好，哪些是可复用的，哪些是专属的，这里又会增加维护成本  



### 2）多配置管理方案
优点：

1、只有一个主分支，无需维护多个分支，大大减少分支合并冲突问题    
2、通过配置来支持差异化，提高代码和资产的复用性    
3、不同版本配置表独立，只需要维护有差异的表，减少配置工作  



缺点：

1、不支持完全不一样的界面逻辑    
2、不支持界面的细微差异  

## 3、方案选择


基于两种方案优缺点对比，然后根据我们项目的具体需求，最终的多版本管理方案是：**多配置** + **代码多版本**。    
多配置：用来解决大多数的数值差异、功能开关差异    
代码多版本：用来解决界面差异（支持界面完全不一样或者有细微差异）    
这样就可以通过配置和代码控制，来解决两种方案的缺点，尽可能降低维护成本    
  
接下来会简单介绍下多配置管理的技术实现原理  



# 二、变体简介
我们使用的版本管理方案，核心是基于Unity变体进行的。  

变体(`Variant`)是Unity资源管理的一种机制，可以利用它对同一组资源创建多个版本，从而满足很多有差异化的需求，常见的有以下几种情形：

## 1、多语言
 最常见的就是游戏内可以选择文字语言种类，以满足不同地区的玩家  

## 2、多配置
通过配置，支持不同版本的功能开关、数值差异化等

这也是我们实现多配置的核心  

## 3、多资源
国内版或版署审核时，有些图片资源、单位模型可以通过变体做差异化处理

## 4、多音频
游戏内角色语音，可以根据玩家设置来播放中文、英文、日语等

## 5、多界面
 同样的功能，针对不同版本，可以支持完全不一样的界面表现  



除了以上常见的差异化之前，变体可以支持更多的版本特有的内容，后续根据项目需求进一步扩展即可。



# 三、多版本管理


多版本管理是**多配置和代码多版本**结合，根据差异点，大致分为3种类型：  

**配置差异、表现(UI)差异、版本独有，**针对差异，单独去修改配置表和代码，然后合并到`develop`



## 1、配置差异
这种纯粹是数值上的差异，比如国内金币加成值不同、签到奖励不同等，不同版本修改对应数值即可

## 2、表现差异
表现差异大致分两种：**UI结构相同、UI完全不同**

### 1）UI结构相同
这种只需要维护对应界面节点开关即可

### 2）UI完全不同
这种程序做新的界面资源，逻辑代码部分复用

## 3、版本独有
这种直接修改功能开关配置表即可

注：第一种**配置差异**特指只有数值差异，所以这里又细分了**版本独有**的差异类型

# 四、多版本差异化记录


这是后续要维护的版本差异的表，里边包括每个模块有差异的细节以及负责人等，方便后续定位问题，也便于QA测试版本功能



[【多版本】版本差异](https://snh48group.yuque.com/ttk5k0/manpny/deh5q1wy4sekeorq#eLVM)



