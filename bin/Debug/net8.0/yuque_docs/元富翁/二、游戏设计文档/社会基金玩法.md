# 概述
## 文档说明
+ 本文档说明了格子玩法中社会基金玩法的基础规则与玩法流程

## 文档维护
| <font style="color:white;">版本</font> | <font style="color:white;">时间</font> | | <font style="color:white;">负责人</font> | <font style="color:white;">修改内容</font> |
| --- | :---: | --- | :---: | :--- |
| <font style="color:black;">v1.0</font> | <font style="color:black;">2024/6/27</font> | | [@王敏涵](undefined/cookie-ylrqq) | <font style="color:black;">文档创建</font> |
|  | <font style="color:black;">2024/7/23</font> | | [@王敏涵](undefined/cookie-ylrqq) | <font style="color:black;">优化奖励计算</font> |


## 设计思路
+ 每日固定活跃玩法，鼓励玩家每日上线
+ 社交玩法，鼓励玩家多加活跃好友提升自身中奖率

# 玩法包装
 

# 功能说明
> 玩法录屏演示： 
>

[此处为语雀卡片，点击链接查看](https://www.yuque.com/zdlwma/kxyozs/hqw8tu5eiri3cx0v#JZvh0)

## 玩法流程
+ 每天金库里有初始金额，玩家走到社会基金格后，金库中会增加金额；
+ 第二天可以打开金库，根据前一天累计金额和小游戏的游戏结果决定奖励。

![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/26927517/1719572527312-74fe0821-3200-4aaa-a89e-3daa93582190.jpeg)

## 小游戏玩法概述
+ 共有9个玩家格子，玩家每次点击按钮会随机翻开一个玩家的格子
+ 翻开后玩家格子变为钥匙格子，奖励倍率进入下一档
+ 若钥匙格子再被随机到（即同一个玩家的格子被随机到2次），则游戏结束进行结算
+ 【活跃好友礼物】
    - 翻开特殊的活跃好友格子有概率获得主动翻一次的机会/获得道具

## 后端规则
**【功能解锁规则】**

+ 玩家拥有5名好友时解锁开启宝箱小游戏（加一个trigger里的condition）

**【随机玩家规则】**

+ 每次随机9名玩家
    - 优先随机好友 
    - 其次随机本服陌生人

**【活跃好友礼物】**

+ **活跃好友：**若随机出的好友24h内曾对当前玩家发起过交互行为（包含攻击建筑、银行打劫、收取租金），标记为活跃好友
    - 时间从进入开宝箱小游戏时开始算
+ 翻开活跃好友的格子时，会获得额外礼包，礼包类型包含：
    - 主动翻一次
    - 奖励道具（贴纸等）

**【小游戏玩法规则】**

+ 根据当前已经翻开的玩家格子数（钥匙）count（1-8），随机当次点击是否导致游戏结束
    - 配置当次点击的导致游戏结束的概率p，即当次点击随机到钥匙图案的概率

**【奖励规则】**

+ <font style="background-color:#E8F7CF;">记录玩家走到社会基金格子上的次数，奖池金额=根据当前城市等级计算出的金库初始金额 + 走到次数 x 计算得出的该玩法基础奖励值</font>
    - 从上一次完成开宝箱小游戏时开始记，完成开宝箱小游戏后清除次数
    - <font style="background-color:#E8F7CF;">若玩家在当天进行城市升级，单次累计的钱按走到社会基金格时的城市等级系数算；金库初始金额按打开金库时的城市等级系数算</font>
+ 玩家实际获得金额= 游戏结果的倍率（x2；x3；x5；...；x50） x 奖池金额
+ 若玩家拿到最终大奖，有额外道具奖励

**【战报】**

+ 小游戏结束时，给被翻开过的好友发送对应战报：{0}已在您的帮助下打开社会基金
+ 并且给对应玩家发送骰子次数奖励<font style="background-color:#FBDE28;">——待后续邮件系统</font>

**断线重连处理：**

+ 玩家在小游戏过程中断线，重连后重新开始小游戏

## 前端显示
**【翻格子流程】**

+ 玩家每次点击【开始】按钮，【开始】按钮切换为禁用态
+ 前端进行动画模拟选择一个玩家头像格子翻开（表现上切换格子的速度渐慢，直到最后一个格子突出显示）
+ 玩家头像格子被翻开后变成钥匙图案，播动画，奖励倍率条显示为下一档
+ 整个动画表现过程结束后，【开始】按钮切换为可交互态

**【活跃好友礼物】**

+ 活跃好友的头像旁显示礼包
+ 若翻开活跃好友的头像格子，播开礼包动画，根据礼包内容
    - 主动翻一次：所有未翻开的头像格子高亮提示可选择，玩家点击对应格子可以翻开格子
    - 道具等：展示通用物品获得弹窗，收取后回到小游戏

**【小游戏结算】**

+ 若翻开钥匙图案的格子，播钥匙开宝箱动画表现，进入结算界面
    - 若玩家拿到最终大奖，先播获得额外道具的表现，再播获得金钱的结算
+ 收取对应奖励后回到棋盘主界面

# 界面
## 小游戏界面
![](https://cdn.nlark.com/yuque/0/2024/png/26927517/1719569821910-ccd6d0af-a50a-4076-879b-e76b7a928180.png)

## 获得活跃好友礼物界面
![](https://cdn.nlark.com/yuque/0/2024/png/26927517/1719564247926-46faaa57-98e6-4cb3-80ec-97f86d90a6bf.png)

## 小游戏结算界面
![](https://cdn.nlark.com/yuque/0/2024/png/26927517/1719564256805-1c01e18c-41ae-4917-a224-d3fa121d2b06.png)

# 配置表
[Fund.xlsm](https://snh48group.yuque.com/attachments/yuque/0/2024/xlsm/26927517/1719571251718-46535bdf-3c59-4e64-8ff0-414c8646bddd.xlsm)

# 功能需求清单
| 编号 | 任务人员 | 优先级 | 需求描述 | 自检 | 确认 | 备注 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 |  | 1 |  | | | |
| 2 |  | 1 |  | | | |
| 3 |  | 1 |  | | | |
| 4 |  |  |  | | | |
| 5 | |  |  | | | |


# 美术需求
