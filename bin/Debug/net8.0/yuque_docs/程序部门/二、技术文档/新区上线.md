### 创建新区
+ 在目录服上，添加新服的pillar文件

# 备份pillar文件cp jz.sls  jz.sls.bak# 添加新服配置到zones下vim jz.sls61: 

      name: "激战61区"

      ip: 115.159.115.131

      host: "dm-1"

      id: "04"

    62:

      name: "激战62区"

      ip: 115.159.22.96

      host: "dm-2"

      id: "04"

    63:

      name: "激战63区"

      ip: 122.152.221.191

      host: "dm-3"

      id: "04"

+ 刷新pillar

salt '*' saltutil.refresh_pillar

+ 查看pillar

salt 'dm-*' pillar.items

+ 检查pillar

# 执行脚本，文件详见附件bash check_pillar.sh jz.sls     如无输出，表示文件无误

+ 创建游戏区服

# 确保pillar已经刷新到minion节点上，否则，会将线上区服删档salt 'dm-*' state.apply game.create pillar='{"zone": "*"}'# 安装游戏版本salt 'dm-*' state.apply game.install pillar='{"zone": "*", "version": "3.4.123.85323", "env": "all"}' # 开启备份定时任务salt 'dm-*' state.apply game.start-backupdb pillar='{"zone": "*"}' 

+ 还原pillar文件

# 将新的区服添加到zones_wait下，并刷新pillarsalt '*' saltutil.refresh_pillar

+ 修改server_list

# 添加新的区服信息到server_list.jsonvim server_list-white.json{

            "id": 199,

            "name": "数码199区",

            "state": 5,

            "urls_login": [

                "host-12.smbl.zs-e.com:10020"

            ],

            "urls_game": [

                "host-12.smbl.zs-e.com:9020",

                "host-12.smbl.zs-e.com:9021",

                "host-12.smbl.zs-e.com:9022",

                "host-12.smbl.zs-e.com:9023"

            ]

        },

[check_pillar.sh](https://tcs.teambition.net/storage/101r87dd5d9f2d93bde1131967f85ee37811?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTcxMzc3OTc1OSwiaWF0IjoxNzEzMTc0OTU5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzEwMXI4N2RkNWQ5ZjJkOTNiZGUxMTMxOTY3Zjg1ZWUzNzgxMSJ9.OPm3Ajv6twh4oSu0xJaaVALQJDdg65hiMzvEgMq7F5o&download=check_pillar.sh)

