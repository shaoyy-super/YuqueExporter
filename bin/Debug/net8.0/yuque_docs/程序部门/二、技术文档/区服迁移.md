# 迁移准备
生成两个 game.sls （被迁移的game.sls 和 迁移后的game.sls）

生成迁移后的 server_list.json

# 迁移操作
## 替换 被迁移的game.sls
## 关闭所有区服并备份数据库
salt '*' state.apply game.stop pillar='{"zone": "*"}'salt '*' state.apply game.backupdb pillar='{"zone": "*"}'

## 删除废弃服务器
salt-key -d game-2

## 根据 被迁移的game.sls 创建区服
[thoughts 文档](https://thoughts.teambition.com/workspaces/5dfb64dfdd03ff001360619e/docs/63b7e3fcb587e600018b587a)

## 修改区服下的 config/monitrc.tmp 和 start.sh，根据进程数修改 gate、scene
## 云数据库
### 修改区服数据库中的 t_serverlist 表
# PORT 和 EXTPORT 改为对应端口update t_serverlist set PORT=10031,EXTPORT=10031  where id=1;

update t_serverlist set PORT=10032,EXTPORT=10032  where id=11;

update t_serverlist set PORT=10033,EXTPORT=10033  where id=20;

update t_serverlist set PORT=10034,EXTPORT=10034  where id=2101;

update t_serverlist set PORT=10035,EXTPORT=10035  where id=2102;

update t_serverlist set PORT=9030,EXTPORT=9030  where id=2201;

update t_serverlist set PORT=9031,EXTPORT=9031  where id=2202;

## 本地数据库
### 备份 t_serverlist 和 version
mysqldump -h127.0.0.1 -uroot -pDm2018Pwd123 game_1015 t_serverlist > game_1015_t_serverlist.sqlmysqldump -h127.0.0.1 -uroot -pDm2018Pwd123 game_1015 version > game_1015_version.sql

### 导入数据库
mysql -uroot -pDm2018Pwd123 -h 127.0.0.1 game_1015 < game.sql

### 导入 t_serverlist 和 version
mysql -uroot -pDm2018Pwd123 -h 127.0.0.1 game_1015 < game_1015_t_serverlist.sqlmysql -uroot -pDm2018Pwd123 -h 127.0.0.1 game_1015 < game_1015_version.sql

## 替换成迁移后的 game.sls 和 server_list.json
