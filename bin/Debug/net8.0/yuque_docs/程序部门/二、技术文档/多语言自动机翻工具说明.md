# 多语言自动机翻工具说明
## 1. 背景
多语言翻译中，有些翻译后内容无法及时给到，如果需要快速确认字体UI适配，制作自动进行机翻的工具以便使用，可以直接翻译游戏内语言，目前仅支持简体中文翻译英语。

## 2. 使用方式
### 2.1 .NET安装(安装过的忽略)
机翻软件的运行依赖于.NET SDK 6.0.404, 所以需要先安装对应环境. 拷贝.NET SDK 文件到本地，文件路径：\\192.168.0.231\AI及Web3游戏研发中心\公共资源\04_软件\办公软件\机翻工具![](https://cdn.nlark.com/yuque/0/2024/png/43288772/1712912087743-4c52a6f9-9cab-4336-940a-c55778ce9d23.png)

直接安装

![](https://cdn.nlark.com/yuque/0/2024/png/43256857/1712910883145-325853d8-ddf6-4edd-bb71-d2b3b85c192c.png)

### 2.2 使用
RSTools -> 程序工具 -> 自动机翻英文 -> 勾选自动机翻英文

<font style="color:#DF2A3F;">需要在游戏运行时勾选, 没有本地缓存所以每次重新启动时会取消</font>, 勾选自动机翻英文以后，<font style="color:#DF2A3F;">刷新UI界面后</font>会自动翻译所有经过多语言模块的内容(不包括一些代码内写死的文本、美术字效果等)，所以后续界面出现的中文字体可能是有问题，需要特别注意，恢复原有多语言功能直接取消勾选即可。

![](https://cdn.nlark.com/yuque/0/2024/png/43288772/1713168605259-46170881-0d85-40bb-87f6-add73c9a0f29.png)

## 3. 实现原理
使用的第三方翻译dll库是金山快译的翻译库，因为金山快译的第三方dll库是32位的，c#中现有的64位工程无法直接调用，因此创建了一个32位的工程调用金山快译的dll库，编译成了exe ，在游戏中直接启动这个32位的进程，进行翻译交互。

### 3.1 翻译工程
翻译工程主要做的是接收从控制台输入的待翻译的字符，调用金山快译动态库提供的接口，进行翻译，将翻译后的字符写入到控制台上，完成翻译了流程，主要代码：

**调用动态库接口**

![](https://cdn.nlark.com/yuque/0/2024/png/43288772/1713169138621-eba2e8f3-4161-48ad-8048-25201b3b98a1.png)

主函数调用翻译

![](https://cdn.nlark.com/yuque/0/2024/png/43288772/1713169156305-34642a8e-0c4f-4c4a-a101-2e515a3cfbc6.png)

### 3.2 游戏工程调用翻译exe 
游戏工程调用翻译exe主要用到Process类，后台通过cmd启动翻译的exe进程，并重定向该进程的标准输入输出和标准错误输出，并设置在后台启动不显示程序窗口。启动翻译的参数实例: D:/box/box/client/Assets/Scripts/Business/Language/Editor/TranslateTool/AutoTranslateTool.exe D:/box/box/client/Assets/Scripts/Business/Language/Editor/TranslateTool

![](https://cdn.nlark.com/yuque/0/2024/png/43288772/1713169247686-94cd500f-b2fe-44ce-8051-d72d311a6beb.png)

实例代码: client\Assets\Scripts\Business\Language\TranslateTool.cs

![](https://cdn.nlark.com/yuque/0/2024/png/43288772/1713168763394-e60a6d1d-06f4-4166-b8ed-e6dd1e02c9a5.png)

<font style="color:#DF2A3F;">(PS. 此处的工具路径和参数需要是绝对路径, 且需要根据项目适当修改, 项目目录发生变化时可能也需要修改)</font>

翻译文本时候通过重定向的标准输入将待翻译的中文输入到控制台上，并输入回车，进行翻译，再通过重定向的输出可以获取到翻译后的文本。

![](https://cdn.nlark.com/yuque/0/2024/png/43288772/1713168779866-2eaaa1cc-d311-4782-8d85-c47eca97a13f.png)

但是在实际测试过程中发现问题，我们有时候需要翻译的字符串中含有大量的特殊字符，包括一些特殊的标签 <color=#4af6ff> </color> 还有一些换行符制表符，这些特殊字符有些经过翻译会导致标签被修改不能正确显示，还有些换行符和制表符直接会中断翻译，因此在翻译前先对字符进行了预处理。使用正则表达式对待翻译文本进行分割，依次只翻译含有中文部分，最后再将翻译后的文本和标签拼接成完整字符。实例代码：client\Assets\Scripts\Business\Language\TranslateTool.cs:26

![](https://cdn.nlark.com/yuque/0/2024/png/43288772/1713168906480-835a0819-cfe7-4277-b080-4db3fec8171f.png)

