# 一.简介
+ 玩家在游戏大厅内创建自己的房间或加入他人的房间后将进入等待室界面
+ 通过创建房间进入的将自动成为房主，通过其余方式进入房间的为普通玩家
+ 当房间内有旁观者时，游戏开始后旁观者将以旁观视角进入游戏内进行观战

等待室主界面示意图如下

![](https://cdn.nlark.com/yuque/0/2024/png/44314719/1728555316217-1d80967f-85f4-48b3-a9ec-0dc6fcf55694.png)

点击界面右侧的邀请玩家按钮将显示如下图所示的邀请玩家弹窗

![](https://cdn.nlark.com/yuque/0/2024/png/44314719/1728555363586-b6d34812-a4cc-429f-8291-58a550176298.png)

当玩家是房主身份时，歌曲名称右侧将显示设置按钮，玩家可以点击该按钮打开游戏设置界面

![](https://cdn.nlark.com/yuque/0/2024/png/44314719/1728555403115-9edcd9f0-bd91-407b-933c-533d4bfe09f6.png)

房间内寻路移动光标为3D立体效果，显示在地面上方

![](https://cdn.nlark.com/yuque/0/2024/png/44314719/1728555641893-317550a7-367d-452a-9d63-da3a0f86fbee.png)

点击游戏设置按钮后将显示如下图所示的设置界面，与其他界面的打歌设置界面一致

![](https://cdn.nlark.com/yuque/0/2024/png/44314719/1728555740867-6bed7f5f-3e11-48de-a71a-5e046c9be89f.png)

界面右下角显示开始/准备/取消准备按钮

除房主外的其他玩家将显示准备/取消准备按钮；点击可切换按钮状态变为“取消准备”按钮，再次点击恢复“准备”按钮

除房主外的其他玩家进入房间后将自动准备，同时“准备”按钮变为“取消准备”按钮，点击后可取消准备

当房间内的所有玩家都准备就绪时，房主可以点击“开始”按钮开始游戏

### ![](https://cdn.nlark.com/yuque/0/2024/png/38390214/1720161843317-8c73c338-d894-46ea-a044-cfb76ad0fd24.png)![](https://cdn.nlark.com/yuque/0/2024/png/38390214/1720161830996-5e8d76ff-9323-4b97-86d4-8cac624a6e23.png)![](https://cdn.nlark.com/yuque/0/2024/png/38390214/1720169078968-bec5714f-8f10-4bd9-a056-b0747eb44121.png)
# 二.结构设计
**1.新增界面相关脚本：**

**Lua脚本：**

        * 等待室模块资源管理和跳转： 
        * **Page_WaitingRoom_Ctrl.lua**
        * 等待室主界面： 
        * **UI_WaitingRoom_Ctrl.lua，UI_WaitingRoom_Panel.lua和UI_RoomPlayerItem.lua（房间角色和旁观列表显示单元）**
        * 房间邀请界面： 
        * **UI_RoomInvite_Ctrl.lua和UI_RoomInvite_Panel.lua**
        * 房间信息修改界面： 
        * **UI_RoomModify_Ctrl.lua和UI_RoomModify_Panel.lua**
        * 当前房间信息： 
        * **RoomInfo.lua**

**C#：**

        * 相机旋转与缩放控制： 
        * **UIVirtualTouch.cs**
        * 虚拟摇杆： 
        * **UIVirtualJoystick.cs**
        * 角色移动中介和数据缓存： 
        * **Room3DProxy.cs**
        * 寻路功能： 
        * **NavMoveAI.cs**

**2.VM相关脚本：**

        * **WaitingRoomVM.lua**，新添加和修改的协议包括加入房间通知（MASJoinRoomNoti）退出房间通知（MASExitRoomNoti），房间信息变化通知（ GASRoomDetailUpdatedNoti ），变更旁观状态和组队信息通知（ GASUpdateGameMeansNoti   ），房间准备通知（GASReadyNoti），取消准备通知（GASCancelReadyNoti），设置旁观请求（GASUpdateGameMeansReq），加入位置请求（GASUpdateGameMeansReq），锁定位置请求（GASSetPlaceStateReq），锁定位置通知（GASSetPlaceStateNoti），修改房间信息请求（GASSetRoomBaseInfoReq），开始游戏请求（GASStartReq），催促房间玩家请求（GASDoActionReq），邀请获取空闲玩家（STSGetIdlePlayersReq），设置房间歌曲场景玩法请求（GASSetRoomParamReq），设置房间歌曲场景玩法通知（GASSetRoomParamNoti）



# 三.详细结构设计
**1.类的依赖关系及重要方法。**

![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/44314719/1728557068873-b3f490b5-d30c-4756-80e4-be586517aa81.jpeg)

**2.场景相机跟随角色使用Cinemachine**

![](https://cdn.nlark.com/yuque/0/2024/png/44314719/1728545193854-69584c71-b584-4771-976e-80fa41d82c9b.png)

****





# 四.流程设计


**1.房间内玩家移动**



![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/44314719/1728554162592-a2c8f564-ffe5-4fc8-947d-579d8c47e691.jpeg)

**2.房间开始游戏流程**

![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/44314719/1728554770973-5c75c316-96f4-4b93-a833-b5b4ad5c635e.jpeg)



# 五.问题




## 
  
 

