# 一、简介
内容：为了适配多人房间，单人房间，大奖房间，新手房间等房间内容开发通用的房间模块

目的：方便的创建房间和自定义的数据处理

比如在渔场召唤多少条鱼，鱼的队形，是否是单机模式等等等，可以自定义任何内容



# 二、结构设计
内容：原有的BattleModel.lua 和BattleModel_Local.lua 两个分别处理的正常渔场和模拟渔场的请求，现在需要对其拓展

:::tips
1. 重命名BattleModel.lua 为 NormalRoom.lua
2. 重命名BattleModel_Local.lua 为 SimulationRoom.lua
3. 新增BeginnerRoom.lua 新手房间
4. 新增JackpotRoom.lua 大奖模式房间

:::

目的：先对自己的功能大结构上的规划，才能指导后面逐步做更详细的设计



# 三、详细结构设计
内容：

:::info
1. 通用的模块：用UML类图给出全部对外接口的定义（要带参数）；如果涉及多个类或者脚本，要在类图中体现出依赖关系
2. 系统内重要的模块：用UML类图或XMind脑图给出重要数据结构定义，并且体现出模块间的依赖关系
3. 除类图、类结构的详细说明外，还应该给出功能涉及到的各种重要规则、用法的说明。

:::

目的：

:::info
1. 对重要的部分，深入思考实现细节。
2. 列出依赖关系，辅助思考设计是否合理。
3. 让其他人更直观的看到具体用法（主要是指通用的部分）

:::

注意点：

:::info
1. 通用模块，自身功能实现要完备（如：有开就要有关）。不要为了偷懒随意搞全局的东西出来
2. 通用模块，对外提供的接口要简洁易用
3. 标记依赖关系的时候，重点思考内聚、耦合问题

:::

UML 类图

![](https://cdn.nlark.com/yuque/0/2024/png/49784329/1734340805482-8deb41e1-2a47-4986-8c8c-6b92a8762907.png)

1.新手房间 有3个功能点，

+ 需要引导设置炮台
+ 需要自定义打鱼的次数
+ 需要自定义召唤出来的鱼

2.大奖模式渔场

加入房间的流程，并不退出服务端的逻辑房间，需要客户端本地退出（假退出）

退出房间的流程，需要还原到原来的房间，不走协议，而是客户端本地重新进入房间 

这2步操作都需要保留房间的数据



打中鱼的逻辑，需要开发新的子弹

场景中存在BOSS鱼，必须命中一条BOSS鱼

其他子弹的命中需要均匀分布

一发子弹，大概会随机7-8个特效点



鱼的生成需要根据鱼魂的波次来处理，<font style="color:#DF2A3F;">鱼魂波次的处理，新增协议</font>

<font style="color:#DF2A3F;">鱼群的配置需要新增功能</font>

# 四、流程设计
内容：用时序图描述模块间的交互流程；用流程图描述核心算法

目的：讲解流程。通过画图让自己思考更深入、让其他人看的更直观。



正常房间流程示意图

![](https://cdn.nlark.com/yuque/0/2024/png/49784329/1734342825905-f2f94ef5-db2c-4792-a6ea-790f1278c53f.png)



单人模拟房间

![](https://cdn.nlark.com/yuque/0/2024/png/49784329/1734345320053-a327848d-5de4-490f-abec-763c94614ed7.png)

新手房间，需要继承单人模拟房间，并实现自定义的代码流程

![](https://cdn.nlark.com/yuque/0/2024/png/49784329/1734345841849-f40024dd-485a-49ee-b1b1-9190ad7f2b28.png)

大奖模式房间，因为进出，退出逻辑比较特殊，不是实际的退出房间逻辑，需要特殊处理

大奖模式有自己的UI流程



![](https://cdn.nlark.com/yuque/0/2024/png/49784329/1734347622344-579aecd6-cee9-4b8c-91cf-608084666ebc.png)







# 五、提出问题
如果存在重点、难点问题的解决方案没想清楚，可提出问题在会上讨论



---

# 六、总结整理（开发完成后撰写）
开发过程中，很可能产生跟上面方案不一致的地方。可能补充了更多的细节内容，可能由于某些未想到的原因推翻了方案中的一些设定。

所有开发完成后有价值的内容，都可以记录在这里。

