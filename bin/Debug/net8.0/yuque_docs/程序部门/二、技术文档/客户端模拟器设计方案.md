# 一、简介
内容：开发预览工具，包括效果，调试等等功能

目的：方便加快开发进度，或者提供功能的预览，或者测试某条鱼的BUG

注意点：客户端模拟器部分不存在链接服务端等内容，要求是可以单机能跑，要求是同一套代码

![](https://cdn.nlark.com/yuque/0/2024/png/49784329/1731911534400-affbc7b6-8872-4dda-904a-1dbadf6fd590.png)

![](https://cdn.nlark.com/yuque/0/2024/png/49784329/1731911541152-73f63428-0b8d-4baf-8b68-dbdb6550c6d1.png)

<font style="color:#ED740C;">编辑器入口：RSTools/1 打开场景/13 美术测试场景</font>

# 二、结构设计
内容：

:::info
1. TestSceneFunctionCtrl 负责调用BattleMgr.lua的方法等
2. BattlerMgr.lua 正常游戏进入的逻辑暂不修改
3. ~~<font style="background-color:#FBDE28;">TestSceneVirtualServer.lua </font>~~<font style="background-color:#FBDE28;">部分GM功能移动到BattleMgr.lua，比如必然命中</font>
4. BattleModel.lua 中间层负责定义与服务端交互接口 ，战斗中的交互协议请使用本接口
5. BattleModel_Local.lua 本地实现层，只对BattleModel.lua 负责

:::



通过BattleModel的接口定义了与服务端交互的接口，如果是本地实现，则直接调用服务端的逻辑，跳过各种检查

如果是正常调用，则正常运行RPC框架的逻辑。

注意点，

1.需要服务端<font style="color:#ED740C;">提供不带检测逻辑的接口</font>

2.每条协议的模拟实现需要客户端额外处理，<font style="color:#ED740C;">如不处理，则无法模拟</font>

3.检测代码的复用，经过商讨，客户端模拟的情况下不存在对应的模块，目前<font style="color:#ED740C;">不予实现</font>

4.如果的确需要拓展背包的逻辑，类似的实现方式BagModel.lua.等，<font style="color:#ED740C;">但一般情况下不需要</font>

# 三、详细结构设计
类图

![](https://cdn.nlark.com/yuque/0/2024/png/49784329/1731923039483-9cf0c4c0-aa97-48d3-a8e4-4947883f0a2c.png)

可以看到BattleModel.lua 定义了远程调用服务端交互相关的接口，本地模拟Override 相关内容







# 四、流程设计
使用道具/技能时序图 对比

远程调用的<font style="color:#ED740C;">正常逻辑</font>

![](https://cdn.nlark.com/yuque/0/2024/png/49784329/1731915895376-cae61e83-3f25-4c2d-8158-a88355e50b10.png)



单机逻辑

![](https://cdn.nlark.com/yuque/0/2024/png/49784329/1731916051456-26d80d79-92e2-4a6a-96b2-cf7d89ca506e.png)



BattleMgr.lua 

初始化内部实例化对应的处理模块

考虑在入口处实例化，而不是在内部判断

![](https://cdn.nlark.com/yuque/0/2024/png/49784329/1731916482965-0b44b9f6-b53b-4bc4-b533-22d58f4ddd09.png)



<font style="color:#ED740C;">其他具体逻辑，由各个模块负责，本模块不列举说明</font>

# 五、提出问题
如果存在重点、难点问题的解决方案没想清楚，可提出问题在会上讨论



---

# 六、总结整理（开发完成后撰写）
开发过程中，很可能产生跟上面方案不一致的地方。可能补充了更多的细节内容，可能由于某些未想到的原因推翻了方案中的一些设定。

所有开发完成后有价值的内容，都可以记录在这里。

