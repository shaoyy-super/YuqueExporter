![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1713176606540-5e73e544-8dd3-4139-aeaa-2aa120b3ad58.png)

### 安装php7
+ 使用yum安装php7 repo源

yum install epel-release yum-utils -yyum install [http://rpms.remirepo.net/enterprise/remi-release-7.rpm](http://rpms.remirepo.net/enterprise/remi-release-7.rpm) -y

+ 安装php7.2

yum-config-manager --enable remi-php72yum install php php-common php-opcache php-mcrypt php-cli php-pecl-zip php-gd php-curl php-mysql php-xml php-zip php72-php-mbstring.x86_64  php-mbstring.x86_64 php-fpm -y

+ 检查php版本

php -v                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

### 配置php-fpm
+ 修改配置文件

vim /etc/php-fpm.d/www.conf修改user，group，listen的配置，将用户及组改为和nginx运行用户一样mkdir /var/run/php

![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1713176606821-b6984b54-e8ce-47d8-a152-17122a934235.png)

### 安装composer
+ 安装软件

wget [https://getcomposer.org/download/1.8.3/composer.pharmv](https://getcomposer.org/download/1.8.3/composer.pharmv) composer.phar /usr/local/bin/composerchmod +x  /usr/local/bin/composer

+ 检查命令

composer

+ 设置国内镜像

composer config -g repo.packagist composer [https://packagist.phpcomposer.com](https://packagist.phpcomposer.com)

### 安装mariadb
+ 使用yum安装，执行命令

yum install -y mariadb-server

+ 启动mariadb数据库

systemctl start mariadb

+ 设置数据库密码

mysql_secure_installation 

### 安装nginx
+ 使用yum安装，执行命令

yum install -y nginx

+ 修改配置文件

vim /etc/nginx/nginx.conf,添加include /etc/nginx/conf.d/*.conf;

![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1713176607076-5fd5e5e0-8d67-43cb-8e28-210deb4ab4e0.png)

+ 启动nginx

systemctl start nginx

### 拉取代码
+ 安装git

yum install -y git

+ 下载代码仓库

[http://192.168.51.223/platform/mog](http://192.168.51.223/platform/mog)

### 配置工具
+ 安装项目依赖

cd /path-to-your-projectcomposer install

+ 生成配置文件

cp .env.example .env

+ 修改配置文件

修改DB_HOST,DB_DATABASE,DB_USERNAME,DB_PASSWORD,GAME_URL字段的值

![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1713176607275-43a103b3-7044-4e78-acbb-df73b7a31b2e.png)

+ 生成KEY，上传目录结构

php artisan key:generatephp artisan aetherupload:publish

+ 创建数据库

CREATE DATABASE IF NOT EXISTS mog default charset utf8 COLLATE utf8_general_ci;

+ 应用数据库模型

php artisan migratephp artisan db:seed

+ 授权权限

chown -R :nginx /data/mogchmod -R 775 /data/mog/storage

+ 链接目录

ln -s /data/ProjectPok/ storage/app/public/gameln -s /data/salt storage/app/salt

+ 启动 计划程序

* * * * * cd /path-to-your-project && php artisan schedule:run >> /dev/null 2>&1

+ 运维脚本

# 切换目录 cd /data/mog/storage/app/salt/states/game/files/scripts# 上传脚本文件，并修改文件中pillar的文件名rz modify-pillar.sh

+ 创建管理员账号

cd /path-to-your-projectphp artisan admin:create-user

+ 配置站点

cp nginx.conf /etc/nginx/conf.d/mog.conf

![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1713176607558-38397f58-25cc-49a9-b621-053832ae66c6.png)

+ 重载nginx

systemctl reload nginx

+ 访问mog页面

http://xxxxx:9090/admin

