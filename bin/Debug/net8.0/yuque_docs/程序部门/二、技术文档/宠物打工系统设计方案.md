# 一、简介
宠物打工系统策划文档：[打工功能系统 (yuque.com)](https://snh48group.yuque.com/cod5mf/iwqppn/aa09ag4bgnsmfvpx)

玩家可以把宠物放入打工位进行打工，打工会消耗时间和宠物寿命，打工产出货币需要去打工地点收取

打工流程：

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1724652782772-9a67665d-64ce-48c0-b2cc-365ea3af2ae0.png)

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1724653180347-d50bd4cd-7904-47a2-96f4-60803adf2899.png)

打工宠物队列，可以安排宠物打工，替换打工宠物，开启打工格子，收取产出货币

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1724653351348-c0e11a62-7623-4532-a942-b8a51bd9a9af.png)

安排宠物打工时，由玩家决定打工时间，打工宠物，界面显示宠物打工技能增益



# 二、结构设计
内容：

:::info
1. Page_Town_Ctrl：预加载UIEnum.PetWork
2. Scene_Town_Ctrl：trigger交互，切换ui，创建宠物，寻路至打工点，3Dui，移除宠物
3. TownWorkPetActor_Ctrl：主城中创建的工作宠物控制器
4. TownVM：主城中用到的数据存储和获取脚本
5. UIPetProduceHud3D：宠物工作有产出时的3Dui，可点击
6. UI_PetWork_Ctrl，UI_PetWork_Panel：宠物打工主界面   UI_WorkPointItem：工作位item
7. UI_ChoosePetWork_Ctrl，UI_ChoosePetWork_Panel：选择宠物打工界面   UI_ChooseWorkItem
8. 场景内交互区域，工作位，3DUI挂点，都放置在主城地图场景内
9. 宠物的创建先预加载，然后需要的时候创建，当地图场景卸载或者移除宠物的时候卸载资源

:::

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1724728628755-a936c638-9e8c-44e4-823b-658f88daf775.png)

# 三、详细结构设计
内容：

:::info
1. Scene_Town_Ctrl：监听放置移除宠物消息，创建宠物，寻路，移除宠物；监听宠物生产数据，当有产出时，创建3DUI，当玩家把对应位置宠物移除的时候，卸载宠物和3Dui
2. TownVM：主城中用到的数据存储和获取脚本，提供界面用到的数据接口，向服务器请求数据发送操作指令等
3. 通过主角身上动态挂载的InteractiveTargetCtrl检测脚本，检测触发场景里面的trigger，设置当前触发type，打开宠物工作ui，调用TownVM：GetCurTriggerPetWorkData获取工作队列数据，刷新界面；选择宠物界面通过当前trigger类型，显示和选择流程有区别显示。选择完成后，通知服务器（trigger_type

       , work_point, pet_id）哪个工作场地的哪个工作点位放置的哪个宠物

 4.  主城的ui界面划分：UI_Town_Panel放置主城公共的元素（宠物养成跳转，聊天等），负责切换其他页签；主城（角色信息，世界，商城等），打工（工作队列，工作地点信息，一键收取）等作为panel页签，需要的时候切换页签，各自页签处理各自的事情

:::

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1724728880200-9893e0c7-6778-4adc-9048-21551a2114e4.png)

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1724666877785-1615be90-417f-40a8-a742-b241918fa4e9.png)



# 四、流程设计
内容：用时序图描述模块间的交互流程；用流程图描述核心算法

目的：讲解流程。通过画图让自己思考更深入、让其他人看的更直观。



# 五、提出问题
<font style="color:#DF2A3F;">宠物的创建预加载：可以在进去工厂交互区域后再预加载。</font>

<font style="color:#DF2A3F;">宠物寻路之后，怎么停止</font>



---

# 六、总结整理（开发完成后撰写）
开发过程中，很可能产生跟上面方案不一致的地方。可能补充了更多的细节内容，可能由于某些未想到的原因推翻了方案中的一些设定。

所有开发完成后有价值的内容，都可以记录在这里。

