# 一、简介
游玩界面：

![](https://cdn.nlark.com/yuque/0/2024/png/35004992/1733105763616-a4ecc19c-004e-4bae-ba13-8c7d726ec277.png)

太鼓玩法在界面下方会显示一个按键移动区域和一个判定区域。

开始播放舞蹈和音乐后，按键会从区域右边（或者左边，方向可以在设置界面进行更改）出现并移动到判定区域。

按键一共有两种类型：

    1. 单键：![](https://cdn.nlark.com/yuque/0/2024/png/35004992/1733105884962-765bea13-e816-4686-a24f-f71f9844aa69.png)包含方向键和空格键，到达判定区域后，按下对应按键即可。
    2. 长键：![](https://cdn.nlark.com/yuque/0/2024/png/35004992/1733121069452-f6e45f91-628b-47ca-ac66-575e8dcf1cd7.png)方向键后拖着一条直线，需要在开头的方向键处按下，直到直线结束松开按键。

# 二、结构设计
:::info
1. **新增流程控制脚本**
    1. RhythmDanceMode.lua，用来控制整个太鼓玩法的流程。
2. **新增界面相关脚本**
    1. UI_DanceRhythmMode_Ctrl.lua和UI_DanceRhythmMode_Panel.lua，作为太鼓玩法的游玩UI。
3. **新增VM脚本**
    1. DanceRhythmVM.lua，用来存储太鼓玩法游玩过程中的数据，并提供获取数据的接口

:::



# 三、详细结构设计
:::info
1. **太鼓玩法谱面结构**

![](https://cdn.nlark.com/yuque/0/2024/png/35004992/1722252345720-04439285-6a5f-40fc-b498-2a03f68f96ca.png)



    1. id：从1开始依次递增，不可重复
    2. time：按键按下时机，按键出现的时机为time-800毫秒（800毫秒走配置）。
    3. type：1：单点； 2：长按；
    4. key：PC端和手机端代表意义不一样
        1. PC:
            + 0：showtime
            + 1：左右键随机显示
            + 2：上下键随机显示
            + 3：左键
            + 4：下键
            + 5：上键
            + 6：右键
        * 手机端：
            + 0：showtime
            + 1：左右键随机
            + 3、6：左键
            + 4、5：右键
    5. parameter：长按（type=2）时，记录长按的毫秒数。
    6. 合并规则：
        1. 同时间（相差不足3毫秒）不同键位的两个键合并为一个空格键
2. **类的依赖关系及重要方法**

![](https://cdn.nlark.com/yuque/0/2024/png/35004992/1733120407706-5f6be6db-4779-49b6-9912-b6ae80f3793d.png)

:::



# 四、流程设计
1. **界面时序图：**
    1. ![](https://cdn.nlark.com/yuque/0/2024/png/35004992/1733123114123-e574921f-f867-48a3-b28a-69dbf0b0206d.png)
2. **按键结构：**
    1. 单键：![](https://cdn.nlark.com/yuque/0/2024/png/35004992/1722250120429-a8200cac-bdb2-4d0e-bee5-97de6716fb47.png)单个按键，显示一张Sprite，另外有一个特效挂点。根节点通过Button接收点击事件。
    2. 长键：![](https://cdn.nlark.com/yuque/0/2024/png/35004992/1733121264685-6ce7c2c6-cbbb-42a9-b5ae-530ac151173f.png)由两个单键及一个line连线组成，第一个单键显示方向键图标，第二个单键不显示图标，用作线的终点定位。
3. **按键的移动**

每个按键提前800毫秒（可配置）出现，按一定速度移向判定区域。速度分为三档，先设置为1、2、3倍，后续由策划调整配置。

4. **手机端和PC端的区别**
    1. PC端有上下左右四个方向，手机端只有左右方向。
    2. 手机端需要在屏幕上显示操作按键，PC端仅支持键盘操作。（开发阶段编辑器模式下需要在屏幕上显示操作按键方便策划验收）![](https://cdn.nlark.com/yuque/0/2024/png/35004992/1733124105064-5fa2e25d-a153-4b58-b2b4-ca790a6fa883.png)
5. **判定结果：**
    1. 六种判定结果miss、cool、great、perfect、sperfect、sperfectplus。判定时间区域配表。
    2. sperfectplus比sperfect判定更难，显示都为SPerfect，用颜色区分。
6. **音效播放**
    1. 一共四种点击音效
        1. auRhythmClick：点击方向键单键及长键首键时触发。
        2. auRhythmLong：按住长键连线时触发，循环，松开手指或按键后停止。
        3. auRhythmMiss：按失按键时触发。
        4. auRhythmSpace：按下的单键为空格键时触发。
7. **计分**

音符基础分值：

| <font style="color:rgb(0,0,0);">难度等级</font> | <font style="color:rgb(0,0,0);">基础分值</font> |
| :---: | :---: |
| <font style="color:rgb(0,0,0);">短键</font> | <font style="color:rgb(0,0,0);">1000</font> |
| <font style="color:rgb(0,0,0);">长键</font> | <font style="color:rgb(0,0,0);">1000</font> |


判定倍率：

| <font style="color:rgb(0,0,0);">打击结果</font> | <font style="color:rgb(0,0,0);">判定倍率</font> |
| :---: | :---: |
| <font style="color:rgb(0,0,0);">遗憾</font> | <font style="color:rgb(0,0,0);">0</font> |
| <font style="color:rgb(0,0,0);">很棒</font> | <font style="color:rgb(0,0,0);">1</font> |
| <font style="color:rgb(0,0,0);">优秀</font> | <font style="color:rgb(0,0,0);">1.1</font> |
| <font style="color:rgb(0,0,0);">完美</font> | <font style="color:rgb(0,0,0);">1.2</font> |
| <font style="color:rgb(0,0,0);">超完美</font> | <font style="color:rgb(0,0,0);">1.3</font> |
| <font style="color:rgb(0,0,0);">超完美+</font> | <font style="color:rgb(0,0,0);">1.3</font> |


连击倍率：

| <font style="color:rgb(0,0,0);">连击数（含）</font> | 连击倍率 |
| :---: | :---: |
| <font style="color:rgb(0,0,0);">1-49</font> | <font style="color:rgb(0,0,0);">1.0</font> |
| <font style="color:rgb(0,0,0);">50-99</font> | <font style="color:rgb(0,0,0);">1.1</font> |
| <font style="color:rgb(0,0,0);">100-199</font> | <font style="color:rgb(0,0,0);">1.2</font> |
| <font style="color:rgb(0,0,0);">200-499</font> | <font style="color:rgb(0,0,0);">1.5</font> |
| <font style="color:rgb(0,0,0);">500-999</font> | <font style="color:rgb(0,0,0);">2.0</font> |
| <font style="color:rgb(0,0,0);">1000及以上</font> | <font style="color:rgb(0,0,0);">2.5</font> |


    1. 单次实际得分=音符基础分值 * 判定倍率 * 连击倍率
    2. 实际总分=所有单次得分相加
    3. 最终显示总分：所有歌曲的总分是1000000分，需要将上一步计算出的总分通过公式：**显示总分=（总分/满分）*1000000**计算出最终得分。所有界面上显示的是最终显示总分。
    4. 超完美+得分：在超完美之上还有一个超完美+的判定，除了按超完美判定计入实际总分外，在计算完最终显示总分之后，还需要再加上一次超完美得分，使显示总分上限突破1000000分。
8. **结算评价规则：**

| <font style="color:rgb(0,0,0);">得分占比（含）</font> | 评价 |
| :---: | :---: |
| <font style="color:rgb(0,0,0);">95%</font> | <font style="color:rgb(0,0,0);">优+(SSS)</font> |
| <font style="color:rgb(0,0,0);">90%</font> | <font style="color:rgb(0,0,0);">优(SS)</font> |
| <font style="color:rgb(0,0,0);">80%</font> | <font style="color:rgb(0,0,0);">优-(S)</font> |
| <font style="color:rgb(0,0,0);">65%</font> | <font style="color:rgb(0,0,0);">良+(A)</font> |
| <font style="color:rgb(0,0,0);">50%</font> | <font style="color:rgb(0,0,0);">良(B)</font> |


9. **判定失败时角色播放失败动画**

在播放失败动画期间再次判定失败，不会打断当前动画的播放。

---

# 六、总结整理（开发完成后撰写）
开发过程中，很可能产生跟上面方案不一致的地方。可能补充了更多的细节内容，可能由于某些未想到的原因推翻了方案中的一些设定。

所有开发完成后有价值的内容，都可以记录在这里。

