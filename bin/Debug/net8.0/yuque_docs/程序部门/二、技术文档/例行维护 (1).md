### 开启维护公告
+ 在目录服上，编辑对应区组目录下的notice.json文件，修改type等于1的show字段为1

vim  notice.json

![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1713176835080-8ac72b6f-6d15-478e-b54d-6940a1c29ede.png)

### 关闭游戏服
+ 在目录服上，使用root用户执行关服命令

salt '*' state.apply game.stop pillar='{"zone": "*"}'

### 备份数据库
+ 在目录服上，执行备份数据库的命令

 salt '*' state.apply game.backupdb pillar='{"zone": "*"}'

### 关闭跨服
+ 在跨服上，使用dm用户登陆跨服，关闭进程（数码）

# 切换目录cd /home/dm/ProjectDM# 关闭进程sh stop.sh

+ 使用pok用户登陆跨服，关闭进程（口袋）

# 切换目录cd /home/pok/ProjectPok# 关闭进程sh stop.sh# 备份数据库cd /home/pok/ProjectPok;bash /home/pok/ProjectPok/backup.sh  -uroot -pDm2018Pwd123 -d /data/backup

### 更新跨服战
+ 使用dm用户登陆跨服，更新并启动跨服（数码）

cd /home/dm/ProjectDMtar xf  server_[version].tar.gzsh start.sh [version] -m[version]: 版本号

+ 使用pok用户登陆跨服，更新并启动跨服（口袋）

cd /home/dm/ProjectPoksh install.sh -uroot -ppasswd [version]sh start.sh [version] -m[version]: 版本号

### 更新游戏版本
+ 使用工具上传更新包到目录服/data/salt/states/game/files/packages目录。

![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1713176835354-6f4adbbb-83bb-4251-8336-facec496d9f3.png)

+ 在目录服操作，使用root用户执行安装版本

salt '*' state.apply game.install pillar='{"zone": "*", "version": "[version]", "env": "all"}'[version]: 版本号

**注：其中env的参数有三个分别为zones,wait,all，分别代表更新pillar文件中的zones段的游戏服，和zones_wait段的备服，以及所有服。**

### 启动游戏服
+ 开启游戏服

salt '*' state.apply game.start pillar='{"zone": "*", "version": "[version]"}'[version]: 版本号

![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1713176835557-ea5eeb51-406c-4b3e-a378-5350a531818b.png)

### 检查监控
+ 登陆monit监控页面，查看进程状态是否正常

监控monit监控地址：http://目录服地址/monit

### 上传补丁
+ 使用dm用户登陆目录服，上传客户端补丁到/home/dm/ProjectDM/assets目录。（数码）

su - dmcd /home/dm/ProjectDM/assets 

+ 使用pok用户登陆目录服，上传客户端补丁到/home/dm/ProjectPok/assets目录。（口袋）

su - pokcd /home/dm/ProjectPok/assets

+ 执行命令，解压补丁，具体参考svn上[<u>https://192.168.51.221/svn/molegame/File/运维相关</u>](https://192.168.51.221/svn/molegame/File/运维相关)的“各版本补丁上传”

unzip [version]/Android/patch.zip -d [version]/Androidunzip [version]/iOS/patch.zip -d [version]/iOS[version]: 版本号

+ 同步补丁至存储桶（如果有，没有则跳过）

# 安卓补丁ossutil64 cp -rf Android oss://jiujishumashou/[version]/Android# ios补丁ossutil64 cp -rf iOS oss://jiujishumashou/[version]/iOS[version]: 版本号

### 应用补丁
+ 修改server_list.json文件中字段version_max为最新补丁版本号
+ 修改server_list.json文件中字段patch_url为最新补丁地址（如有修改）

vim  group/server_list.json####"version_max" : "[version]","patch_url": "http://xxxx.xxxx.xxxx/[version]",#####[version]: 版本号

### 关闭维护公告 （如无特殊情况，维护公告需对方运营关闭）
+ 使用dm用户登陆目录服，切换至目录/home/dm/ProjectDM/group（数码）

su - dmcd /home/dm/ProjectDM/group

+ 使用pok用户登陆目录服，切换至目录/home/dm/ProjectPok/group（口袋）

su - pokcd /home/pok/ProjectPok/group

+ 编辑notice.json文件，修改type等于1的json段，将show的值从1修改为0

vim notice.json

![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1713176835780-1a049109-7352-4847-898c-9953b7320b1a.png)

+ 通知运营已对外开服，维护结束。

### CheckList检查事项
| 是否提前开启维护公告 |
| :--- |
| 客户端补丁上传更新 |
| 服务器版本更新 |
| 检查serverlist版本号以及cdn的版本号 |
| 备份，监控，日志检查 |


