# 一、简介
内容：记录与玩家自己相关的其他玩家行为

目的：刺激玩家主动进行社交



# 二、结构设计
内容：

:::info
![](https://cdn.nlark.com/yuque/0/2024/png/44713460/1720575192564-2fd2dee6-d7fd-4854-9aa1-c6d2779f8680.png)

1. BoardReport.lua 实现客户端服务器通用的棋盘报告功能接口，减少编辑代码工作量
2. Boardreport_GC.lua session服调用 

       a.保存全局数据，实现全局逻辑功能

       b.保存离线数据，实现离线逻辑功能

3. BoardReport_GS.lua scene服调用，保存个人报告数据，实现个人功能逻辑
4. BoardReportConfig.lua 该文件用于读取配置，提供接口供其他报告文件调用
5. BoardReportDefine.lua 棋盘报告的一些常量定义都集中在该文件
6. BoardReportPlayerData.lua 提供玩家个人数据读取和保存的接口
7. BoardReport_C.lua 客户端调用



![](https://cdn.nlark.com/yuque/0/2024/png/44713460/1720493729704-c5325167-0544-4dab-be15-87be6036b62c.png)

这两个文件会将从数据库中读取到的protobuf数据反序列化，以及将table数据序列化成protobuf保存到数据库

:::



# 三、详细结构设计
内容：

:::info
![](https://cdn.nlark.com/yuque/0/2024/png/44713460/1720575359571-23f424b2-0507-4cf4-9383-d5290b4f1ba2.png)

棋盘报告的proto结构，分为离线和在线两种情况

通用字段都放在ReportData结构中，玩家的行为数据因为根据报告类型的不同，对应的数据字段也不尽相同，所以将这个单独拆出来以二进制的形式存储，方便日后维护和扩展；action_data会根据报告的类型id解析

成不同的行为数据



1. SyncBoardReportData 登录后同步历史报告数据
2. DoOfflineReportData 处理离线报告数据，如果有新的报告，通知客户端
3. OnGenerateArchitectureReport_GS 建筑系统生成报告函数，后续根据不同类型报告可自由扩展
4. GenerateSystemBoardReport 根据不同类型组装棋盘报告数据
5. AddReportData 添加保存棋盘报告的接口

:::



# 四、流程设计
![](https://cdn.nlark.com/yuque/0/2024/png/44713460/1720576521703-07c0374c-1adf-41dd-a992-4d392f6094ef.png)



# 五、提出问题
无



