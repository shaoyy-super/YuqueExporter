# 一、简介
类似 地图查看

节点  1 城市

         2 区域

         3 星球

星球有附属区域 可能有可能没有。

通关的地区可以在地图上再次进入。

附属小功能通关奖励。

![](https://cdn.nlark.com/yuque/0/2024/png/49553947/1731033785336-a37efb6f-4223-4360-beeb-70643dd11d61.png)

![](https://cdn.nlark.com/yuque/0/2024/png/49553947/1731033797591-6f9f4480-530a-456a-83a7-0f6645ccd718.png)

![](https://cdn.nlark.com/yuque/0/2024/png/49553947/1731049461226-bd283b37-5fa2-474b-833d-4a76295a8419.png)

# 二、结构设计
内容：

1  Page_Map_Page  

    Scene_Map_Ctrl 

    城市 管理加载的场景资源  

   Page_Map_Page   中实现资源的加载。

     1）区域的资源。

     2）城市的类型。

     3）星球资源的类型 （现在只有一个星球临时写死）。

     对应的配置档 添加两列 。

     1 ）挂载点。

     2 ）挂载资源名称。

2  UI  UI_Map_Panel 负责地图的UI 。

          核心逻辑是在场景中的 UI 仅仅负责很少的监听逻辑 和切换地区 （等UI确认后能后同步）。

    UI  UI_Map_Ctrl 

           负责当前的数据 核心 当前通关进度 和 当前位置 （等服务器完成功能后同步）

    MapItem 

           管理城市状态 和 区域状态 （等正式效果出来后后同步）

    

3  触摸模块  TouchEvent.cs 

     当前我们项目没通用的触摸模块 可能需要建立一个通用的触摸模块  

          监听  滑动事件 缩放事件 点击事件  使用委托的形式对外传递 传递到lua层或者c#层实现 

4  镜头模块 CityMapCamera.cs 

          负责当前模块的镜头播放  点击事件 和拖动事件



5 资源 加载写死的场景



![](https://cdn.nlark.com/yuque/0/2024/png/49553947/1731482411627-143ef67f-e247-406c-b9b3-38b1454473ab.png)

CityMapCamera.cs 

    1 ） 点击事件 

           点击不同状态的按键 播放timeline从当前状态到新的状态。

           核心是跳过不变化的timeline时间,让动画效果连贯。

    2 ） 缩放事件

           只在城市 ,地区两个状态有效果  。城市,只有放大 ,地区有放大和缩小的行为。

           核心是确认TouchEvent挂载在UI上。

    3 ）拖动事件

           计算鼠标变化改变星球旋转。

          把鼠标的移动偏移变化为旋转。

```plain
// 根据鼠标位置计算旋转
float rotationX = obj.delta.y * rotationSpeed; // 绕 X 轴旋转
float rotationY = -obj.delta.x * rotationSpeed; // 绕 Y 轴旋转

// 应用旋转
_curObj.Rotate(rotationX, rotationY, 0, Space.World);
```

  

           

内容：

:::info
1. cs 层输出事件更新 ,输出点击,缩放,拖动。
2. 实现星球的事件效果 ,实现镜头切换,缩放,拖动效果 。
3. panel 更新事件导致的UI变化,更新调用c# 层的表现效果。

:::

# 四、流程设计
![](https://cdn.nlark.com/yuque/0/2024/png/49553947/1731042972524-d7b52297-833c-4222-99a5-4dcbd0ba5e9f.png)

![](https://cdn.nlark.com/yuque/0/2024/png/49553947/1731483698693-b1d70247-d27b-403e-a0b7-2f99737f0ddd.png)

核心是滑动，缩放，拖动等效果时地图的效果。



# 五、提出问题
如果存在重点、难点问题的解决方案没想清楚，可提出问题在会上讨论



---

# 六、总结整理（开发完成后撰写）
开发过程中，很可能产生跟上面方案不一致的地方。可能补充了更多的细节内容，可能由于某些未想到的原因推翻了方案中的一些设定。

所有开发完成后有价值的内容，都可以记录在这里。

