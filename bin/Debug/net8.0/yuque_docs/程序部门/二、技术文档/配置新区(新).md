**原理：通过python脚本生成salt的pillar文件及区服列表文件server_list.json**

脚本项目链接：[<u>http://192.168.51.223/platform/om-operate/tree/develop/kaifu</u>](http://192.168.51.223/platform/om-operate/tree/develop/kaifu)

![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1713176500397-8c590853-5c6a-46e7-af43-a162406d857b.png)

注：脚本环境会在目录服环境搭建时自动部署到目录服/data/scripts/python目录中

操作流程如下：

1.将原始salt pillar文件和server_list.json文件放到python脚本工作目录

![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1713176500598-295f34e6-81ba-445c-b8a8-83f7e5661d01.png)

2.是否是新机器，若是新机器需在new_server_info.txt中加上该机器的信息，若非新机器则跳过该步

![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1713176500792-ff086c6e-c4e5-4591-9b73-466b190a8eaf.png)

格式为：minion-id 主机公网ip 主机域名 数据库地址

3.执行python脚本

python create_pillar.py  --add_num 20 --login_num 4 --max_game_num 10 --proj dm --host_list 1-10|1,2,7#参数相关--add_num #创建区服的数量--login_num  #游戏服的gate进程数，对应目录服server_list.json中每个区服的gate url数量--max_game_num  #每台机器的最大区服容量，如每台机器最大允许创建10个区，此值为10，具体根据机器性能判断--proj  #项目，当前项目简称，如口袋1和口袋2为pm，数码为dm--host  #想要创建游戏服所在的机器，此值根据salt-key的id，如想要新区创建在第一台游戏服，此值为1，若有多台，以逗号（','）隔开

执行完脚本会生成新区的pillar及server_list.json

4.执行create_game.sh脚本通过新生成的文件创建新区

脚本用法：sh create_game.sh [新生成的文件目录，默认为当前时间] [当前服务器版本号]如下：sh /data/scripts/python/kaifu/create_game.sh 2022121617 0.6.106.22121401 |tee /data/scripts/python/kaifu/logs/2022121617.log

5.创区完成后用新生成的pillar及server_list.json替换原来的文件

