# 一、简介
1. 为了适应各种鱼不同的延时更新需求，需在鱼死亡的时机将鱼的一些状态存储在一个单独的列表中，以便延时调用
2. 需求介绍
    1. 跳字需求：
        1. 普通小鱼跳字，需要在小鱼被打死后金币飞到炮台上的时候播放（其他玩家相同）
        2. 精英鱼跳字，须在鱼被打死后，播放完表演后金币飞到炮台上播放（其他玩家相同）
        3. 无大结算boss（下称小boss），小结算播放结束并移动到玩家炮台后播放（其他玩家相同）
        4. 大结算boss（下称大boss），须在大结算结束后播放（其他玩家需要在小结算结束后播放）
    2. 加金币需求：
        1. 在玩家开炮后显示上扣除玩家金币
        2. 玩家打死鱼以后缓存玩家获得的金币
        3. 等待跳字功能调用广播对应事件后在资源栏加入
    3. 跑马灯需求
        1. 普通小鱼和金鱼无跑马灯
        2. 无大结算的boss跑马灯speaker_id 3,4（包括特殊通知条speaker_id 5）应该在小结算结束后播放，如果不是本房间的玩家的跑马灯或者特殊通知条应该立刻排在队列后播放无需等待结算
        3. 存在大结算的boss跑马灯speaker_id 3,4（包括特殊通知条speaker_id 5）应该在大结算结束后播放
        4. 存在没有speaker_id的跑马灯，这样的跑马灯应该在当前跑马灯播放完后立刻插队播放
        5. 在大厅里或者在渔场中存在其他界面（具体哪些界面不清楚）不能播放特殊通知条，而是应该将特殊通知条转化为speaker_id = 4的跑马灯播放

# 二、结构设计
内容：

:::tips
1. 设置一个枚举，枚举定义了可以发送的事件名称，同时也对应缓存列表名称，名称加timer为对应的timer表名称
2. Init：初始化所有枚举对应的列表
3. StoreMessage：传入枚举，id，延时时长，参数，将参数和延时时长缓存入枚举对应列表中，并使用timer工厂创建一个计时器，在延时结束后发送对应事件
4. 发送事件后删除列表中对应的缓存

:::

# 三、目前的处理方案
1. 跳字

跳字处理目前依赖于FishBase中的CallPanelJumpWord方法，和UI_BossBigResult_Ctrl中的RefreshUI方法以上两个方法会发送同一个事件"CallPanelJumpWord"，区别在于前者发送的是小鱼和小boss，而后者发送的是大boss，两者时机不同

2. 跑马灯

跑马灯主要是通过Chat_C发送对应事件处理，无id的跑马灯在Chat_C中直接调用HintFacade处理，其他的跑马灯发送DealReceiveSpeaker事件处理

当收到服务器的跑马灯通知以后，UI_GameMain_Ctrl:OnServerChatMsg会缓存一个列表msg_flash，这个列表的key为鱼id，当UI_GameMain_Ctrl收到OnStartHorseRaceLamp的时候对比key如果对比成功则发送对应数据给HintFacade处理跑马灯

跑马灯请参考UI_HorseRaceLamp_Ctrl和UI_BigHorseRaceLamp_Ctrl（特殊通知条）



# 四、流程设计
内容：流程图:







# 五、提出问题


# 六、总结整理（开发完成后撰写）


