# 一、简介
随着渔场内美术需求增加, 需要一个测试场景给相关人员进行功能, 效果调试. 故需要制作一个测试场景编辑器实现相关需求. 

暂定需要实现功能: 

1. 鱼的生成(可设置鱼的种类, 条数, 鱼组形式, 位置)
2. 炮台更换及子弹实际命中鱼触发相关事件
3. 生成Boss鱼及其相关tml
4. 可配置隐藏部分技能效果, 隐藏UI

# 二、结构设计
内容：

:::info
FeatureEntry: 作为测试场景入口, 同时负责生成一批客户端假数据, 替换正式游戏里服务器提供的数据.

FeatureEntryData: 提供需要生成的假数据配置.

TestSceneVirtualServer: 虚拟服务器脚本, 替代正式游戏里的服务器, 对客户端发出的事件进行响应.

TestSceneFunctionCtrl: 使用人员配置脚本, 用于与使用人员交互, 但只作为桥接, 具体实现逻辑放入具体功能里

BattleMgr: 提供生成鱼的接口.

UI_GameMain_Ctrl: 提供虚拟服务器交互相关接口.

:::

# 三、详细结构设计
内容：

:::info
![](https://cdn.nlark.com/yuque/0/2024/png/43288772/1723800123134-b4235c96-c8d7-480b-8e21-8867839eaf58.png)

1. UI_GameMain_Ctrl和BattleMgr作为项目内的正式代码, 不期望与其他测试环境下的类产生任何情况下的耦合, 故彼此之间的交互只通过事件通知进行.
2. FeatureEntry只负责进入游戏之前的假数据生成和进入游戏场景, 故不应存在与其他类的交互.

:::



# 四、流程设计
流程图:

![](https://cdn.nlark.com/yuque/0/2024/png/43288772/1723785676560-d09e7e63-6d5b-4c82-a2d3-e57178c83797.png)

时序图:![](https://cdn.nlark.com/yuque/0/2024/png/43288772/1723791742726-ec9b5a85-351e-49e0-8ac3-12deea85ec85.png)

# 五、提出问题
1. 虚拟服务器替代真服务器的情况下, 原来发送协议之前会过一次检测, 虚拟服务器下这个检测大概率过不了. 现在考虑是在检测之前先发虚拟服务器响应的事件, 但这样做在正式代码下看着会比较奇怪.

<font style="color:#DF2A3F;">解: 直接使用一个固定return true的方法顶掉检测方法</font>

2. 执行入口函数时需要一些启动参数配置, 当前StandaloneEntry脚本不支持此方式, 启动之后去找脚本存在入口函数直接跳转其他场景导致无法找到的情况.

<font style="color:#DF2A3F;">解: 添加支持传递一个MonoBehaviour作为配置的启动参数</font>





---

# 六、总结整理（开发完成后撰写）
开发过程中，很可能产生跟上面方案不一致的地方。可能补充了更多的细节内容，可能由于某些未想到的原因推翻了方案中的一些设定。

所有开发完成后有价值的内容，都可以记录在这里。

