# 一、简介
![](https://cdn.nlark.com/yuque/0/2024/png/43288772/1723622887648-dd7f749b-edd2-42e2-ac64-a72023df6876.png)

整个游戏基础玩法主要抽象为5个对象: 玩家, 炮台, 子弹, 鱼, 渔场.

玩家: 主要记录玩家身上的货币信息, 倍率信息, AI一部分信息.

炮台: 主要记录玩家一些操作属性(如自动开火, 自瞄, AI部分行为信息)及子弹的生成.

子弹: 主要记录一些子弹的信息(如速度, 反弹次数, 指向目标)及与鱼产生碰撞(会生成网检测命中, 网本身没有太多逻辑, 此处可以不做讨论).

鱼: 主要记录一些鱼使用的信息(鱼的速度, 类型, 配置id, 对应的技能)及作为触发器, 触发子弹, 网, 边界等的碰撞事件.

渔场: 主要提供生成鱼的方法.

除此之外还存在移动脚本, 旋转脚本, 边界脚本等附属功能实现当前游戏效果.

# 二、结构设计
内容：

:::info
PlayerInfo: 玩家对象, 主要是存储数据, 承载C#和Lua之间的交互(如: 玩家金币数值在Lua层获取之后传递给PlayerInfo脚本, 炮台检测PlayerInfo信息处理子弹发射检测, 同理, 倍率信息, AI信息也是这样).

GunAttr: 炮台对象, 功能上主要是响应玩家操作或者控制AI行为, 发射子弹.

BulletAttr: 子弹对象, 功能上主要处理与鱼碰撞相关的事件.

FishAttr: 鱼对象, 主要处理鱼的一些功能和行为(如: 映射碰撞框, 存储相关属性)

FishMaker: 渔场对象, 主要处理生成鱼功能.

WebAttr: 渔网对象, 也是承载表现受击效果的对象, 负责鱼的实际命中, 但相对而言没有复杂的逻辑需求, 只负责检测碰撞, 发给lua层与服务器交互. 

Ef_AutoMove: 移动脚本, 主要负责各种对象的移动(当前主要是鱼和子弹).

Ef_AutoRotate: 旋转脚本, 主要负责鱼位移时的旋转.



资源加载: 以上除了FishMaker(单例, 固定一个), GunAttr(定死的4个, 游戏内无法更换)以及PlayerInfo(场景内定死的4个玩家)之外, 其他脚本都使用缓存池方式, 回收和重用时都需要考虑相关属性的重置.



资源目录结构: 

1. 鱼都放在Assets\Art\Unit\Pet目录下, 根据类型命单独建立文件夹.
2. 炮台都放在Art\Unit\DynamicUnit目录下, 根据类型名称单独建立文件夹.
3. 子弹和渔网效果暂时放在Art\Particle\Prefab\demo目录下, 暂不确定后续特效区分规则.

:::



# 三、详细结构设计
内容：

:::info
![](https://cdn.nlark.com/yuque/0/2024/png/43288772/1724830501964-f4307a58-02d4-4cba-a2e4-8db4ad7bdbc1.png)

抛去一些显示相关的和AI相关的部分, 总体UML图大概是这样. Lua层的BattleMgr主要与C#层渔场功能交互, UI_GameMain_Ctrl主要与玩家数据, 行为等相关功能交互.

:::



# 四、流程设计
流程图: 

![](https://cdn.nlark.com/yuque/0/2024/png/43288772/1724293590505-6557ec13-06eb-4755-ba8c-175d194ecc8e.png)

时序图:

![](https://cdn.nlark.com/yuque/0/2024/png/43288772/1724828998252-2c599ca5-47ea-4f63-91b9-a872e0baa69f.png)

# 五、提出问题
暂无



---

# 六、总结整理（开发完成后撰写）
开发过程中，很可能产生跟上面方案不一致的地方。可能补充了更多的细节内容，可能由于某些未想到的原因推翻了方案中的一些设定。

所有开发完成后有价值的内容，都可以记录在这里。

