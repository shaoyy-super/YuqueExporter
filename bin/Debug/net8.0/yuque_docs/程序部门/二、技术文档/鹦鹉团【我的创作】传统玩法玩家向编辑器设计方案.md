# 一.简介
该文档为鹦鹉团【我的创作】传统玩法玩家向编辑器方案，通过提供可视化的工具和界面，让能帮助音乐制作人、音乐爱好者等用户够直观地设计和调整传统玩法的按键、动作等功能，使其更加高效、便捷地创建和编辑游戏谱面。

![](https://cdn.nlark.com/yuque/0/2024/png/46026893/1724742048656-c1587bd2-5aa4-474f-b21e-65b77bff2c19.png)

# 二.结构设计
**脚本概述**

1.**数据管理**

+ ModuleDataVM，模组管理器，管理ModuleDataBase
+ ModuleDataBase，模组数据基类，后续子类可能包含按键模组，动画模组等
+ KeyPressModuleData：ModuleDataBase，难度按键模组数据



+ TrackDataVM，轨道管理器，管理TrackData。
+ TrackData，轨道数据脚本，管理CliptDataBase。
+ ClipDataBase，轨道片段数据，由TrackData管理。
+ KeyPressClipData：ClipDataBase，难度按键片段数据



+ ActorVM/SceneVM，角色数据和场景数据



+ DataBase(未确定)，作为ModuleDataBase和ClipDataBase的基类，用于统一显示在按键预览界面的数据基类。

**2.时间管理**

+ TimeMgr，时间管理器，管理当前轨道时间，提供查询总时间等。

**3.界面管理**

+ WindowMgr界面总管理器脚本，管理所有界面，管理数据初始化，界面初始化/释放等等，以及用于编辑器的Tick。
+ PanelBase界面基类。



+ WindowPanel，编辑器整体界面，包含了退出，保存等功能。



+ ModulePanel：PanelBase，模组界面，管理ModuleItemBase
+ ItemBase：组件基类
+ KeyPressModuleItem：ItemBase，难度按键组件。



+ DancePreviewPanel：PanelBase，角色舞蹈预览界面。
+ ActorControl/SceneControl：角色控制管理器/场景控制管理



+ ModulePreviewPanel：PanelBase，模组预览界面。



+ TrackPanel，管理轨道界面脚本，管理TrackItem。
+ TrackItem，管理ClipItemBase。
+ ClipItemBase：ItemBase，clip组件基类
+ KeyPressClipItem：ClipItemBase，难度按键轨道片段组件。



+ TrackBgPanel，管理轨道刻度线，滑动线等。

**4.创建工厂**

+ DataFactory，数据工厂，创建数据对象
+ ItemFactory，组件工厂，预制体组件创建

**5.指令管理器**

+ CommandMgr，指令管理器，指令存储，向前/后撤销的指令管理器。
+ ICommond，指令接口

**6.导出/入管理工具**

+ DataTool，管理数据读取和存储

**7.全局定义变量**

+ BeamEditorConst，静态地址，默认值等等。
+ BeamEditorDefine，枚举等

**8.资源管理类**

+ ResMgr，加载/卸载角色模型、场景模型、歌曲资源，

**9.音频播放管理**

+ AudioMgr，简单管理歌曲播放，场景的AudioSource。



**文件目录概述**

**1.编辑器功能文件夹**

**2.可独立运行编辑器的场景**

# 三.详细结构设计
**1.模组基类数据结构，模组子类可能包括，按键模组，动作模组等**

![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/46026893/1724832621534-72b7e106-7ff2-4d60-82bf-08c464af0592.jpeg)

ModuleDataVM管理ModuleDataBase。

**2.轨道片段数据结构**

![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/46026893/1724832465213-02ba64df-e570-4dd3-b6b4-416edab48b8a.jpeg)

通过拖拽将按键模组拖入指定区域，根据ModuleData的类型来生成片段数据ClipData，由TrackData管理。

**3.轨道数据结构**

![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/46026893/1724811037077-a4e23644-7800-4424-9958-befd661243f9.jpeg)

轨道数据TrackData由TrackDataVM数据层管理。

**4.跳舞预览角色/场景数据结构**

![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/46026893/1724832613987-8ccee0e3-29b8-440b-b097-8a43f45f884b.jpeg)

**5.指令数据结构**

![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/46026893/1724760236904-b6fe0426-0a67-4bbb-b08c-c527bd6d8f1d.jpeg)

对ClipDataBase的增删查改都需要通过命令模式，所有命令执行/缓存由CommondMgr管理器统一管理。

**6.类的依赖关系及重要方法。**

![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/46026893/1724841168410-7a1acd6b-6f00-4aec-9030-8c860ab59dfe.jpeg)

**7.ModuleDataBase需要的配置结构**

+ 模组配置表结构。

    ![](https://cdn.nlark.com/yuque/0/2024/png/46026893/1724849429141-67b3830a-697e-4844-8259-bfa7d8807e30.png)







# 四.流程设计
+ **游戏内流程**

![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/46026893/1724832743909-d1e3cf52-64d1-44a2-8b5c-500e38d2dbc4.jpeg)

+ **界面信息**

![](https://cdn.nlark.com/yuque/0/2024/png/46026893/1724811927558-c19ca628-5d49-4c1c-be38-20c24519bd21.png)

编辑界面主要分为4大区块。

    - 区块1，难度按键区域，读取配置表获取难度等级范围，对应相应的按键按钮。			
    - 区块2，预览展示区域，根据当前时间轴的时间展示角色动作。
    - 区块3，按键预览，根据区块1中的按键选中，根据不同类型来展示按键信息。
    - 区块4，编辑轨道，通过拖拽区块1中的按键按钮，在按键轨道上面生成匹配节拍的按键信息。在音乐轨道上面生成火焰纹理。

# 五.问题
