# 一、简介
针对渔场内产生的鱼, 很多鱼会存在一些特殊效果, 概念上将这些效果定义为鱼的技能. 目前将这些技能区分为4类: 登场技能、移动技能、受击技能、死亡技能. 存在在上线之后修改某些技能逻辑的情况, 故选择将具体的技能逻辑做在Lua里. 由此考虑最终制作为一个鱼的技能脚本, 将四个技能的逻辑整合在这个脚本里, 同时针对具体里面的表现效果, 区分为逻辑层和表现层(部分效果会只存在表现层).

# 二、结构设计
内容：

:::info
BattleMgr: 管理具体鱼的技能脚本, 并在生成鱼的时候将对应的lua脚本同鱼的对象关联起来

FishAttr: C#层鱼的对象脚本, 负责处理鱼的各个周期

Fish_XXX_Skill: 具体鱼技能的脚本, 负责鱼在这个阶段的具体行为.

SkillDataCenter: 管理鱼的逻辑层相关功能(考虑到类型不会太多, 参数相对固定, 且与表现层存在一对多关系, 故对具体逻辑层功能封装一层)

SkillDataXXX: 具体的逻辑层功能(其中可能存在异步操作, 故通过回调形式决定其完成时机).

SkillEffectXXX: 具体的表现层功能, 不存在逻辑层时由鱼的技能脚本直接调用, 存在时通过回调形式传给逻辑层, 待逻辑层处理完成后执行.



考虑到渔场内会有很多同种鱼, 但其技能都是一致的, 故Fish_XXX_Skill并不作为一个类去绑定某条鱼, 而作为一个单例去根据传入的鱼播放对应效果.

:::

# 三、详细结构设计
内容：

:::info
![](https://cdn.nlark.com/yuque/0/2024/png/43288772/1724908709129-0eeb7d33-dcb4-40fa-871b-b9fa4f50bd3b.png)

考虑技能中逻辑层和显示层的差异(逻辑层可以存在多种情况下的复用, 比如多种表现效果都需要同一个逻辑层发送同样一条协议并接受回包, 只是发送协议的参数不同), 故针对逻辑层封装了一层SkillDataCenter处理其1对多的特性.

:::

# 四、流程设计
流程图: 

![](https://cdn.nlark.com/yuque/0/2024/png/43288772/1724912671245-1c49256c-bd0c-436e-9c7d-a4c722217284.png)

时序图: 

![](https://cdn.nlark.com/yuque/0/2024/png/43288772/1724927671907-015182b7-93ad-4bad-a539-95f6ac8ef8da.png)



# 五、提出问题
如果存在重点、难点问题的解决方案没想清楚，可提出问题在会上讨论



---

# 六、总结整理（开发完成后撰写）
开发过程中，很可能产生跟上面方案不一致的地方。可能补充了更多的细节内容，可能由于某些未想到的原因推翻了方案中的一些设定。

所有开发完成后有价值的内容，都可以记录在这里。

