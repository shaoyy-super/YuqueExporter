## 一、场景
### Page_FieldMap_Ctrl
新增“野外地图(FieldMap)”Page 进行管理情景管理

#### 函数：
OnShow：打开摇杆界面，打开野外主界面

OnClose：1、关闭摇杆界面，关闭野外主界面

OnPickMonster：滑动屏幕的回调，算瞄准的概率

PickedMoster：选择怪物后的表现

EndPickMonster：处理抓怪的结果，如果抓捕成功，则将该怪回收

### Scene_FieldMap_Ctrl
新增“野外地图(FieldMap)”Scene进行场景管理

#### 函数：
FindMonsterNodes：获取场景中野怪的生成点

FindPlayerNode: 获取场景中主角的生成点（暂定，后面会改成服务器下发出生点）

DoPreload：预加载，调用FindMonsterNodes和FindPlayerNode初始化出生点，预加载野怪和主角，创建加载器ResRegistry

CreatePlayer：创建主角

RefreshMonster：创建野怪

OnShow：调用CreatePlayer和RefreshMonster 创建角色和野怪

![](https://cdn.nlark.com/yuque/0/2024/png/44744345/1718681416369-88871c44-2c26-40f5-9e34-bcb527974e39.png)

ReleaseRes：资源回收函数

OnHide：调用资源回收

![](https://cdn.nlark.com/yuque/0/2024/png/44744345/1718681466028-6dba45b2-106a-4372-a7bf-b03783e97595.png)

OnDestroy：清理DoPreload获取的点数据，销毁加载器卸载资源

OnJoystickMove：摇杆的回调

## 二、角色创建
### 1、脚本
#### 新增地图单位基类： ActorBase.lua
Ctor(registry,load_id):构造函数，参数为加载器和id，同时调用Init函数

Init：初始化函数，受子类重写处理不同的创建后的逻辑

PlayAnimation：播放动画

PlayBehaviorTree：播放行为树

PlayTimeline：播放timeline

Move：移动，主要处理MeshAgent

StopMove：停止移动，主要处理MeshAgent

#### 新增主角类： PlayerActor_Ctrl.lua
Init：初始化函数

PlayerMove：摇杆的回调

ChangePlayerState：状态切换

Dispose：回收函数

#### 新增野怪类： FieldMapMonster_Ctrl.lua
Init：初始化函数

ColliderEventBind：碰撞器的检测开启状态设置

ChangePlayerState：状态切换

Dispose：回收函数

C#：

项目中现有的UnityActorCtrl.cs 处理C#端单位行为

包含：行为树或Timeline播放，动画切换等处理函数

## 三、移动系统
移动系统包含角色移动和相机跟随

### 1、界面
资源界面内容分为两部分：摇杆系统，屏幕触摸

摇杆系统：控制主角移动

屏幕触摸：控制相机的上下左右旋转

### 2、脚本
界面对应的Panel脚本和Ctrl脚本

摇杆组件脚本：框架内现有的CustomJoystick  C#脚本

屏幕触摸脚本：新增CustomTouch  C#脚本判断手势滑动

CustomJoystick和CustomTouch 都是通过IPointerDownHandler, IDragHandler, IPointerUpHandler事件实现

1、摇杆和屏幕触摸存在层级问题，需要把摇杆系统放在屏幕触摸的上方

2、屏幕触摸使用NoDrawBlock实现UI触摸，所以调整组件的大小即可实现触摸区域修改

