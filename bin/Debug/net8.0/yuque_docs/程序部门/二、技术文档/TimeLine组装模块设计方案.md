# 一、简介
内容：根据boss李小龙的timeline需求构建timeline逻辑多播的调度实例

目的：将多个timeline根据帧事件的参数进行组合播放

| 推进版本 | 内容 | 更新时间 |
| --- | --- | --- |
| 1.0 | 当前只覆盖李小龙boss的业务需求 | 2024年11月11日 |
| | | |


备注1:后续再考虑抽象层面深化，目前没有更多的需求不好评估朝什么方向去提纯逻辑

备注2:当前模块由于在C#层而目前项目架构未接入C#热更，所以后续还要考虑是否将这个组装模块table化交由track管理，table化需要考虑编辑器上的序列化方式

细化路线与结构块图：

![](https://cdn.nlark.com/yuque/0/2024/png/1580229/1731567102132-3cc310f3-0e55-4834-913d-b47b4f9e2620.png)



1.0版本逻辑简述：

需要在Makers轨道添加TML事件：

![](https://cdn.nlark.com/yuque/0/2024/png/1580229/1731390566577-367839ae-dc41-4e64-b4a8-21b225fee2c4.png)

事件类型为TmlGroupCheck：

![](https://cdn.nlark.com/yuque/0/2024/png/1580229/1731390605887-e1cf4e76-8088-4105-bf10-850a698439d3.png)

下面的参数标记有四种分别是0，1，2，3

代表着组装模块监听四种事件：

    1. 0：播放下一组TimeLine
    2. 1：判断组内是否有下一条TimeLine，有则停止当前播放下一条，无则继续播放
    3. 2：判断如果有下一组TimeLine，播放下一组
    4. 3：判断如果没有下一组TimeLine继续播放全局TimeLine

拿李小龙来举例：

我们需要在全局tml中舞台创建好后设置TmlGroupCheck事件帧参数为0，同时将这个事件帧的下两帧利用循环片段来暂停tml（注意设置事件的帧应该避开循环的这两帧，防止反复触发破坏逻辑）

在李小龙蓄力完毕后衔接出拳或失败的位置设置TmlGroupCheck事件帧参数为1，在出拳完毕或失败的结尾的地方设置TmlGroupCheck事件帧，参数为2

在需要结束继续播放全局tml的地方设置TmlGroupCheck事件帧，参数为3，这个事件会进行判断，只有所有组装tml全部都已经播放了，才会继续播放全局tml进入收尾流程。

![](https://cdn.nlark.com/yuque/0/2024/png/1580229/1731570076813-934a78d3-a5f3-4ce2-ad84-f3134ba69946.png)

# 二、结构设计
1. BattleTml:新增播放timeline组的接口
2. TmlGroupPlayer:传入需要缓存处理的在多个TimeLine中使用的参数信息，处理TimeLine的事件逻辑
3. TmlGroupPlayerMgr:管理组装模块接口，为收集的组装模块分配ID
4. TmlGroupTrackAsset:负责设置需要全局使用的资源信息，并通知混合器
5. TmlGroupMixer:组装轨道的混合器，负责实例化全局资源设置给组装模块
6. ~~ITmlGroupPlayer:组装模块的接口，约束行为~~



# 三、详细结构设计
内容：![](https://cdn.nlark.com/yuque/0/2024/png/1580229/1731584556484-7c5465f5-4c25-46af-8517-3cb05ef90b45.png)

# 四、流程设计
![](https://cdn.nlark.com/yuque/0/2024/png/1580229/1731406256189-f59dfb0f-64bc-42d2-8917-6e5142070263.png)

![](https://cdn.nlark.com/yuque/0/2024/png/1580229/1731488615615-20d8ccaa-ae98-48f6-a57f-7b5be988930a.png)

![](https://cdn.nlark.com/yuque/0/2024/png/1580229/1731396506825-be551f0e-7832-4f67-aa27-bfde77760a74.png)





# 五、提出问题
如果存在重点、难点问题的解决方案没想清楚，可提出问题在会上讨论



---

# 六、总结整理（开发完成后撰写）
开发过程中，很可能产生跟上面方案不一致的地方。可能补充了更多的细节内容，可能由于某些未想到的原因推翻了方案中的一些设定。

所有开发完成后有价值的内容，都可以记录在这里。

