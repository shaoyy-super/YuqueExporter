# 一、简介
内容：1、宠物系统的主界面，其中包含基础信息展示和技能展示；

           2、获取宠物的GM界面

![](https://cdn.nlark.com/yuque/0/2024/png/44744345/1721358010022-80787c9c-ea8e-4f20-b4c0-1798b9d178b8.png)

![](https://cdn.nlark.com/yuque/0/2024/png/44744345/1721358059573-ce0d9b60-d24d-4b5e-ba40-e6476bb01d5a.png)

![](https://cdn.nlark.com/yuque/0/2024/png/44744345/1721358041749-70dbdf07-a4db-4ce6-b83f-a1ff1484334b.png)



# 二、结构设计
内容：

:::info
1. 该功能主要涉及宠物系统养成，故功能关键词为PetDevelop，Page，UI都会以此命名
2. 新建Lua  Presentation\CSys\Pet 文件夹，用于存放Pet模块的脚本
3. 模块Page：新增Page_PetDevelop_Ctrl 用于宠物模型的资产管理及列表数据处理，（暂不需要添加Scene的Ctrl）
4. 通用脚本：GL_PetDevelop包含1、面板，技能等页签的枚举，2、排序枚举 3、排序方法
5. 宠物主界面：新增UI_PetDevelop_Ctrl,UI_PetDevelop_Panel 用于处理宠物主界面逻辑
6. 列表组件：新增UI_PetDevelopItem  用于处理宠物列表item的显示
7. GM界面：新增UI_AddPetGM_Ctrl,UI_AddPetGM_Panel处理GM界面的逻辑
8. 新增3个预制体：UI_PetDevelop_Panel,PetDevelopItem，UI_AddPetGM_Panel 

 模型管理：在UI_PetDevelop_Ctrl中定义table<模型id，模型>对宠物模型进行缓存，模型是通用的，克隆出的模型加入到table中，通过显隐控制显示，同时对列表进行管理，数量超过M个时，将之前超出的部分销毁，在离开Page时销毁

 <font style="color:#DF2A3F;">资源加载方案见问题</font>

:::



# 三、详细结构设计
![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/44744345/1721357747972-6c786fa4-849c-4f84-8235-7c96ac5aff3a.jpeg)

##### UI_PetDevelop_Ctrl
model_list:模型列表，key是模型id，value是克隆出的模型实例

model_point:场景模型挂点

pet_show_list:宠物显示的数据列表（用于储存筛选过的）

cur_tab_enum:当前页签枚举

cur_pet_id:当前宠物id

RefershList：刷新宠物列表

ChangeModel：改变场景模型

ShowTab:显示页签界面

HideTab：隐藏页签界面

RefreshTab : 刷新页签界面

SaveParam：关闭界面时储存数据，<当前petid，当前页签>

OnDestoryUI：销毁界面回调，在里面处理模型列表销毁



页签信息管理：

每个页签都对应一个脚本，PetDevelopTab<font style="color:#DF2A3F;">X，</font><font style="color:#000000;">继承UI_CompBase，</font><font style="color:#DF2A3F;"> </font>X为PetDevelopTabEnum枚举的拼接，第一次打开New个Tab脚本保存在tab_dic中

![](https://cdn.nlark.com/yuque/0/2024/png/44744345/1721358479612-564b39d6-81d7-48cb-8a55-97f509c39eb2.png)

##### Page_PetDevelop_Ctrl
OnShow：打开时处理参数（petid，页签）

SaveParam:目前 return  UI_PetDevelop_Ctrl:SaveParam

![](https://cdn.nlark.com/yuque/0/2024/png/44744345/1721357467059-587b63bb-33df-4538-ac8d-1dc3bcb32331.png)

![](https://cdn.nlark.com/yuque/0/2024/png/44744345/1721357575441-8dfdd74c-a582-43f6-91c8-e7c56d447e9c.png)



##### GL_PetDevelop
![](https://cdn.nlark.com/yuque/0/2024/png/44744345/1721307477832-1f3b4eb9-bc40-4b85-85d7-0073387e10b6.png)



模型显示实现：

新增一个虚拟相机照射场景中的a点，模型挂载在a点上，旋转方式用drag检测，和相机系统用同一个脚本组件





# 四、流程设计
内容：用时序图描述模块间的交互流程；用流程图描述核心算法

目的：讲解流程。通过画图让自己思考更深入、让其他人看的更直观。



# 五、提出问题
  资源加载方案：由于宠物模型数量比较多，故进入Page的时候不能同时预加载所有模型，以免造成加载堵塞及内存突然暴涨；目前有两种方案：

1、分帧加载：因为默认排序是NTF排序，所以在预加载中先加载最前面N个NTF的模型，进入然后在Show中每隔M秒加载N个。优点：展示模型的时候不会有异步的时间差，缺点：当前page下所有涉及到的模型都会在内存中，不过好在只会影响当前page,离开时会释放

2、优先级加载：因为NTF是玩家比较重视的宠物，所以挑选NTF且等级比较高的N个，进行预加载，其他的只是第一次点击的时候加载。优点：相比第一种方案内存占用减少，缺点：选择一个从未选择的模型，显示会有延迟

目前选择第二种



---

# 六、总结整理（开发完成后撰写）
多语言走配置，所以改成脚本也配置

![](https://cdn.nlark.com/yuque/0/2024/png/44744345/1721712895492-792d923e-3208-4198-a8ad-fd37269d9ea4.png)

