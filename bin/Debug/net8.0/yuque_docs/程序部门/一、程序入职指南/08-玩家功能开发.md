[<u>基本结构</u>](https://thoughts.teambition.com/workspaces/5ef1a751f60ea9001bd606cc/docs/5ef2c8554033cd0001bac9c5) (脚本基本结构)[<u>数据存取</u>](https://thoughts.teambition.com/workspaces/5ef1a751f60ea9001bd606cc/docs/5f2a5855e6eed500012bc219) (玩家数据存储)

流程节点

第一次登陆(创建角色)为例:

![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1712656016714-d62f419f-9671-4359-93a6-43da48cc7669.png)![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1712656017051-c1025f03-22d2-4d83-b883-307916a1ad8c.png)![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1712656017357-7d83d056-f185-440e-9903-ff2fc63bb818.png)

-- 登陆OnPlayerLogin-- 登陆完成后OnAfterPlayerLogin-- 登出

OnPlayerLogout-- 加载玩家OnPlayerLoad-- 玩家保存OnPlayerSave-- 玩家数值变更OnPlayerValueChange

玩家对象

玩家分层( <u>C++/C#/Lua</u> ),数据接口

玩家登陆时会在sceneserver上创建玩家player对象, 封装一层LuaPlayer, lua脚本中用到的player都是c++中LuaPlayer暴露出来的接口

![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1712656017715-1067a3ca-de5a-429e-bcd6-1b84c4ec4fd3.png)

基本事件(已玩家登陆完成会触发相应登陆事件为例)

![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1712656018046-1c7741fd-a537-48e1-b6a7-b84d967cc350.png)

离线处理 (对离线玩家数据处理,以清除离线玩家区域排行榜积分为例)

![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1712656018444-45f90be7-55b9-40d5-a830-1e65044cceeb.png)

在玩家上线的时候,进行离线数据的合并

![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1712656018727-edfaadf0-2ab1-4987-9ee2-0a7266e1185a.png)![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1712656019079-97f53afe-322a-4311-88a8-0524bd363cb2.png)

