介绍服务器常用脚本使用方法，脚本在 server/tools 目录下

初始化服务器 init.sh

使用举例： **sh init.sh -z15 -h127.0.0.1 -uroot -p123456 -i192.168.52.205 -g1 -d02**

参数说明

+ **-z :** 自己分配到的服务器区
+ **-h :** 数据库ip
+ **-u：**数据库用户名
+ **-p :** 数据库密码
+ **-i**： 服务器对外ip
+ **-g** : 用于渠道标识，默认可以不填入 默认值1
+ **-d** : 用于服务器端口分配，默认可以不填入 默认值02

**主要关注**

+ -z 参数 原则上请与自己分配到的web上的区服编号保持一致。
+ -d 参数 会修改所有服务器相关对外端口。
+ **执行本命令请确保服务器关闭**

## 外网数据库导入 import_online_db.sh
使用举例： **sh ./import_online_db.sh -l login.sql -g game.sql -s 15 -d 4**

参数说明

+ **-l :** 传入登录服务器数据库
+ **-g :** 传入游戏服务器数据库
+ **-s ：** 自己的服务器区组
+ **-d :** 导入的服务器区组
+ 导入的玩家登录密码统一为： 1
+ 需要登录指定玩家，请根据玩家id 查询数据库t_player 的 f_accname 字段，使用f_accname 内容作为账户名。
+ **特殊情况：可能**出现无法登录正确角色的情况，是由于合服会导致的同一账户的多个角色在同一区。使用数据库命令删除不想要的角色数据，删除server目录下的dump.g.rdb文件，重启服务器。
+ 示例：
+ SELECT * FROM t_player WHERE f_accname="填入登录使用的账户名"
+ 查询出类似以下用户

![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1712656585102-16482395-4dcd-443b-a86e-63132182a97f.png)

+ 使用命令
+  DELETE FROM t_player WHERE f_id != 写入需要的玩家id
+ 删除 dump.g.rdb文件 重启服务器，重新使用 之前的f_accname 登录

## 服务器打包 pack.sh
用途：服务器打包

使用举例：**sh ./pack.sh -v x.x.x.x**

参数说明：

+ -v ：发布包名

本命令打出的服务器包在 /server/package/ 目录下。包名为 server_x.x.x.x.tar.gz

## 开启服务器 run.sh
## **修改服务器时间** modify-time.sh
使用举例： **sh ./modify-time.sh "2020-01-01 18:00:00"**

## **服务器重载 reloadserver.sh**
使用举例： **sh ./reloadserver.sh scene**

重载服务器，填入目标服务器进程名字。

支持 scene session cross 等。

## 开启服务器机器人 **start-robot.sh**
使用举例： **sh ./start-robot.sh 1**

参数说明：

会使用 config-robot-{参数}.xml 的配置开启机器人

配置说明：

复制服务器 config-robot.xml.tmp 模板配置。修改名字为使用的配置。

需要关注的配置

     <language>cn</language>

     <version>main</version>  </global>

    <robotserver>

    填入需要登录的服务器 对应的login的ip端口     <loginurls>

         <url>192.168.52.205:10020</url>

     </loginurls>

    填入需要登录服务器 对应的gate的ip端口       <gameurls>

         <url>192.168.52.205:9020</url>

         <url>192.168.52.205:9021</url>

     </gameurls>

     <platform>0</platform>

         填写正确服务器区服       <zone>15</zone>

 会创建 robot1 ~ robot13 用户名的机器人 密码统一为123456        <account begin="1" end="13" password="123456">robot</account>

 </robotserver>

## 合服 Pok2-QA操作流程
合服举例，以2, 19合服，2区作为主服

### 关服
+ 关闭需要合并的服务器

cd /vagrant/toolssh run.sh stop

### 合并数据
+ 执行合服命令，下图的19和2表示的是19区合入主区2区

cd /vagrant/tools/merge_testsh merge.sh -s 19@127.0.0.1 -t 2@127.0.0.1 -u root -p 123456

### 
![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1712656585528-0566f635-8368-49dd-b41b-4e13504b6e2c.png)

### 修改config配置
+ 切换目录至/vagrant/config
+ 编辑文件config.xml，修改conzones和zones段

![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1712656585958-6e0d464b-1351-4904-99e8-adb5dc947562.png)

此时只能登陆2区玩家数据，如要登陆19区玩家，则需修改config.g.xml

![](https://cdn.nlark.com/yuque/0/2024/png/43288467/1712656586345-f80e599a-9e60-4fd3-93c2-fc82de9c80b5.png)

### 启服
cd /vagrant/toolssh run.sh start

