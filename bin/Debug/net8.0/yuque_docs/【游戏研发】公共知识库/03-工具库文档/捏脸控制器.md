## 脚本类文件`CustomFaceController.cs`
### 私有成员变量
| 变量名称 | 类型 | 注释 |
| --- | --- | --- |
| m_headGo | GameObject | 角色头部 |
| m_blendshapeModifier | [BlendshapeModifier](https://snh48group.yuque.com/org-wiki-snh48group-ec9yge/rgqlf2/pdu6fgx708f9hivd) | 面部塑形修改器 |
| m_defuse | CustomRenderTexture | 面部纹理材质球的主纹理 |
| m_size | Material | 纹理大小 |
| m_makeupTexList | List<MakeupTexture> | 妆容纹理数组 |
| m_rtMat | Material | 渲染纹理材质球 |
| m_headRenderer | Renderer | 面部渲染器(包含脸和睫毛材质球) |
| m_eyeRenderer | Renderer | 眼睛渲染器(包含眼睛材质球) |
| m_bodyRenderer | Renderer | 皮肤渲染器(包含皮肤材质球) |
| m_facePropBlock | MaterialPropertyBlock | 面部材质属性块 |
| m_eyelashPropBlock | MaterialPropertyBlock | 睫毛材质属性块 |
| m_eyePropBlock | MaterialPropertyBlock | 眼睛材质属性块 |
| m_bodyPropContainers | List<[MaterialPropertyContainer](https://snh48group.yuque.com/org-wiki-snh48group-ec9yge/rgqlf2/fyrfotgox5lr46fq)> | 身体材质属性块容器 |
| m_eyelashMatIndex | int | 睫毛材质球在材质球列表的序号 |
| m_rtTexture | Texture2D | 生成的合成纹理 |


### 公共接口
### 初始化
:::tips
+ **Method**：public void Init(GameObject headGo, Texture2D mainTex)

:::

### 参数
| 名称 | 类型 | 注释 |
| --- | --- | --- |
| headGo | GameObject | 角色Prefab |
| mainTex | Texture2D | 面部默认纹理 |


### 初始化
:::tips
+ **Method**：public void Init(GameObject headGo, CustomRenderTexture defuse, int size, Material rtMat, Material faceMat, Material eyelashMat, Material eyeMat, Material bodyMat)

:::

### 参数
| 名称 | 类型 | 注释 |
| --- | --- | --- |
| headGo | GameObject | 角色Prefab |
| defuse | CustomRenderTexture | 面部纹理材质球的主纹理 |
| size | int | 纹理大小 |
| rtMat | Material | 渲染纹理材质球 |
| faceMat | Material | 面部材质球 |
| eyelashMat | Material | 睫毛材质球 |
| eyeMat | Material | 眼睛材质球 |
| bodyMat | Material | 皮肤材质球 |


:::info
💡 注意，目前没有添加法线贴图和AO贴图。

:::

### 设置妆容数据
:::tips
+ **Method**：public void SetMakeup(int makeupType, Texture2D texture, Color[] colors, Vector2 pos, float angel, Vector2 scale)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| makeupType | int | 妆容部位（0=眼妆, 1=眉毛, 2=腮红, 3=唇彩, 4=脸妆） |
| texture | Texture2D | 设置纹理 |
| colors | Color[] | 纹理颜色数组，目前只有眼妆和腮红使用三个颜色，其他的只使用数组的第一个颜色 |
| pos | Vector2 | 纹理偏移位置 |
| angel | float | 纹理角度 |
| scale | Vector2 | 纹理纵横缩放 |


### 设置睫毛纹理
:::tips
+ **Method**：public void SetEyelashTexture(Texture2D texture)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| texture | Texture2D | 纹理 |


### 设置睫毛透明裁剪
:::tips
+ **Method**：public void SetEyelashCutoff(float value)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| value | float | 0~1的裁剪值 |


### 设置眼睛纹理
:::tips
+ **Method**：public void SetEyeMainTex(Texture2D texture)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| texture | Texture2D | 纹理 |


### 设置巩膜贴图
:::tips
+ **Method**：public void SetScleraTex(Texture2D texture)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| texture | Texture2D | 纹理 |


### 设置眼睛遮罩贴图
:::tips
+ **Method**：public void SetEyeMask(Texture2D texture)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| texture | Texture2D | 纹理 |


### 设置法线贴图
:::tips
+ **Method**：public void SetNormal(Texture2D texture)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| texture | Texture2D | 纹理 |


### 设置虹膜平面法线图
:::tips
+ **Method**：public void SetNormal2(Texture2D texture)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| texture | Texture2D | 纹理 |


### 设置眼睛大小
:::tips
+ **Method**：public void SetEyeSize(float value)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| value | float | 眼睛大小 |


### 设置眼睛颜色
:::tips
+ **Method**：public void SetEyeSize(float value)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| value | float | 眼睛大小 |


### 设置明暗
:::tips
+ **Method**：public void SetIrisContrast(float value)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| value | float | 眼睛明暗 |


### 设置虹膜大小
:::tips
+ **Method**：public void SetIrisSize(float value)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| value | float | 虹膜大小 |


### 设置法线强度
:::tips
+ **Method**：public void SetNormalScale(float value)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| value | float | 法线强度 |


### 设置眼睛颜色
:::tips
+ **Method**：public void SetEyeBallColor(Color color)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| color | Color | 眼睛颜色 |


### 设置眼球金属度
:::tips
+ **Method**：public void SetEyeBallMetalness(float value)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| value | float | 眼球金属度 |


### 设置眼球粗糙度(A)
:::tips
+ **Method**：public void SetEyeBallMetalness(float value)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| value | float | 眼球粗糙度 |


### 设置虹膜颜色
:::tips
+ **Method**：public void SetIrisBaseColor(Color color)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| color | Color | 虹膜颜色 |


### 设置虹膜瞳孔金属度
:::tips
+ **Method**：public void SetIrisPupilMetalness(float value)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| color | Color | 虹膜瞳孔金属度 |


### 设置晶状体粗糙度
:::tips
+ **Method**：public void SetLensGloss(float value)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| value | float | 晶状体粗糙度 |


### 设置虹膜边缘虚实
:::tips
+ **Method**：public void SetIrisMargin(float value)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| value | float | 虹膜边缘虚实 |


### 设置眼睛颜色
:::tips
+ **Method**：public void SetIrisExtraColorAmountA(Color color)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| color | Color | 眼睛颜色 |


### 设置虹膜边缘颜色
:::tips
+ **Method**：public void SetIrisMarginColor(Color color)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| color | Color | 虹膜边缘颜色 |


### 设置虹膜位置对齐
:::tips
+ **Method**：public void SetirisBasePosition(Vector4 vector)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| vector | Vector4 | 虹膜位置对齐值 |


### 设置虹膜视差强度
:::tips
+ **Method**：public void SetIrisParallaxPower(float value)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| value | float | 虹膜视差强度 |


### 设置最终颜色强度
:::tips
+ **Method**：public void SetFinalIllumination(float value)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| value | float | 颜色强度 |


### 设置眼睛纹理属性
:::tips
+ **Method**：public void SetEyeTextureProperty(string property, Texture2D texture)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| property | string | 眼睛Shader属性名称 |
| texture | Texture2D | 纹理 |


### 设置眼睛数值属性
:::tips
+ **Method**：public void SetEyeValueProperty(string property, float value)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| property | string | 眼睛Shader属性名称 |
| value | float | 数值 |


### 设置眼睛颜色属性
:::tips
+ **Method**：public void SetEyeColorProperty(string property, Color color)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| property | string | 眼睛Shader属性名称 |
| color | Color | 颜色 |


### 设置塑形权重
:::tips
+ **Method**：public void SetBlendShapeWeight(string name, float value)

:::

| 参数 | 类型 |  | 注释 |
| --- | --- | --- | --- |
| name | string | Blendshape名称 | 颜色 |
| value | float | 权重值 |  |


### 获取塑形权重
:::tips
+ **Method**：public float GetBlendshapeWeight(string name)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| name | string | Blendshape名称 |


### 添加额外对象蒙皮变形器
:::tips
+ **Method**：public void AddExtraObject(GameObject go)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| go | GameObject | 带蒙皮变形器的GameObject |


### 删除额外对象蒙皮变形器
:::tips
+ **Method**：public void RemoveExtraObject(GameObject go)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| go | GameObject | 带蒙皮变形器的GameObject |


### 添加附加蒙皮数组
:::tips
+ **Method**：public void AddSkinnedMeshRenderList(List<SkinnedMeshRenderer> skinnedMeshRenderers)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| skinnedMeshRenderers | List<SkinnedMeshRenderer> | 可能需要被同步调整的带变形器的蒙皮数组 |


### 渲染到纹理
:::tips
+ **Method**：public Texture2D RenderToTexture(TextureFormat format = TextureFormat.ARGB32)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| format | TextureFormat | 纹理格式 |


### 生成妆容结果
:::tips
+ **Method**：public void GenerateResult()

:::

### 刷新角色皮肤材质球(换装时调用)
:::tips
+ **Method**：public void UpdateSkinMaterialPropertyBlocks()

:::

### 设置皮肤透明裁剪
:::tips
+ **Method**：public void SetSkinCutoff(float cutoff)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| cutoff | float | 裁剪数值（0~1） |


### 设置皮肤SSS纹理
:::tips
+ **Method**：public void SetSkinSSSMap(Texture2D sssMap)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| sssMap | Texture2D | SSS纹理 |


### 设置皮肤SSS纹理浓度
:::tips
+ **Method**：public void SetSkinSSSIntensity(float sssintensity)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| sssintensity | float | SSS纹理浓度数值（0~1） |


### 设置皮肤纹理曲率
:::tips
+ **Method**：public void SetSkinCurvature(float skinCurvature)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| skinCurvature | float | 皮肤曲率数值（0~1） |


### 设置皮肤厚度
:::tips
+ **Method**：public void SetSkinThickness(float skinThickness)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| skinThickness | float | 皮肤厚度数值（0~1） |


### 设置皮肤遮罩纹理
:::tips
+ **Method**：public void SetSkinMaskMap(Texture2D maskMap)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| maskMap | Texture2D | 皮肤遮罩纹理 |


### 设置皮肤粗糙度
:::tips
+ **Method**：public void SetSkinSmoothness(float smoothness)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| smoothness | float | 皮肤粗糙度数值（0~1） |


### 设置皮肤金属度
:::tips
+ **Method**：public void SetSkinMetallic(float metallic)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| metallic | float | 皮肤金属度数值（0~1） |


### 设置皮肤咬合强度
:::tips
+ **Method**：public void SetSkinOcclusionStrength(float occlusionStrength)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| occlusionStrength | float | 皮肤咬合强度度数值（0~1） |


### 设置皮肤法线纹理
:::tips
+ **Method**：public void SetSkinBumpMap(Texture2D bumpMap)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| bumpMap | Texture2D | 皮肤法线纹理 |


### 设置皮肤法线缩放
:::tips
+ **Method**：public void SetSkinNormalScale(float normalScale)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| normalScale | float | 皮肤法线数值（默认1） |


### 设置皮肤散射纹理
:::tips
+ **Method**：public void SetSkinEmission(Texture2D emission)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| emission | Texture2D | 皮肤散射纹理 |


### 设置皮肤散射颜色
:::tips
+ **Method**：public void SetSkinEmissionColor(Color emissionColor)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| emissionColor | Color | 皮肤散射颜色 |


### 设置皮肤颜色
:::tips
+ **Method**：public void SetSkinColor(Color color)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| color | Color | 皮肤颜色 |


### 设置皮肤纹理属性
:::tips
+ **Method**：public void SetSkinTextureProperty(string property, Texture2D texture)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| property | string | 眼睛Shader属性名称 |
| texture | Texture2D | 纹理 |


### 设置皮肤数值属性
:::tips
+ **Method**：public void SetSkinValueProperty(string property, float value)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| property | string | 眼睛Shader属性名称 |
| value | float | 数值 |


### 设置皮肤颜色属性
:::tips
+ **Method**：public void SetSkinColorProperty(string property, Color color)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| property | string | 眼睛Shader属性名称 |
| color | Color | 颜色 |


### 设置纹理合成材质球的面部底图
:::tips
+ **Method**：public void SetFaceMixTexture(Texture2D texture)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| texture | Texture2D | 合成材质球的面部底图 |


### 设置皮肤主纹理（设置合成纹理生成的结果）
:::tips
+ **Method**：public void SetSkinTexture(Texture2D texture)

:::

| 参数 | 类型 | 注释 |
| --- | --- | --- |
| texture | Texture2D | 皮肤主纹理 |


### 塌陷捏脸结果
:::tips
+ **Method**：public void GenerateResult()

:::

:::info
💡 调用改接口前确保没有动画播放，并且头部不能有位置偏移

:::

### 私有接口
### 创建自定义渲染纹理
:::tips
+ **Method**：private void CreateRenderTexture()

:::

### 刷新妆容纹理
:::tips
+ **Method**：private void RefreshMakeups()

:::

### 刷新面部材质球
:::tips
+ **Method**：private void RefreshMaterial(MakeupTexture makeupTex)

:::

### 注意事项




