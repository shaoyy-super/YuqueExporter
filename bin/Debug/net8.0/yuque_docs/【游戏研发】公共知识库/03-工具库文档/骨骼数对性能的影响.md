## 一. 简述
考虑到捏脸模型骨骼数增多有可能会影响到应用性能特别是是移动设备等性能欠优的设备，因此对捏脸模型以及原始模型进行对比分析确定性能影响的效果。

## 二.性能分析
首先在PC上进行性能分析，当场景中不存在任何角色模型时，其帧率在300~400徘徊，如下：

![](https://cdn.nlark.com/yuque/0/2024/png/29579282/1729848039917-564acca4-8dfb-4e17-931c-86fc7631c262.png)

然后我们在场景中首先放入100个捏脸模型，其帧率在100帧左右徘徊，如下：

![](https://cdn.nlark.com/yuque/0/2024/png/29579282/1729848123335-2e04085a-82dc-40e0-bc53-31ac8aaf46a6.png)

更换模型改用原始非捏脸模型，其帧率在115左右徘徊，如下所示：

![](https://cdn.nlark.com/yuque/0/2024/png/29579282/1729848294827-ea13aab5-2441-4ee5-9f58-038db458a1b0.png)

**<font style="color:#DF2A3F;">因此可得出结论，当模型数量同比设置为100时捏脸模型与原始模型在电脑上的性能差距仅15帧左右。</font>**

**当我们再将模型数设置为200时，其在电脑上的帧率如下（上面是捏脸模型，下面是原始模型）：**

![](https://cdn.nlark.com/yuque/0/2024/png/29579282/1729848524524-667550f0-44dd-487d-969b-0be747e49769.png)

![](https://cdn.nlark.com/yuque/0/2024/png/29579282/1729848567439-6eb5b4ff-a6a5-4124-8a7b-c3593c0532d8.png)

**<font style="color:#DF2A3F;">在模型数设置为200时，捏脸模型与原始模型其帧率相差仅为5~6帧，由此可知，捏脸模型增加了大量的骨骼确实会影响设备性能，但其对PC设备的影响非常小（100个模型差距在15帧左右，200个模型差距仅在6帧左右）</font>**

下面我们在移动设备上进行分析，首先是对帧率的分析，我们同样将捏脸模型数量设置为100，渲染数据如下所示：

![](https://cdn.nlark.com/yuque/0/2024/jpeg/29579282/1729849272988-b5dacedb-006a-4d59-a221-901648c7abb8.jpeg)

经过长时间的观察记录，在移动设备上其帧率绝大部分时间会稳定在20帧左右，偶尔会降到15帧或升到30帧。原始模型生成100个其帧展示如下：

![](https://cdn.nlark.com/yuque/0/2024/jpeg/29579282/1729849672097-91f43b73-ded8-4cca-ba33-9d50099074df.jpeg)

帧率同样也在20帧左右变化。

<font style="color:#DF2A3F;">100个捏脸模型与原始模型在移动设备上暂时看不出差别。</font>我们将数量提升到200个并进行对比：

![](https://cdn.nlark.com/yuque/0/2024/jpeg/29579282/1729849871581-01da69c1-334d-4634-8f3b-30e5bd9b5eae.jpeg)

![](https://cdn.nlark.com/yuque/0/2024/jpeg/29579282/1729849918443-ecacc53c-8f55-4f58-91b0-b902c36d5318.jpeg)

由于数量太多，移动设备在200个模型的帧率都在3~4帧左右徘徊。在<font style="color:#DF2A3F;">移动设备上通过帧率无法判断出差异。</font>

生成100个捏脸模型并在Profile进行分析，我们截取波峰的某一帧进行分析，如下：

![](https://cdn.nlark.com/yuque/0/2024/png/29579282/1729850361701-5b5daaef-a498-4505-b3d5-d79b2b250c4a.png)

其中耗时占比最高的渲染，其次是动画更新以及蒙皮网格的更新，渲染耗时30毫秒，动画更新Begin以及End共耗时18毫秒，蒙皮网格耗时9毫秒。

我们在截取波谷的一帧进行分析，如下：

![](https://cdn.nlark.com/yuque/0/2024/png/29579282/1729850732038-11b74a87-9d5d-4c90-892d-e9bbd2ad4735.png)

其中渲染耗时约为9毫秒，蒙皮网格的更新耗时约为6毫秒，动画更新begin以及end共耗时约为9毫秒

由此可见波峰以及波谷在渲染耗时，蒙皮网格更新耗时以及动画更新耗时都有可见的耗时差距，其中渲染耗时差距最明显。蒙皮网格和动画的耗时估计与Animator的具体动画的执行有关，不同帧动画对网格的改动不一样。

我们在对波峰波谷的渲染耗时相关展开进行对比分析，如下所示：

![](https://cdn.nlark.com/yuque/0/2024/png/29579282/1729851192193-f63e3ccb-3ef8-48bc-bbdd-fb12060d2749.png)

![](https://cdn.nlark.com/yuque/0/2024/png/29579282/1729851238535-fbc5e6d1-77aa-49b3-b65a-25fbf8360065.png)

由此可知波峰有一个日志的输出，其耗时在13毫秒左右，而波谷仅为1.6毫秒，由于在正式包中不应该会有日志耗时占比如此之大的情况，因此在实际正式包中渲染耗时波峰与波谷的差距为9~10毫秒。

我们在看下100个原始模型的Profile分析，截取一个波峰如下所示：

![](https://cdn.nlark.com/yuque/0/2024/png/29579282/1729851871590-eb773a53-b8d7-413c-b843-31e1f3961381.png)

可看出耗时占比的大头依然是渲染，蒙皮网格的更新以及动画的更新，耗时分别为34.5毫秒，7.6毫秒以及8毫秒。

在截取波谷进行分析，如下所示：

![](https://cdn.nlark.com/yuque/0/2024/png/29579282/1729852046325-19092bca-c171-47b1-95e8-e735d7a8f5e9.png)

波谷的渲染耗时约为13毫秒，蒙皮网格更新约为8毫秒，动画耗时约为7毫秒。

<font style="color:#DF2A3F;">可以看出对于原始模型来说波峰与波谷仅在渲染耗时这一项差距较大，蒙皮网格更新与动画更新差距微乎其微，而捏脸模型的波峰与波谷在蒙皮网格以及动画的耗时上是有可见的差距的。捏脸模型在动画以及蒙皮网格渲染与原始模型的耗时差距在波峰约为10毫秒，波谷约为4毫秒。由此可见捏脸模型在移动设备上同样会影响性能，但其在数量为100个的情况下与原始模型在波峰波谷的差距都在10毫秒之内，有影响，但影响不大。</font>

