### 基线
基线是从固定顶点开始，沿着表面连接到末端的移动顶点的路径

基线包含起点终点和深度信息

**骨布基线**

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721734515853-12b41d6e-bb53-49a3-8e48-cddb34bda028.png)

**网布基线**

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721734536497-48cda377-fe89-4ab7-b78c-b5bfebc76e5c.png)

<font style="color:#DF2A3F;">顶点深度</font>是一个重要指标，在角度限制中，可以限制基线边可以弯曲的角度，同样也适用于所有带有【C】按钮（曲线）设置的参数

### 布料类型（ClothType）
##### BoneCloth(骨布)
使用Transform通过移动和旋转变换执行布料模拟的机制，非常适合摇晃骨皮头发和配饰，工作负荷低

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721728735572-2cf7087e-befe-42f9-b2e3-508daf11ea63.png)

<font style="color:#333333;background-color:#FFFFFF;">需要在 RootBones 中注册要模拟的 Transform，仅注册作为层次结构起点的 Transform</font>

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721728819588-8f606d13-70c4-4480-8027-41e9543c9ef0.png)

比如：翅膀的层次结构如上图所示，注册的时候只需要注册左右两个根节点

<font style="color:#DF2A3F;">BoneCloth可以自动构建网格，形状维护和碰撞检测效果更好</font>

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721736574954-060af6fb-0c4f-4bda-a76e-737717ded07e.png)

自动网格，顺序循环网格，顺序不循环网格

##### MeshCloth(网布)
通过操纵网格顶点来表达抖动，网格不含骨头也可以使用，可以组合和模拟多个网格，但是<font style="color:#DF2A3F;">处理负载很高</font>

###### 目标模型的导入设置
想要网布正常工作的话，目标模型需要开启读写功能，关闭优化游戏对象

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721730314501-c1cb3039-237c-408d-8172-55b5d0cb9d6d.png)

###### 注册渲染网格
![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721730506776-e1e83590-8a32-480c-bc2e-fcbd9fbdb2e8.png)

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721730514440-f002fcd9-5162-4063-8899-d8844f020bb8.png)

可以注册多个渲染网格，所有渲染网格将合并到一个代理网格中

###### 简化代理网格控制参数
![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721730637716-063e5a62-fa94-4e64-a919-a5376266c6aa.png)

默认都是0，就是代理网格和渲染网格相同。简化代理网格可以提高模拟性能

SimpleDistance 只连接附近的顶点，不考虑网格结构

ShapeDistance 根据网格形状连接附近的顶点（未曲面连接的顶点即使在附近也不连接）

<font style="color:#DF2A3F;">代理网格应该被简化到渲染网格中没有细小的突起的程度，简化太多，不利于碰撞检测</font>

###### 通过纹理设置顶点属性
<font style="color:#DF2A3F;">只有MeshCloth可以通过纹理设置顶点属性</font>

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721734835986-b3b27fe2-bd20-4d1d-a41e-547aa3bdbe52.png)

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721734847169-d8c11972-6336-4d90-9704-6621117f5929.png)

<font style="color:#DF2A3F;">纹理格式限制：</font>

<font style="color:#333333;">必须打开纹理导入器的读/写检查</font>

<font style="color:#333333;">纹理大小64×64 或更少，最多 128×128，</font><font style="color:#333333;background-color:#FFFFFF;">1.     如果大小大于或等于 256 并且设置了 mipmap，则其中使用 128×128 或更小的 mipmap</font>

<font style="color:#333333;"></font>

##### BoneSpring(骨泉)
为transform提供弹簧效果，非常适合角色胸部摇晃，负荷低

详情参考Paremeters设置里面的Spring

##### 旋转控制：只适用于BoneCloth/BoneSpring
![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721731008727-6de7dc44-faec-4943-9370-3b880cd5229f.png)

**RootRotation根旋转**

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721731099994-8674e2cf-c719-48d5-8f65-2a3efe413438.png)

<font style="color:#333333;background-color:#FFFFFF;">固定属性顶点变换的旋转调整：</font>

<font style="color:#333333;background-color:#FFFFFF;">在</font><font style="color:#333333;background-color:#FFFFFF;"> 0.0 </font><font style="color:#333333;background-color:#FFFFFF;">时，它不会从原始姿势旋转。</font>

<font style="color:#333333;background-color:#FFFFFF;">在</font><font style="color:#333333;background-color:#FFFFFF;"> 1.0 </font><font style="color:#333333;background-color:#FFFFFF;">时，它沿子</font><font style="color:#333333;background-color:#FFFFFF;"> Transform </font><font style="color:#333333;background-color:#FFFFFF;">的方向旋转。如果有多个孩子，则将其平均</font>

<font style="color:#333333;background-color:#FFFFFF;">0.5介于两者之间</font>

**RotationInterpolation旋转插值**

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721731227739-d724c523-d2e8-458f-aaeb-50c421e5a2b2.png)

<font style="color:#333333;background-color:#FFFFFF;">运动属性顶点变换的旋转调整：</font>

<font style="color:#333333;">0.0</font><font style="color:#333333;">   </font><font style="color:#333333;background-color:#FFFFFF;">沿父</font><font style="color:#333333;background-color:#FFFFFF;"> Transform </font><font style="color:#333333;background-color:#FFFFFF;">的方向旋转。</font>

<font style="color:#333333;background-color:#FFFFFF;">在</font><font style="color:#333333;background-color:#FFFFFF;"> 1.0 </font><font style="color:#333333;background-color:#FFFFFF;">时，它沿子</font><font style="color:#333333;background-color:#FFFFFF;"> Transform </font><font style="color:#333333;background-color:#FFFFFF;">的方向旋转。如果有多个孩子，则将其平均</font>

<font style="color:#333333;background-color:#FFFFFF;">0.5介于两者之间。终端 Transform 始终朝向父级旋转，因为它没有子级</font>

### <font style="color:#333333;background-color:#FFFFFF;">UpdateMode更新模式设置</font>
![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721731421478-af2937c8-784c-46c2-a27b-0cf5f5b0d3e4.png)

一般设置为Animator Linkage，它会结合角色的Animator.UpdateMode自动设置适当的更新模式；如果当游戏因timescale=0而停止并且布料模拟应用于库存中的角色时，角色的Animator.UpdateMode需要设置为UnscaledTime，因为它不受unity的Time.timeScale的影响

### 动画姿势比例（Animation Pose Ratio）
![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721731512416-92380a4b-980e-4b62-8daf-d42bb5bfefbb.png)

作用是指定**某些约束**的恢复目标是初始姿势还是当前动画姿势的比例

**<font style="color:#333333;background-color:#FFFFFF;">初始姿势</font>**<font style="color:#333333;background-color:#FFFFFF;">是创建 MagicaCloth 组件时角色的姿势</font>

**<font style="color:#333333;background-color:#FFFFFF;">动画姿势</font>**<font style="color:#333333;background-color:#FFFFFF;">是不使用MagicaCloth 时 Transform 和 Mesh 的姿势</font>

**三个约束：角度恢复，角度限制，形状恢复**

值为0，则初始姿势为还原目标；为1，则当前动画姿势为还原目标

<font style="color:black;background-color:#FFFFFF;">设置准则：</font><font style="color:#333333;background-color:#FFFFFF;">基本上，将其保持在 0.0 是可以的。这是因为在大多数情况下，布料的运动更加稳定。</font>

<font style="color:#333333;background-color:#FFFFFF;">但是，如果动画姿态变形很大，则增加比例可能会更稳定。  
</font><font style="color:#333333;background-color:#FFFFFF;">此外，如果动画姿势完全由美术控制，则值越高越稳定。从大约 0.5 的设置进行调整。</font>

### <font style="color:#333333;background-color:#FFFFFF;">法线设置</font>
![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721731874338-2d1d9a3e-200d-4676-9406-f1143d6a00aa.png)

调整代理网格顶点的法线方向，**逆止器和弹簧**使用法线方向

Normal Axis 指定要用作法线的代理网格顶点的哪个轴

Normal Alignment 法线对齐方式（None不进行调整；Bounding Box Center从代理网格的边界框中心径向更改法线；Transform从中心径向修改指定的变换）

### 顶点属性绘制
顶点属性有三种类型：<font style="color:#DF2A3F;">固定属性</font>(红色；不可移动)<font style="color:#74B602;">移动属性</font>(白色，在绘制的时候是绿色；自由移动的顶点)<font style="color:#101E60;">无效</font>(黑色；模拟中忽略的顶点)

##### 手动修改顶点属性
![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721729607941-dddf6821-6b3a-414b-87ca-ee203c9901d7.png)

设置属性面板

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721729632353-64e8daf9-106e-40f7-88bd-ff2dc9ddc9f2.png)

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721729697819-c8c9651c-2ccd-4d4d-844f-3ac145fa63af.png)

### Paremeters设置
当一个复杂的Paremeters参数设置完成，想要复用，可以点击Save按钮，保存为参数预设，然后就可以在Preset下拉列表里面选中使用

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721729951487-a35aad9c-9168-4a1f-8e62-4f719604f684.png)

<font style="color:#DF2A3F;">重要参数首选：力，角度恢复，惯性</font>

##### Force：控制施加在整块布料上的力
![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721732276861-56d2d89a-9816-4a60-bdf6-9756d479c015.png)

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721732292391-ebd335bd-ec40-4eda-868a-896a7f1736f2.png)

##### Angle Restoration 角度恢复
**恢复边相对于基线的角度，它是最重要的参数之一，大部分运动都在这里决定**

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721732471119-ad6dbc89-a789-4a56-b45b-764713146409.png)

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721732479538-c5015443-17d5-4232-a5ca-77fbed6e4f75.png)

##### Angle Limit 角度限制
限制边相对于基线可以弯曲的角度

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721732662475-3e19fa99-0197-4b6f-aba2-660e77e20ec2.png)

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721732676106-a87b12e1-7e72-401c-882e-75ad79f81789.png)

##### Shape Restoration 形状恢复
**保持布料形状，基本上默认值，很少改动**

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721732788167-f52683dd-4299-40cd-98f2-0e760c430ec7.png)

距离刚度（Distance Stiffness）：作用是保持与其他连接顶点的距离，控制布料的弹性，拉伸

系绳压缩（Tether Compression）：限制顶点与其基线起点的接近程度

三角形弯曲刚度（Triangle Bending Stiffness）：这是MeshCloth保持形状的重要参数，基本设置为1.0

##### 惯性（Inertia）：惯性是角色的运动对布料顶点的影响
![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721732881809-cc9367ca-f1f9-4803-955d-74ba7d21c0e8.png)

惯性分为三个部分：锚点，世界，局部

锚点基本不用，主要说说世界空间和局部空间。

世界惯性是角色在世界中移动时具有的属性，行走奔跑乘坐车辆的速度等对布料的影响。可以调整平滑参数，缓解突然启动和停止带来动作不规范中断仿真问题

局部惯性是角色内部运动的影响，可以理解为角色自身的动画。一个MagicaCloth组件都有一个中心点，局部惯性是从这个中心点的运动来测量的。

<font style="color:#DF2A3F;">组件放置位置：直接放在角色gameobject下，因为世界惯性测量方法需要。</font>

##### 移动限制（Movement Limit）：逆止器
根据动画姿势顶点法线限制顶点可以移动的范围。防止布料进入人体，处理负荷低。

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721733182991-5d37e3e7-fc56-4e99-9a37-68137921de7c.png)

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721733197336-e04c7d02-2829-4be0-bbd9-db8e1ce33b4d.png)

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721733222858-55384e12-c337-43b7-8f4c-22129beab827.png)

顶点只能在最大距离范围内（<font style="color:#DF2A3F;">蓝色圈</font>）和逆止碰撞范围（<font style="color:#DF2A3F;">红色圈</font>）外移动。

面板上的<font style="color:#DF2A3F;">蓝色笔</font>标记，可以修改哪些顶点不受到限制。

##### 碰撞检测
###### 碰撞器碰撞
首先在需要碰撞检测的角色身体部位节点下创建适合的碰撞器

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721733383335-bbb07740-0993-434e-a011-c8ae406bf2b7.png)

然后设置碰撞器的参数，这个比较简单，跟unity的碰撞器类似，设置好之后把碰撞器注册到布料组件（添加到布料组件的ColliderCollision里面的ColliderList），未注册，碰撞器无法工作。

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721733417517-3c50785b-0081-4c1e-8b4c-777e54808d1a.png)

模式：点碰撞（顶点球体和碰撞体检测），边缘碰撞（网格边缘和碰撞体检测）

半径：顶点球体半径或者边的厚度

摩擦：高摩擦力可防止顶点滑动

<font style="color:#DF2A3F;">碰撞体列表：需要检测的碰撞体必须注册添加到这里面才可以生效</font>

<font style="color:#DF2A3F;">一般使用点碰撞，如果点碰撞出现了穿透问题，再考虑使用边缘碰撞。</font>

<font style="color:#DF2A3F;">如果是BoneSpring类型，则需要把执行碰撞检测的Transform注册到CollisionBones中，这样才会显示为填充球体。</font>

###### 自碰撞和相互碰撞
![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721733579316-7af1db06-a90f-4903-abee-c0cdd3e23e9b.png)

自碰撞意思是一块布料自身和自身碰撞，防止重叠渗透

相互碰撞是两块布料之间碰撞检测，防止相互交叉穿透

Self Mode 自碰撞

Sync Mode 相互碰撞

Sync Partner 相互碰撞的对象

Surface Thickness 表面厚度，用于碰撞检测的厚度，两边相加的厚度

Cloth Mass 布料质量，相互碰撞中，重量决定了谁移动的更多。

<font style="color:#DF2A3F;">自碰撞模块处于测试阶段，而且性能消耗很大（与代理网格中顶点数量成正比），容易产生震动，不建议使用。</font>

##### Spring
<font style="color:#DF2A3F;">产生弹簧的效果，只有BoneSpring可用，弹簧仅适用于固定属性顶点</font>

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721733742654-2c4c0152-c80f-4447-a165-6cb29dee1f76.png)

Spring Power弹簧强度

Limit Distance 限制距离，顶点可以从原点移动的最大距离

Normal Limit Ratio 法线限制比例，相对于法线方向的运动比例，与限制距离结合，可以把移动范围制作成椭圆。

Spring Noise 弹簧异步速率，当有多个spring加点异步，使表现各不相同

### Gizmo面板设置：场景视图辅助显示
##### 在场景视图中显示法线
![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721732080247-060a5c7c-db87-4a93-af03-074c56423311.png)

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721732089300-92d9e2a9-12d3-428a-86b2-90fc844598eb.png)

##### 查看动画姿势
![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721732158461-7ed0bfbc-2791-4057-b3a5-4c407becad8c.png)

##### 辅助显示
![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721733885393-b3ef9889-8155-49e5-bbe2-66f1da488345.png)

**Position** 显示顶点球体

**Axis** 显示顶点轴

**Shape** 用线条显示布料的形状

**Base Line** 基线

**Depth** 用数字方式显示顶点的深度

**Collider** 显示碰撞体

**Animated Position** 显示动画姿势的顶点

**Animated Shape** 用一条线显示动画姿势的形状

### Pre-Build预构建
执行布料模拟需要的数据，通常在运行时动态生成，需要时间，会产生延迟；可以做成预构建，保存为资源，就可以直接启动模拟，没有延迟

![](https://cdn.nlark.com/yuque/0/2024/png/46334471/1721734156607-d10fbbea-a761-46b7-ba87-d1d107552b56.png)

ID：用于识别的名称

Object：保存数据的资源对象

