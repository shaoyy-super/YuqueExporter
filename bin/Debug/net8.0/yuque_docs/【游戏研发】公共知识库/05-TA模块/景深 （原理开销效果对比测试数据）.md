

# **实现原理**
DepthOfField [http://flowingcrescent.net/en/%E3%80%90URP%20Shader%E3%80%91Depth%20of%20Field%20-%20%E6%99%AF%E6%B7%B1/](http://flowingcrescent.net/en/%E3%80%90URP%20Shader%E3%80%91Depth%20of%20Field%20-%20%E6%99%AF%E6%B7%B1/)

可模拟摄像机镜头的焦点属性。在现实生活中，摄像机只能在特定距离的对象上清晰聚焦。距离摄像机更近或更远的对象会失焦。这种模糊效果提供了关于对象距离的视觉提示，并引入了“散景”，这是一种视觉瑕疵，出现在图像失焦的明亮区域周围。



![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1718697415655-7ba3a04b-ab1a-48f3-be5e-c4759e2cf8ff.png)





# **资源消耗**
## **1.DepthOfField(Boken)**
### **RT需求**
| **名称** | **分辨率** | **格式** |
| :--- | :--- | :--- |
| _FullCocTexture | 全屏 | R8_UNorm |
| _PingTexture | 全屏/2 | R16G16B16A16_SFloat |
| _PongTexture | 全屏/2 | R16G16B16A16_SFloat |


### **DrawCall****需求**
| **名称** | **功能** |
| :--- | :--- |
| DC1 | BokenDepthOfFieldCoc _CameraDepthTexture->_FullCocTexture |
| DC2 | BokenDepthOfFieldPrefilter _CameraColorTexture,_FullCocTexture->_PingTexture |
| DC3 | BokenDepthOfFieldBlur _PingTexture->_PongTexture |
| DC4 | BokenDepthOfFieldBlur _PongTexture->_PingTexture |
| DC5 | BokenDepthOfFieldComposite _PingTexture,FullCocTexture,_CameraTexture->_TempTarget |


### **复杂度**
| **Pass** | **Mali-G72(970)** | **Mali-G78(9000)** | **Bound** |
| :--- | :--- | :--- | :--- |
| BokenDepthOfFieldCoc | 1.08 | 0.36 | A |
| BokenDepthOfFieldPrefilter  | 2.08 | 0.54 | T(4) |
| BokenDepthOfFieldBlur  | 6.27 | 1.91 | A/LS |
| BokenDepthOfFieldComposite  | 1.8 | 0.29 | T(3) |




## **2.DepthOfField(Gaussian)**
### **RT****需求**
| **名称** | **分辨率** | **格式** |
| :--- | :--- | :--- |
| _FullCocTexture | 全屏 | R16_UNorm |
| _HalfCoCTexture | 全屏/2 | R16_UNorm |
| _PongTexture | 全屏/2 | B10G11R11_UFloatPack32 |
| _PingTexture | 全屏/2 | B10G11R11_UFloatPack32 |


### **DrawCall****需求**
| **名称** | **功能** |
| :--- | :--- |
| DC1 | GaussianDepthOfFieldCoc _CameraDepthTexture->_FullCocTexture |
| DC2 | GaussianDepthOfFieldPrefilter _CameraColorTexture,_FullCocTexture->_HalfCoCTexture |
| DC3 | GaussianDepthOfFieldHorizontal _PingTexture,_HalfCoCTexture->_PongTexture |
| DC4 | GaussianDepthOfFieldVertical _PongTexture->_PingTexture |
| DC5 | GaussianDepthOfFieldComposite _PingTexture,FullCocTexture,_CameraTexture->_TempTarget |


### **复杂度**
| **Pass** | **Mali-G72** | **Mali-G78** | **Bound** |
| :--- | :--- | :--- | :--- |
| GaussianDepthOfFieldCoc | 1 | 0.23 | A,T(1)/V,T(0.25) |
| GaussianDepthOfFieldPrefilter  | 0.58 | 0.23 | T(2) |
| GaussianDepthOfFieldHorizontal /GaussianDepthOfFieldVertical | 2.5 | 1.91 | T(3)? |
| GaussianDepthOfFieldComposite  | 1.67 | 0.47 | T(3) |




# **画面对比**
## **景深**
![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1718697518429-4781a94e-1cd9-4827-9103-b8aada7125e2.png)

![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1718697523564-101f4357-57a0-48ca-856e-09a6bbf99dd5.png)

高

![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1718697543234-6d371b8c-1302-40c3-8137-0ed43aeba4b6.png)

中，低

![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1718697550581-0681184f-72e3-4781-813a-9bedb1289478.png)

关闭

![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1718697553929-ffa63951-8f39-46a5-bdb2-aedcf26cb96d.png)



# **帧率对比****(****测试场景****)**
### **小米****11**
![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1718697314747-266766c9-f76a-423f-b07f-955b05fd1dc3.png)

| 景深 | FPS（1min,avg） | 帧率时间（ms） | 增加耗时（ms） |
| :--- | :--- | :--- | --- |
| 关 | 48.657 | 20.6 |  |
| 中，低 | 44.376 | 22.5 | 1.9 |
| 高 | 43.173 | 23.2 | 2.6 |


