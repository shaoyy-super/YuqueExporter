# **<font style="color:#1a1a1a;">目标</font>**
<font style="color:#333333;">1. 因同时开展项目偏多，需要减少美术工作量，确保</font>**<font style="color:#333333;">一次生产可在多处工程、不同需求中使用</font>**<font style="color:#333333;">，所以特别规范了新的贴图相关制作流程。</font>

<font style="color:#333333;">2.</font><font style="color:#333333;"> </font><font style="color:#333333;">Unity中的角色着色器需要获取4张遮罩Mask以及对应的材质贴图及参数来支持</font>**<font style="color:#333333;">按部位染色</font>**<font style="color:#333333;">。四张遮罩Mask对应三种特殊材质和一种基本材质。</font>

<font style="color:#333333;">因此需要约定一套从生产到使用的贴图及着色规范，美术按照规范为一个模型仅产出一套贴图及材质参数文件，这份材质可确保兼容所有使用了自研渲染库的Unity工程，且同时不过度损失渲染效果或性能。</font>

<font style="color:#333333;"></font>

# <font style="color:#333333;">贴图标准</font>
| <font style="color:#000000;">高（染色）</font> | **<font style="color:#000000;">高精度，适用高模8-12w面</font>** | |
| :--- | --- | --- |
| <font style="color:#000000;">基础颜色</font> | <font style="color:#000000;">Color2，仅不染色区域可采用颜色贴图</font> | |
| <font style="color:#000000;">基础法线</font> | <font style="color:#000000;">nrm2，包含不染色区域法线及模型法线</font> | |
| <font style="color:#000000;">AO</font> | <font style="color:#000000;">AO，不区分区域，整体AO</font> | |
| <font style="color:#000000;">区域Mask</font> | <font style="color:#000000;">Mask1+2+3+4，三个染色区域+不染色区域</font> | |
| <font style="color:#000000;">基础粗糙度</font> | <font style="color:#000000;">不染色区域采用贴图，与AO、金属度并在一张贴图</font> | |
| <font style="color:#000000;">基础金属度</font> | <font style="color:#000000;">不染色区域采用贴图，与AO、粗糙度并在一张贴图</font> | |
| <font style="color:#000000;">材质1 2 3 Detail法线</font> | <font style="color:#000000;">把sp里用的材质导入到unity，用同样的参数生成</font> | |
| <font style="color:#000000;">Detail法线Tiling</font> | <font style="color:#000000;">用工具自动生成材质设置上去</font><font style="color:#000000;"> (</font><font style="color:#000000;">Tiling是指Properties-Fill里的uv transormations</font><font style="color:#000000;">)</font> | |
| <font style="color:#000000;">材质1 2 3 金属度</font> | <font style="color:#000000;">用属性调整，自动设置</font> | |
| <font style="color:#000000;">材质1 2 3 粗糙度</font> | <font style="color:#000000;">用属性调整，自动设置</font> | |
| <font style="color:#000000;">材质1 2 3 颜色</font> | <font style="color:#000000;">用属性调整，自动设置</font> | |
| <font style="color:#000000;">低（染色）</font> | **<font style="color:#000000;">低精度A，适用中模1.5-2w面</font>** | |
| <font style="color:#000000;">基础颜色</font> | <font style="color:#000000;">Color2，仅不染色区域可采用颜色贴图</font> | |
| <font style="color:#000000;">基础法线</font> | <font style="color:#000000;">合并Normal，合并模型法线及各区域法线到一起</font> | |
| <font style="color:#000000;">AO</font> | <font style="color:#000000;">AO，不区分区域，整体AO</font> | |
| <font style="color:#000000;">区域Mask</font> | <font style="color:#000000;">Mask1+2+3+4，三个染色区域+不染色区域</font> | |
| <font style="color:#000000;">基础粗糙度</font> | <font style="color:#000000;">不染色区域采用贴图，与AO、金属度并在一张贴图</font> | |
| <font style="color:#000000;">基础金属度</font> | <font style="color:#000000;">不染色区域采用贴图，与AO、粗糙度并在一张贴图</font> | |
| <font style="color:#000000;">材质1 2 3 金属度</font> | <font style="color:#000000;">用属性调整，自动设置</font> | |
| <font style="color:#000000;">材质1 2 3 粗糙度</font> | <font style="color:#000000;">用属性调整，自动设置</font> | |
| <font style="color:#000000;">材质1 2 3 颜色</font> | <font style="color:#000000;">用属性调整，自动设置</font> | |
| <font style="color:#000000;">面向外部着色器（不可染色）</font> | | **<font style="color:#000000;">低精度B，适用低模8000面</font>** |
| <font style="color:#000000;">基础颜色</font> | <font style="color:#000000;">合并Color，整体颜色贴图</font> | |
| <font style="color:#000000;">基础法线</font> | <font style="color:#000000;">合并Normal，整体法线贴图</font> | |
| <font style="color:#000000;">AO</font> | <font style="color:#000000;">AO</font> | |
| <font style="color:#000000;">粗糙度</font> | <font style="color:#000000;">合并粗糙度，整体粗糙度贴图</font> | |
| <font style="color:#000000;">金属度</font> | <font style="color:#000000;">合并金属度，整体金属度贴图</font> | |




# 流程
1. 确定模型角色和相关材质需求；
2. 使用SD生成相关材质，SD材质可存入SD资产库；
3. 在SP中使用SD导出的材质制作贴图并调整参数；
4. 在SP中确认模型最终材质效果，然后使用SP插件导出材质参数和贴图文件；
5. 将SP导出的文件拖入Unity项目中，Unity将会自行生成对应的材质球；
6. 将Unity自行生成的材质球放到模型身上，确认效果。



# 涉及工具及要求
1. 使用**SD生成特殊材质**时，需要具备以下特征（SD具体操作可见[Substance Designer简要介绍及操作说明](https://snh48group.yuque.com/org-wiki-snh48group-ec9yge/wxfe39/ggvwzokzs6lifg48?singleDoc#) ）：
    1. 公开三项必备参数，包括：
        1. Color（用于调整颜色），
        2. Metallic（用于调整金属度，没有金属度贴图），
        3. Roughness（用于调整粗糙度，没有粗糙度贴图）。
        4. （可选）Opacity （用于半透明材质）
    2. 可以公开其他参数，如AO强度等，但不能公开影响颜色的参数，如对比度等。
    3. 必须包含以下输出通道：
        1. basecolor（已经应用上Color属性的通道贴图），
        2. basemap（尚未应用Color属性的贴图，偏白色，类似灰度图）。用同样的材质节点，输出两个通道，一个应用颜色，另一个没有应用颜色。
        3. normal（法线）
        4. metallic
        5. roughness
    4. 后续需将SD材质存档成SD材质库。



2. 使用**SP制作贴图**时，需要按照下述说明操作（细节可参考[Substance Painter插件说明及贴图制作注意](https://snh48group.yuque.com/org-wiki-snh48group-ec9yge/wxfe39/ipry1w4ddkq3o9gr?singleDoc#) ）：
    1. 将SP插件说明文档里的plugins.zip下载后解压到：

> C:\Users\{User}\Documents\Adobe\Adobe Substance 3D Painter\python\plugins
>
> {User}是电脑的用户名，不同电脑，用户名各不相同。
>

然后打开SP，点击SP左上角Python栏目，勾选上export_materials，确认安装上SP插件。

    2. 新建SP项目，NormalMapFormat选择OpenGL。建立完成后点击SP左上角的Edit栏目，再点击里面的“自动设置项目初始配置”功能。该功能会自动为新项目设置必需的额外通道和图层结构。
    3. 在自动设置好的图层内按需绘制贴图，调整参数。注意不要删除自动设置出来的原始图层，可以在每组原始图层的下方新增自己需要的图层。
    4. 完成贴图绘制，确认好效果后，点击SP左上角的File栏目，再点击“导出贴图及材质信息”来导出相关文件。



3. Unity上会有一个工具脚本叫**SPMaterialPostprocessor.cs**来负责**自动解析用户导入到Unity的SP材质**文件，并生成对应材质球。之后需要用户自行将材质球应用到模型上。
    1. 脚本已集成在com.ut.rendering渲染库中，使用Unity Package Manager安装该插件即可。
    2. 该脚本目前支持自动解析SP材质文件成高配、低配、通用不染色材质。如下图所示，在SP生成的文件内，同时选中一个贴图文件夹及json文件，并将其拖进Unity Assets内即可。
        1. DyeingTextures：染色功能对应的贴图文件夹；
        2. GeneralTextures：无染色需求对应的贴图文件夹；
        3. URPTextures：提供给URP/Lit的贴图文件夹，与SP给URP用的预设相似。
    3. 目前支持自动识别拖进来的json文件和贴图文件夹，并覆盖当前文件夹内的同名文件，并更新相应材质球参数及贴图。主要目的是方便美术替换资产及调试。

![](https://cdn.nlark.com/yuque/0/2024/png/1660870/1724936060065-f0d8459b-5f5f-4136-8526-be2e8c5b7eee.png)



4. **Unity会有相关着色器**，支持使用SP导出的材质文件，并复刻在SP中的材质效果，如染色等。
    1. 高配染色：URP/UT/Character/Cloth_Dyeing_Lit；
    2. 低配染色及内部通用不染色使用：URP/UT/Character/Cloth_Dyeing_Low_Lit；
    3. 外部通用：Universal Render Pipeline/Lit；

具体介绍请见[UTRendering衣服着色器介绍](https://snh48group.yuque.com/org-wiki-snh48group-ec9yge/wxfe39/ow3zist90iyqzva0?singleDoc#)。

![](https://cdn.nlark.com/yuque/0/2024/png/1660870/1724054262356-69277dcd-57ad-4c39-be3d-a666a0096477.png)



在**内网**用文件浏览器访问如下目录获取**SP测试项目**、**SP插件脚本**，以及**Unity插件脚本**及**着色器**：

+ "\\192.168.0.231\AI及Web3游戏研发中心\公共资源\05_美术资料\贴图制作流程材料\"



# 参考
初期调研历史可见[贴图制作流程梳理](https://snh48group.yuque.com/org-wiki-snh48group-ec9yge/wxfe39/fs26sfyp5goilk7k)

1. [Substance Designer简要介绍及操作说明](https://snh48group.yuque.com/org-wiki-snh48group-ec9yge/wxfe39/ggvwzokzs6lifg48?singleDoc#)
2. [Substance Painter插件说明及贴图制作注意](https://snh48group.yuque.com/org-wiki-snh48group-ec9yge/wxfe39/ipry1w4ddkq3o9gr?singleDoc#)
3. [UTRendering衣服着色器介绍](https://snh48group.yuque.com/org-wiki-snh48group-ec9yge/wxfe39/ow3zist90iyqzva0?singleDoc#)

