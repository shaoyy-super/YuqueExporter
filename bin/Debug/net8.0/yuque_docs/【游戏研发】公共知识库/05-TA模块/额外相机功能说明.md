额外场景/Boss演出的预制件中加入RtCamera预制件，CameraSwitchCtr脚本启用时会接管或附加新的相机逻辑

![](https://cdn.nlark.com/yuque/0/2025/png/45354151/1736487993525-256ffd82-ce29-4b4e-8574-6e470da8f34b.png)



## 基础参数说明
**Has Transparency:  **是否需要看到渔场（是否完全切换至新场景）  
**Has Rt Camera:  **是否使用了Rt Camera（兼容现有使用RT做法的Boss，后面会移除）  
**Render URP Shadow:  **是否需要使用URP阴影  
**Custom Scene Light:**  自定义角色主光（后面改用Environment Volume控制）  
**Rt Camera:  **Rt相机，后更改为需要看到渔场情况下的额外相机  
**Visual Camera:  **相机轨迹  
**Volume Mask:**  相机使用的后效层，一般使用PostProcess_03  
**Culling Mask:  **相机的可见层，一般使用Scene02, Character_RT和EffectSkill(待定，大概会冲突，后面换新的)  
**Camera Clear Flags:  **需要使用天空盒时更改为skybox  
 

## 情况一：完全切换场景
eg. 石像，冰龙

### 制作流程：
1. 拖入RtCamera预制件
2. 设置Virtual Camera，Volume Mask 和 CullingMask
3. 按需设置 Render URP Shadow 和 Camera Clear Flags

即可正常预览与制作



## 情况二：需要看到背景的渔场
eg. 女巫

### 制作流程：
1. 拖入RtCamera预制件
2. 开启Has Transparency，设置RtCamera，Virtual Camera，Volume Mask 和 CullingMask



**<font style="color:#DF2A3F;">需要保证模型全程位于渔场MainCamera的视锥范围内</font>**

程序需求，制作预览时使用MainCamera，游戏中Virtual Camera控制RtCamera，RtCamera仅用于数据获取，实际不渲染





------------------------------------------------- 分割线----------------------------------------------------------



## 可能问题梳理&解决思路
目前做法：

！Has Transparency，直接调整MainCamera；

Has Transparency，RenderFeature添加Pass调整VP矩阵额外渲染



### Case 1，两种情况共存:
**Q1: 情况二的附加渲染内容会叠加在情况一额外场景上**

类似自阴影脚本那样在CameraSwitchCtr启用时注册到RenderFeature，当有一个CameraSwitchCtr的Has Transparency为False时，就不加入Pass；但因为Layer相同的原因，MainCamera还是可能会看到其他Boss演出的内容，解决方法:1. 额外场景生成时远离渔场位置，2. 添加新Layer Cull掉



### Case 2，复数情况一（多个额外场景）:
设计上应该不会出现......大概



### Case 3，复数情况二:
Pass中根据启用了Has Transparency的CameraSwitchCtr数量循环绘制

**Q1: 每次绘制时如何排除其他的物体**

1. 添加更多layer，程序生成时动态分配，每次循环用不同的filter做剔除
2. 保持layer不变，想想其他办法来做剔除（传Renderer?）

**Q2：Boss穿插**

1. 每次循环都清深度，排序通过插入顺序和priority决定，后续类似景深这种会用到深度的后效会有问题‘
2. priority + Stencil，半透可能有问题，或者得不透半透拆分出来分别渲染

**Q3：和场景物体穿插**

1. 基于Q2的选择采用对应的方案，不过就算用了stencil保险起见还是得清一遍depth?

