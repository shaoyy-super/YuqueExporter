放到CharacterFeature/ShadowFeaure内管理（如果盘下来阴影相关内容较多的话，参考Nilo对于阴影也是新开了一个Volume管理的）





已知角色需求：

1. URP阴影？（全局，低精度）
2. 角色自阴影（多人）



问题：

1. 环境光有：主光，补光，都需要投影？
2. 角色自阴影的模式（参考FA/参考级联）
3. 使用角色自阴影后与URP阴影关系的处理，怎么融合
4. 角色自阴影，多人情况下的范围设置（精度设置？如何与Volume/Feature建立关联）
5. 以上的高中低配置



FA中自阴影Pass仅计算角色的阴影，角色不通过URP投影且不接受URP投影，目前的想法是自阴影动态范围的计算方式还是参考FA自阴影方式，但会渲染范围内所有物体的阴影（类似级联？），然后与URP投影进行融合（需要考虑融合方式）



**case1：角色为主，单角色 eg.ying舞团**

由于主要表现一个主角，性能可以倾斜在角色上：

配置：

远景（如果有）：烘焙

角色&近景：不接收URP阴影（主光），角色自阴影参考FA，以玩家角色为中心划分一个范围进行阴影渲染，移除多人情况的相关设置，或许需要考虑多光源





**case2: 固定场景与角色，eg.山海（战斗），box（舞台）**

eg.山海战斗场景类似

![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1720081256692-6795b99c-f5e3-4377-8102-81ecaf516e1c.png)



![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1720081578087-4c6b2c8b-92f5-4385-996f-433df4634b57.png)

设想做法：因为战斗场景的大小以及角色位置固定，参照FA自阴影设置根据动态计算阴影范围，将主要角色全部纳入其中

战斗区域外的观众作为次要因素，仅使用URP阴影（如果糊的没法看的话就考虑，把自阴影做在贴图上或者直接G掉）

Box（舞台）因为范围固定，同理







**case3: 开放场景&未知的角色情况：eg.山海（探索）**

情景分析：未知变量多，无法确定游戏视角内的角色数量以及位置情况，不适宜用动态计算自阴影范围的方式



参考绝区零主城做法：

[video(1).mp4](https://snh48group.yuque.com/attachments/yuque/0/2024/mp4/45354151/1720144694914-04f82660-93cd-474f-9890-05a9c8a22a10.mp4)

[video.mp4](https://snh48group.yuque.com/attachments/yuque/0/2024/mp4/45354151/1720144887212-103056b0-76d8-4be6-a966-4c9af17004c0.mp4)

场景应该是纯烘焙的，远处的角色不投影，进入一定范围后开始投影，但较主角的阴影精度低一档（或者几档？），等走到主角附近一定范围时精度才会提高，根据距离大概的变化过程为 无 -> 糊 ->清晰



设想1：场景纯烘焙，去除URP阴影，仅角色附近一定范围内计算动态阴影，超出范围不计算，范围边缘做渐变防止硬切（问题，有时间变换就G）

设想2：在1的基础上保留部分URP阴影功能（仅计算动态物体阴影），然后也得考虑两种阴影的融合问题

（以上需测试范围&精度）

按照上面的方案，box多人场景需要测试远景（范围外）角色的美术效果能否接受























































































