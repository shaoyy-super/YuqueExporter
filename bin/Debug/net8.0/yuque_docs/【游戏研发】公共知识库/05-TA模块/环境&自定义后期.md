**<font style="color:#DF2A3F;">以下默认仅对UT材质有效（除环境光相关设置）</font>**

# 使用前置
![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1730111474689-c04c5359-6c2a-4de1-a35c-1374a3111a3a.png)

在SceneRenderer中加入Environment All In One Feature，并为CustomSSAO的Blue Noise 256 Textures中插入如图8张Noise图

**Radius Factor: **SSAO 检测半径倍率，镜头拉近时同步减少半径倍率，使SSAO表现不会过“脏”，由程序控制调整



**Use Pixel Fog：**启用后雾效转至片元计算，临时做法，后续会移除



# 功能&使用说明
![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1730112594782-3608fd89-2daf-471b-8127-5e660394e471.png)

在GlobalVolume中由 Add Override -> UT.Rendering -> EnvironmentVolumeControl添加环境功能控制组件

![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1730112744578-77ca61d9-42ef-40a9-939f-c9a8e8a808ae.png)

目前共有CustomSSAO，雾效，环境灯光参数三块内容



## 2.1 CustomSSAO
![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1730114308998-96a45387-ffd0-483a-ac16-a5fcc1389fac.png)

**参数说明：**

**总控开关：**启用后开启Custom SSAO功能，并显示对应参数面板

**AO生成方法：**Blue Noise: 使用噪声图计算； Interleaved Gradient: 使用线性渐变；性能方面考虑，推荐使用线性渐变

**降采样：**默认开启，开启后使用低一倍的分辨率进行SSAO相关计算，性能友好，推荐保持开启，并且在Interleaved Gradient模式下可以使效果更柔和

**不透明之后计算：**关闭时会申请Depth PrePass或DepthNormal PrePass，在材质的光照计算阶段进行SSAO的计算，效果更好但开销很高，**<font style="color:#DF2A3F;">只有目标平台是PC时允许使用</font>**；开启时会使用深度缓冲来还原世界空间法线，类似后处理的做法，性能上相对友好

**深度来源：**不透明之后计算关闭时可用，选择申请Depth PrePass或是DepthNormal PrePass

**法线采样质量：**

**强度：**

**直射光强度：**不透明之后计算关闭时有效，可以打亮向光处的SSAO

**半径：**视觉上来看就是SSAO生效的范围

**采样质量：**

**噪声质量：**等级越低，SSAO颗粒感越明显

**衰减：**SSAO强度会随着与相机距离的增加而减小，该值用于控制最大衰减距离



## 2.2 雾效
![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1730169791418-2b795e93-b87a-4bb8-acd3-affc32f78317.png)

![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1730168238214-9616a54b-9691-4531-9651-5703fbdd0200.png)

**参数说明：**

<font style="color:#DF2A3F;">（注：如果SceneRenderer没有开Use Pixel Fog，且模型体积较大又顶点数很少的话，雾效渐变和衰减效果会较差）</font>

**总控开关：**启用后开启雾效功能，并显示对应参数面板

**雾效强度：**雾效密度，值越小相机到最大雾效的距离就越远，用于雾的浓淡程度

**雾效强度限制最大值：**用于限制 雾效强度 参数的最大值（感觉有点鸡肋，后续可能会优化掉）

**上半部分雾效透明度：**

**下半部分雾效透明度：**

**高度：**雾效生效的最大高度（世界空间），超过部分雾效不生效

**高度衰减：**用于控制最大高度附近有雾效与无雾效区域过渡的柔和程度，值越小过渡范围越大，过渡越柔和，不可低于0

**上半部分雾效颜色：**

**下半部分雾效颜色：**

**上半部分渐变：**上半部分雾效起始高度

**下半部分渐变：**下半部分雾效最大高度

![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1730170009923-b8864dbe-1bb5-481d-9eb3-8ed716634810.png)

两个值之间的范围为过渡区域

**基于Camera计算的雾效衰减距离：**与相机距离小于该值时，雾效强度会随距离减小逐渐衰减至0，模拟雾效随距离增加变浓的效果



## 2.3 环境光设置
![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1730170465061-1f2a010b-882f-4e08-a617-e8b82c19c2c4.png)

同Window -> Rendering -> Lighting的环境参数设置，此处设置的参数会同步到Lighting

![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1730170536855-c9e090f5-0cec-412d-9a32-5d988ea8b171.png)



差别是多了一个**改写阴影最大距离**参数，可以调整URP阴影的生效范围



# 注意事项：
### 3.1 多个Volume情况
![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1730170754265-6f3d3c0c-a4a5-4c9c-893c-06e12cd664e4.png)

场景内存在多个Volume时，会使用高优先级的Volume中的参数

![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1730102294158-629b4caa-9952-45a8-83b2-ce667cd26624.png)

若高优先级的Volume中的参数未开启重载，则会依次使用更低一级的Volume中的参数设置

