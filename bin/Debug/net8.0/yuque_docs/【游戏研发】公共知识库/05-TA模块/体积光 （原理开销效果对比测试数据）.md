

# **实现原理**
VolumetricLight [https://zhuanlan.zhihu.com/p/425495211](https://zhuanlan.zhihu.com/p/425495211)

体积光（Volumetric Light）是一种很吸引眼球、很能表现氛围、看起来很高级的效果，也被称为天光（GodRay）。体积光的物理原理是丁达尔效应：当光透过胶体时，会被悬浮在胶体中的粒子散射，出现一条光亮的“通路”。因为空气中悬浮的灰尘、水滴等杂质直径大于入射光波长，满足胶体的条件，所以太阳光穿过空气时会出现体积光效果。

![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1718697190148-d4d31134-12e3-4494-b2fb-0a445ee42627.png)

![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1718697205853-59226fd9-c885-4ae8-852a-7a92ddb6f65c.png)



1.全屏drawcall，需要重建世界坐标，从相机发出射线到该可见点分段进行计算光衰减，散射，透光比然后叠加。

2.将上一步RT做一个均值模糊叠加颜色RT

射线的步进次数是可配置

![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1718697220580-22af3a94-57ba-4206-806c-0d22d4a4908c.png)





# **资源消耗**
## **VolumetricLight**
### **RT****需求**
| **名称** | **分辨率** | **格式** |
| :--- | :--- | :--- |
| TempRT | 全屏 | B10G11R11_UFloatPack32 |
| _SampleMap | 全屏 | R16_UNorm |


### **DrawCall****需求**
| **名称** | **功能** |
| :--- | :--- |
| DC1 | BlitCopy _CameraColorTexture->TempRT |
| DC2 | VolumetricPostProcess _CameraDepthTexture,ShadowMap->_SampleMap |
| DC3 | VolumetricAdditivePass TempRT, _SampleMap->_CameraColorTexture |


### **复杂度**
| **Pass** | **Mali-G72(970)** | **Mali-G78(9000)** | **Bound** |
| :--- | :--- | :--- | :--- |
| BlitCopy | 0.5 | 0.09 | T(1) |
| VolumetricPostProcess | 5.33 | 1.57 | A |
| VolumetricAdditivePass | 1.17 | 0.41 | T(10) |






# **画面对比（包含帧率）**
开体积光

![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1718697273449-f019a35b-e9b9-4245-93e6-b58706b3cebd.png)

关体积光

![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1718697277615-34baefa5-8fd3-40f9-91d5-a178455c680a.png)





# **帧率对比****(****测试场景****)**
### **小米****11**
![](https://cdn.nlark.com/yuque/0/2024/png/45354151/1718697314747-266766c9-f76a-423f-b07f-955b05fd1dc3.png)

|  | FPS（1min,avg） | 帧率时间（ms） | 增加耗时（ms） |
| --- | :--- | :--- | --- |
| 默认 | 49.957 | 20 |  |
| ssao开 | 24.076 | 41.5 | 21.5 |
| 体积光开 | 34.273 | 29.1 | 9.1 |
| 全开 | 19.432 | 51.4 | 31.4 |


