# **<font style="color:#1a1a1a;">目标</font>**
<font style="color:#333333;">1.</font><font style="color:#333333;"> </font><font style="color:#333333;">因同时开展项目偏多，需要减少美术工作量，确保</font>**<font style="color:#333333;">一次生产可在多处工程、不同需求中使用</font>**<font style="color:#333333;">，所以特别梳理一下贴图相关制作流程。</font>

<font style="color:#333333;">2.</font><font style="color:#333333;"> </font><font style="color:#333333;">Unity中的角色着色器需要获取4张遮罩Mask以及对应的材质贴图及参数来支持</font>**<font style="color:#333333;">按部位染色</font>**<font style="color:#333333;">。四张遮罩Mask对应三种特殊材质和一种基本材质。</font>

<font style="color:#333333;">首先</font><font style="color:#333333;">需要</font><font style="color:#333333;">约定一套从生产到使用的</font><font style="color:#333333;">贴图及着色</font><font style="color:#333333;">规范，原画按照规范为一个模型产出一套贴图及材质参数文件，这份材质可确保兼容所有符合规范的Unity工程，且同时不过度损失渲染效果或性能。</font>

# **<font style="color:#1a1a1a;">流程</font>**
#### **<font style="color:#333333;">SDK及工具方面</font>**
<font style="color:#333333;">1.</font><font style="color:#333333;"> </font><font style="color:#333333;">按照约定规范使用SD生成三种不同类型的材质，方便后续美术导入SP中据此来绘制贴图（</font><font style="color:#000000;">美术可以随时自行生成新材质，确保符合约定的规范</font><font style="color:#333333;">）；</font>

<font style="color:#333333;">2.</font><font style="color:#333333;"> </font><font style="color:#333333;">在SP中制作一个插件用于导出不同标准的贴图以及对应的材质参数json文件。</font><font style="color:#333333;">三套，分为高</font><font style="color:#333333;">（</font><font style="color:#333333;">染色</font><font style="color:#333333;">）</font><font style="color:#333333;">、低（染色）、以及 低（不染色）</font><font style="color:#333333;">；</font>

<font style="color:#000000;">3.</font><font style="color:#000000;"> </font><font style="color:#333333;">在Unity中按照约定规范</font><font style="color:#333333;">编写</font><font style="color:#333333;">相应的着色器，该着色器除了常见通道外，还需要有额外</font><font style="color:#333333;">的</font><font style="color:#333333;">通道及参数来支持SD的</font><font style="color:#333333;">三种特殊材质及基本材质（因为有3个特殊槽，如果不同材质两两组合，变体数会过多，那需要拆UV来实现吗）</font><font style="color:#333333;">；</font>

<font style="color:#000000;">4.</font><font style="color:#000000;"> </font><font style="color:#333333;">在Unity中制作</font><font style="color:#333333;">一个工具脚本来实现：导入材质贴图及参数文件包到Unity后，自动解析文件并生成对应材质到文件夹下</font><font style="color:#333333;">。</font><font style="color:#333333;">（目前确认是导出文件包中，按三套配置分文件夹，由美术自行确认如何使用该套文件。除了最低配那套，Unity工具脚本应当支持自行分辨可染色的高配或低配）</font>

#### **<font style="color:#333333;">美术方面</font>**
1. <font style="color:#000000;">美术</font><font style="color:#333333;">在SP中使用SD的三种材质及其他材质绘制相关贴图；</font>
2. <font style="color:#000000;">美术</font><font style="color:#333333;">将SP既作为生产环境也作为LookDev环境，来进行最终渲染效果的参数调整和确认（后续需要在SP中编写类似Unity的PBRshader来确保SP中的渲染效果和Unity相近 ）；</font>
3. <font style="color:#333333;">使用插件从SP导出确认了最终渲染效果的材质贴图及参数文件。</font>
4. <font style="color:#333333;">交付材质贴图及参数文件包，由相关人员将此文件包导入到Unity客户端中检查。</font>

# **<font style="color:#1a1a1a;">关键环节</font>**
#### **<font style="color:#000000;">1. SD材质标准 - 支持染色的材质</font>**
<font style="color:#000000;">每种材质需要具备以下特征：</font>

<font style="color:#000000;">基础颜色偏白，用颜色参数调整，可以给一个默认的颜色参数</font>

<font style="color:#000000;">Color：主要用这个来调整颜色，根据情况可以有多个颜色参数</font>

<font style="color:#000000;">Metallic：金属度，用数值调整，整个材质没有金属度的区别</font>

<font style="color:#000000;">Roughness：粗糙度，用数值调整，整个材质没有粗糙度的区别</font>

<font style="color:#000000;">以上3个参数必须有，在此之外可以定义其他调整参数，但要注意不能有其他参数影响主要颜色、金属度、粗糙度（比如加个对比度会影响颜色，这个就不可以）</font>

<font style="color:#000000;">可以提供几种预设</font>

<font style="color:#000000;">输出通道：</font>

+ <font style="color:#000000;">颜色2张，一张带Color属性的颜色；一张偏白色。用2个同样的材质节点，分别输出2个颜色通道</font>
+ <font style="color:#000000;">法线</font>
+ <font style="color:#000000;">金属度</font>
+ <font style="color:#000000;">粗糙度</font>
+ <font style="color:#000000;">AO</font>

<font style="color:#000000;">金属度、粗糙度是给sp里另一种贴图输出方式用的</font>

<font style="color:#000000;">SD中制作材质时需要确保公开参数，这样SP中才能</font><font style="color:#000000;">调整SD的材质参数，并确保SP的插件能够读取并保存SD的材质参数到json文件</font><font style="color:#000000;">。</font>

<font style="color:#000000;"></font>![](https://cdn.nlark.com/yuque/0/2024/png/1660870/1721015493590-917f664b-6606-4e01-9087-20ef60223c50.png)![](https://cdn.nlark.com/yuque/0/2024/png/1660870/1721015493021-ea65a59b-d787-444b-871d-7f2b8f5b852d.png)![](https://cdn.nlark.com/yuque/0/2024/png/1660870/1721015493035-210a24f1-4f21-47a3-a827-cf4025cf35cb.png)

#### **<font style="color:#000000;">2. SP Channel设置标准</font>**
<font style="color:#000000;">SP</font><font style="color:#000000;">中绘制贴图时，需要在Texture Set Settings 中添加多个Channel：</font>

<font style="color:#000000;">●</font><font style="color:#000000;"> </font><font style="color:#000000;">Mask1	L8		材质1区域，可染色，有Detail法线；</font>

<font style="color:#000000;">●</font><font style="color:#000000;"> </font><font style="color:#000000;">Mask2	L8		材质2区域，可染色，有Detail法线；</font>

<font style="color:#000000;">●</font><font style="color:#000000;"> </font><font style="color:#000000;">Mask3	L8		材质3区域，可染色，有Detail法线；</font>

<font style="color:#000000;">●</font><font style="color:#000000;"> </font><font style="color:#000000;">Mask4	L8		材质4区域，不可染色，没有Detail法线，颜色来自基础颜色贴图；</font>

<font style="color:#000000;">● Color2	sRGB	高精度用的基础颜色，前3个通道的颜色不写入这里</font>

<font style="color:#000000;">●</font><font style="color:#000000;"> </font><font style="color:#000000;">Nrm2	RGB16F	不带Detail法线的法线贴图，让前三个通道法线不写入这里。</font>

![](https://cdn.nlark.com/yuque/0/2024/png/1660870/1721015493237-84a1e885-3b73-4cf5-bc56-a0adbfce06c2.png)

<font style="color:#000000;"></font>

<font style="color:#000000;">细节法线</font>

<font style="color:#000000;">- Detail_Nrm_Mask1 材质1区域Detail法线</font>

<font style="color:#000000;">- Detail_Nrm_Mask</font><font style="color:#000000;">2</font><font style="color:#000000;"> 材质2区域Detail法线</font>

<font style="color:#000000;">- Detail_Nrm_Mask</font><font style="color:#000000;">3</font><font style="color:#000000;"> 材质3区域Detail法线</font>

#### **<font style="color:#000000;">3. SP图层设置标准：</font>**
<font style="color:#000000;">4个Group图层，分别对应Mask1 2 3 4</font>

![](https://cdn.nlark.com/yuque/0/2024/png/1660870/1721015493294-b62054d6-58a8-41f2-b080-7b1727adf30f.png)

<font style="color:#000000;">Group1 2 3下面是2个Fill图层，第一个写入对应的Mask属性，第二个是这层使用的材质。</font>

![](https://cdn.nlark.com/yuque/0/2024/png/1660870/1721015493561-0ce86494-bf6c-4d55-8681-e92fea7a701d.png)

![](https://cdn.nlark.com/yuque/0/2024/png/1660870/1721015493521-29ac3701-0f0c-4177-a904-20d2a2f91f35.png)

<font style="color:#000000;">Folder4下面可以有任意多图层，可以画颜色，影响的通道这样设置</font>

![](https://cdn.nlark.com/yuque/0/2024/png/1660870/1721015493771-82d6e193-ee87-4337-9124-735f3a0b9042.png)

#### <font style="color:#000000;">4. </font>**<font style="color:#000000;">SP使用材质公开参数来调整最终效果</font>**
![](https://cdn.nlark.com/yuque/0/2024/png/1660870/1721015493914-fec1e467-b10f-4391-9905-db231ad94eed.png)

#### <font style="color:#000000;">5. </font>**<font style="color:#000000;">SP使用插件导出材质参数及贴图</font>**
<font style="color:#000000;">目前先用下面这种预设方式来快速测试，确定后可以把贴图导出并到插件流程中和参数一起导出。</font>

![](https://cdn.nlark.com/yuque/0/2024/png/1660870/1721015494208-149d7717-3188-4fa6-9dac-3fee15902e0e.png)

<font style="color:#000000;">大概写了个插件验证了下在SP中读取材质参数及贴图并将其保存成json的可行性</font>

![](https://cdn.nlark.com/yuque/0/2024/png/1660870/1721015494679-691b0eeb-7092-470c-9393-686aec9930c4.png)

![](https://cdn.nlark.com/yuque/0/2024/png/1660870/1721015495008-522e1511-647b-413e-a893-fda2e9cdf8f0.png)

#### **<font style="color:#000000;">6. SP导出3种配置</font>**
| <font style="color:#000000;">高</font> | **<font style="color:#000000;">高精度，适用高模8-12w面</font>** | |
| :--- | --- | --- |
| <font style="color:#000000;">基础颜色</font> | <font style="color:#000000;">Color2</font> | |
| <font style="color:#000000;">基础法线</font> | <font style="color:#000000;">nrm2</font> | |
| <font style="color:#000000;">AO</font> | <font style="color:#000000;">AO</font> | |
| <font style="color:#000000;">区域Mask</font> | <font style="color:#000000;">Mask1+2+3+4</font> | |
| <font style="color:#000000;">基础粗糙度</font> | <font style="color:#000000;">待定，可能没有</font> | |
| <font style="color:#000000;">基础金属度</font> | <font style="color:#000000;">待定，可能没有</font> | |
| <font style="color:#000000;">材质1 2 3 Detail法线</font> | <font style="color:#000000;">把sp里用的材质导入到unity，用同样的参数生成</font> | |
| <font style="color:#000000;">Detail法线Tiling</font> | <font style="color:#000000;">用工具自动生成材质设置上去</font><font style="color:#000000;"> (</font><font style="color:#000000;">Tiling是指Properties-Fill里的uv transormations</font><font style="color:#000000;">)</font> | |
| <font style="color:#000000;">材质1 2 3 金属度</font> | <font style="color:#000000;">用属性调整，自动设置</font> | |
| <font style="color:#000000;">材质1 2 3 粗糙度</font> | <font style="color:#000000;">用属性调整，自动设置</font> | |
| <font style="color:#000000;">材质1 2 3 颜色</font> | <font style="color:#000000;">用属性调整，自动设置</font> | |
| <font style="color:#000000;">扰动法线Noise贴图</font> | <font style="color:#000000;">待定，可能没有</font> | |
| | | |
| <font style="color:#000000;">低（染色）</font> | **<font style="color:#000000;">低精度A，适用中模1.5-2w面</font>** | |
| <font style="color:#000000;">基础颜色</font> | <font style="color:#000000;">Color2</font> | |
| <font style="color:#000000;">基础法线</font> | <font style="color:#000000;">合并Normal</font> | |
| <font style="color:#000000;">AO</font> | <font style="color:#000000;">AO</font> | |
| <font style="color:#000000;">区域Mask</font> | <font style="color:#000000;">Mask1+2+3+4</font> | |
| <font style="color:#000000;">基础粗糙度</font> | <font style="color:#000000;">待定，可能没有</font> | |
| <font style="color:#000000;">基础金属度</font> | <font style="color:#000000;">待定，可能没有</font> | |
| <font style="color:#000000;">材质1 2 3 金属度</font> | <font style="color:#000000;">用属性调整，自动设置</font> | |
| <font style="color:#000000;">材质1 2 3 粗糙度</font> | <font style="color:#000000;">用属性调整，自动设置</font> | |
| <font style="color:#000000;">材质1 2 3 颜色</font> | <font style="color:#000000;">用属性调整，自动设置</font> | |
| <font style="color:#000000;">扰动法线Noise贴图</font> | <font style="color:#000000;">待定，可能没有</font> | |
| | | |
| <font style="color:#000000;">低·改（不染色）</font> | | **<font style="color:#000000;">低精度B，适用低模8000面</font>** |
| <font style="color:#000000;">基础颜色</font> | <font style="color:#000000;">合并Color</font> | |
| <font style="color:#000000;">基础法线</font> | <font style="color:#000000;">合并Normal</font> | |
| <font style="color:#000000;">AO</font> | <font style="color:#000000;">AO</font> | |
| <font style="color:#000000;">粗糙度</font> | <font style="color:#000000;">合并粗糙度</font> | |
| <font style="color:#000000;">金属度</font> | <font style="color:#000000;">合并金属度</font> | |


