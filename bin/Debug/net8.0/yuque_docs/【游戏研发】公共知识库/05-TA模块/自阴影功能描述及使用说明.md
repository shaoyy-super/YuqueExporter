# 自阴影使用说明
## 开启自阴影
1. 在Render Data中挂上Self Shadow Feature

![](https://cdn.nlark.com/yuque/0/2024/png/46024715/1733193606584-1016bd5c-aded-48e4-9d5c-0548060d75ed.png)

2. 在volume中设置灯光等相关属性（目前只支持两盏灯光，但是后期如果想加很好加）

![](https://cdn.nlark.com/yuque/0/2024/png/46024715/1733196751263-17265948-c286-449d-a204-de616d34bb5d.png)

3. 给希望产生自阴影的物体添加上脚本SelfShadowHelper（这个脚本会计算平行光下阴影的范围）

![](https://cdn.nlark.com/yuque/0/2024/png/46024715/1733196829865-e0df09b9-f466-4245-b9dd-60781a2bd731.png)

## 相关参数说明
:::color4
**SelfShadowFeature:**

![](https://cdn.nlark.com/yuque/0/2024/png/46024715/1733196917344-6cb93e04-f33b-4c94-b151-5778e985fe09.png)

<font style="color:#DF2A3F;">Shadow Quality_Main</font> : 主光源阴影质量

<font style="color:#DF2A3F;">Shadow Quality_Additional</font>：AdditionLight阴影质量

<font style="color:#DF2A3F;">相机剔除模式</font>：（关于相机剔除的大小每个物体都可以改变，在后面说明）

按世界范围大小剔除：会按照物体本身renderer的Bounds Box大小剔除

按视角纠正范围剔除（默认选项）：会按照相机视角对范围做纠正（通常来说比世界范围要大很多）

<font style="color:#DF2A3F;">剔除深度扩展</font>：如果剔除模式是视角纠正范围剔除的话，可以调整剔除的深度，深度越深，剔除范围越大

<font style="color:#DF2A3F;">Default Shadow Range</font>：默认的阴影范围（可以在volume中覆盖）即相机到物体的距离

<font style="color:#DF2A3F;">Raise Shadow Map Resolution</font>：将阴影质量往上提高一级（最高4096）

<font style="color:#DF2A3F;">开启光源方向Culling</font>：DrawRenderer的时候会按照光源的方向来做剔除（并非是相机剔除）

:::

:::color4
**Character Volume**

![](https://cdn.nlark.com/yuque/0/2024/png/46024715/1733196751263-17265948-c286-449d-a204-de616d34bb5d.png?x-oss-process=image%2Fformat%2Cwebp)

<font style="color:#DF2A3F;">开启假阴影</font>：选择采用哪盏灯光使用假阴影（如果开启光源一的假阴影，那么光源二的此选项会被覆盖）

<font style="color:#DF2A3F;">自阴影生效范围</font>：覆盖RenderFeature里面的阴影范围

<font style="color:#DF2A3F;">NdotL去除范围</font>：根据NdotL值去除阴影的阈值（非特殊情况不用开启）

:::



## 演示场景
场景：SC_TestCustomShadow

案例1

![](https://cdn.nlark.com/yuque/0/2024/png/46024715/1733205270478-93a48fd2-d28d-4ec6-a19b-8e5620ee1bc2.png)

# 自阴影相关功能
## 相机剔除
相机剔除可以剔除一些相机之外看不到的物体，但是有的时候虽然物体在相机View之外，但是阴影在相机内，所以相机剔除相关的设置可以调整相机剔除的相关设置

在Render Data中可以选择相机剔除模式

> <font style="color:#DF2A3F;">相机剔除模式</font>：（关于相机剔除的大小每个物体都可以改变，在后面说明）
>
>     1. 按世界范围大小剔除：会按照物体本身renderer的Bounds Box大小剔除
>     2. 按视角纠正范围剔除（默认选项）：会按照相机视角对范围做纠正（通常来说比世界范围要大很多）
>

### 剔除范围可视化显示
如果要观察和调整视角纠正剔除，可以把ShadowGameManager中的Show Mode改为<font style="color:#DF2A3F;">相机剔除范围</font>

![](https://cdn.nlark.com/yuque/0/2024/png/46024715/1733205932140-4d47d26a-9722-452d-8c97-6a811360186b.png)

> 在ShadowGameManager中可以选择每一个挂了SelfShadowHelper的脚本（但不可编辑）
>
> ![](https://cdn.nlark.com/yuque/0/2024/png/46024715/1733218861402-befabb0b-8513-4d5d-9d68-85a099f28848.png)
>

物体会根据相机剔除模式显示当前剔除范围的大小框

下图为：两种不同模式下相机剔除的大小框（左：视角纠正剔除，右：世界范围大小剔除）

![](https://cdn.nlark.com/yuque/0/2024/png/46024715/1733206154033-3c63e19c-a3aa-4d27-9a92-8b7269dd6fbb.png)

### 单物体剔除范围调整
:::color4
通常来说，按照视角纠正范围剔除是“懒人”选项，按照视角纠正范围剔除正常不会产生阴影在视角范围内但是被剔除的可能

:::

如果希望精细化调整（既每个物体的范围大小）以达到性能优化的目的，或者查看每个物体的各种“框大小”，则可以调整每个SelfShadowHelper中的相关数值设置

![](https://cdn.nlark.com/yuque/0/2024/png/46024715/1733219230354-98b5d1c3-d8bb-478f-8ae0-6d302c0f37f4.png)

> <font style="color:#DF2A3F;">Override Gizmos Drawing ：</font><font style="color:#000000;">覆盖掉默认的（ShadowGameManager）的框显示</font>
>
> <font style="color:#DF2A3F;">调整模式</font><font style="color:#000000;">：</font>选择按照什么样的方式来调整相机剔除的范围
>
>     1. <font style="color:#DF2A3F;">世界范围大小</font>：<font style="color:#000000;">直接调整renderer的boundingBox大小（如果剔除模式为世界范围大小剔除，则显示的就是剔除范围大小）</font>
>     2. <font style="color:#DF2A3F;">灯光纠正范围</font><font style="color:#000000;">：调整灯光纠正的范围大小（</font><font style="color:#117CEE;">如果剔除模式为世界范围大小，灯光纠正范围大小是不起作用的</font><font style="color:#000000;">！！如果不熟悉不建议使用这种模式调整）</font>
>     3. <font style="color:#DF2A3F;">相机剔除范围</font><font style="color:#000000;">：根据剔除模式来显示，直接调整相机剔除的范围大小（</font><font style="color:#117CEE;">推荐使用这种模式</font><font style="color:#000000;">）</font>
>

### 演示场景
场景：SC_TestCustomShadow

案例2

> FrameDebug中可以看到仅仅只拍了看到的物体
>
> ![](https://cdn.nlark.com/yuque/0/2024/png/46024715/1733221226730-7e9b190f-ac3e-4061-b50c-cc8b38c05a93.png)
>

## 假阴影
在美术需求中，往往需要人物光照的相机不照射地面，但是需要对地面进行投影，这种情况下就需要假阴影

### 假阴影设置
首先，接收假阴影的物体（例如地面），材质要支持假阴影，在材质选项中，会有开启假阴影的toggle

例如FASceneObject：

![](https://cdn.nlark.com/yuque/0/2024/png/46024715/1733221630544-d1bae394-8b74-4d49-b5db-9f85030d9a74.png)

随后，在CharacterVolume中需要让想要的灯光开启假阴影

![](https://cdn.nlark.com/yuque/0/2024/png/46024715/1733221712022-ab24ba38-2174-4889-b3cd-e438f6ffb513.png)

> 如果两个灯光都开启假阴影，那么会使用第一个灯光的设置，也就是第一个灯光的假阴影
>

假阴影效果：

![](https://cdn.nlark.com/yuque/0/2024/png/46024715/1733221843072-92a0ee8b-9f9c-4547-9a5a-54e47baa3d0c.png)

### 演示场景
场景：SC_TestCustomShadow

案例3

