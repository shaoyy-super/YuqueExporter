

## 一、概述
### 1.1 文档说明
a、功能建筑、npc。功能入口逻辑

b、npc寻路逻辑

c、交互逻辑





## 二、功能说明
### 2.1 功能入口
城市中各个区域会有数个功能入口，这些入口可以是建筑或者人物的模型或者特效。玩家靠近这些模型达到一定的范围时，可以和这些模型或者特效交互（交互判定详见2.5）。功能模型可交互时会出现一个交互小图标，点击图标打开对应的功能界面

每个功能也有自己的功能名字，需要在对应模型上悬挂一个3Dui，上面显示功能名字和功能图标。

此ui始终正面面向玩家，方便玩家识别。模型的中心出现在玩家镜头视野中，图标会显示。图标本身在超出一个较远的距离后会隐藏。（名字显示隐藏距离用通用数值，主城内所有3d文本ui，在超出一定范围时都需要隐藏，目前包括：功能名字、玩家和宠物名字等等）

未开放时，图标显示为一把锁，名字变为开放条件文本。未开放时只有在玩家进入交互区域内才会显示图标和名字，且没有交互菜单出现，

玩家点击该ui也可以打开功能界面，如果玩家距离大于可以和模型交互的距离，则先寻路到模型位置进入交互状态再打开功能界面。

条件和开放等级由功能表控制

<u>功能入口交互展示：玩家进入功能模型的交互区域后（交互区域见2.3），点击交互按钮，先移动镜头至一个特定的位置（用以展示场景上效果），然后打开功能ui界面。</u>

<u>考虑到我们会有多种交互展示表演方式，表格中需要可控制这个功能入口使用的是那种交互展示。</u>

![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1721636161772-7690ba03-2323-466b-bccd-cec39dc81862.png)![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1721637445770-2e649f1c-4255-4395-8598-ebafcd00ca6c.png)

### 2.2 NPC巡逻
城市内有游戏自有的npc，npc会有城市中固定路线上巡逻和表演。这些npc有宠物也有人类。让整个主城呈现出类似GTA的繁荣生动的效果。行进的人群，偶发的事件等等

![](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1720080693713-4ac8504f-6ff9-41b7-9008-dc995080fa89.jpeg)

NPC ai分为巡逻逻辑、事件逻辑和碰撞逻辑

巡逻逻辑：巡逻逻辑用来设定人物或者宠物的行进轨迹。巡逻逻辑分固定模式和路径模式。

固定模式，为人物根据配置在某个位置循环播放某个动作。固定出现一个npc，刷新配置为0

路径模式为城市中会有数条配置好的巡逻路线，分起点和终点。每隔随机间隔会从起点刷新一个npc池中的npc。npc会沿着路线以特定速度行进（速度跟着路线配置），直到终点消失。

如果起终2点重叠则为循环路径，固定分配数个npc在路径上按间隔依次直接出现，根据配置的npcid种类不重复，npc出现后不断循环。







### 2.3 交互
交互判定：

当玩家进入另外一个可交互的宠物、npc、场景模型或者特效的一定距离内时，进入可交互状态

多个可交互模型同时进入可交互状态时，只有一个会出现交互菜单。玩家镜头瞄准的模型（类似抓宠的瞄准判定）>交互范围内最近的1个模型>距离内其他模型

可交互模型会弹出交互菜单。不同交互菜单ui布局相同，但内容选项不同。交互菜单需要分几种类型

![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1721626259378-eda337d1-6f81-421f-adcf-da7b38bc25e3.png)

a、宠物交互。

b、玩家交互

c、场景交互

d、路人npc交互

e、功能入口交互



## 三、界面说明
### 3.1 功能入口ui
a、在功能对应的模型上，有一个3Dui。上面显示功能名字。点击后人物寻路至功能对应的触发点位置，并打开功能

b、未开启的功能，ui置灰，显示开启条件。交互后飘字提示功能暂未开启

![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1721638753940-2a4fd2dc-1ba0-44ad-933e-d4488d8c51f9.png)

### 3.2 交互ui
a、交互ui，在触发可交互的模型时，模型附近会有可交互的按钮。不同的模型会显示有不同的交互行为

![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1721626259378-eda337d1-6f81-421f-adcf-da7b38bc25e3.png)













## 五、配置表说明
### 5.1 功能表
功能表中需要增加每个功能对应的模型id



### 5.2 路径表
![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1721640624579-4274c532-0286-4798-a496-e11fde9c2a04.png)



## 六、功能需求清单
[此处为语雀卡片，点击链接查看](https://www.yuque.com/cod5mf/iwqppn/niuh2ds9xg7mv9l1#vnA15)

## 七、string需求


| **<font style="color:white;">类别</font>** | **<font style="color:white;">目标操作</font>** | **<font style="color:white;">触发条件</font>** | **<font style="color:white;">提示形式</font>** | **<font style="color:white;">提示string</font>** |
| --- | --- | --- | --- | --- |
|  | 打开功能 | 功能未开启 | 飘字 | 功能暂未开启 |
| | |  |  | |


