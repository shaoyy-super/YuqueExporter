

[此处为语雀卡片，点击链接查看](https://www.yuque.com/cod5mf/iwqppn/cdgws2i1d0t5rcvo#oVJbl)

## 
## 1.规则简述
**回合制：**在底层运算中，是以一个回合为单位的行动制作的基础规则。

**一回合：**一回合包含，先手方回合，和后手方回合。双方行动结束，一回合结束。

**玩家手动回合：**同一个回合内，玩家可以执行多次行动操作，直到玩家手动点击“回合结束”完成回合。

**自动回合：**同一回合内，按照ai规则，使用卡牌消耗掉可使用的全部能量后，自动结束回合。

**回合时间：**每回合的时间包括操作时间和展示时间。每回合的操作时间是有配置限制。时间结束强制结束回合。



## 2.战斗队伍
**角色**

游戏主角，是一个人形角色，角色没有属性，不直接参与战斗，可能会有部分技能借助主角的模型释放。

**宠物**

主要的战斗单位，每个队伍最多可以编制3名宠物，宠物战前可以编制出战顺序，战斗时按照战斗顺序出战。





## 3.战斗流程和触发节点
![](https://cdn.nlark.com/yuque/0/2024/png/43733765/1717055148214-a88877e4-cfc3-4d6b-a726-a0ea97c574e6.png)

![](https://cdn.nlark.com/yuque/0/2024/png/43733765/1717055121456-02a7c2eb-42c1-465a-ad75-23f9f02c9083.png)

### 3.1进入战斗阶段
从大世界切换到战斗场景，载入战斗资源和战斗队伍等。



### 3.2战前准备阶段
进入场景后回合开始前，在此过程中完成战斗属性的计算。

**确定基础属性**：根据宠物面板的属性确定宠物的基础属性。

**被动技能触发**：首个登场的宠物的“战斗中生效”被动技能生效，使用技能流程，在此阶段执行一遍。

被动技能主要为buff效果，为宠物施加各种buff属性。

例如：战斗中攻击力增加10%。

**团队buff生效**：对队伍生效的buff施加到场上的单位身上。

**战斗属性**：基础属性+buff属性组成，属性的计算方式见属性表。



### 3.3回合前准备阶段
每回合开始之前必须经过的过程，此阶段主要的功能是。确定双方先后手，根据当前战斗宠物的战斗属性中的速度属性大小，速度值大的，为回合先手方。



### 3.4回合开始阶段
先手方的回合先执行，先手方进入我方回合阶段。敌方进入等待状态。等待我方决策。



**回合开始buff结算**：如果有”回合开始前“触发的的buff效果，在此时触发buff结算。

例如：buff效果，每回合开始时增加10%攻击力，持续3回合。



**回合开始被动技能释放**：如果有“回合开始前“释放的被动技能，在此时触发技能。

例如：每回合我方回合开始前，对对方发起一次100%攻击。





**技能释放阶段：**

执行方在限定的回合时间内完成操作，将卡牌拖到屏幕中打出。

打出前需要检查能量是否满足，冷却是否满足。



**技能表现阶段：**

卡牌打出后的表演阶段，无法操作，不计算回合时间，后续考虑可以跳过表演。



技能释放阶段和表演阶段可以在同一回合内重复多次。



### 3.5回合结束阶段
手动情况下玩家点击回合结束后，进入回合结束阶段。自动情况下，能量消耗完毕后自动切入回合结束阶段。



**被动技能触发：**

回合开始后的被动技能释放，如果有”回合结束时“释放的被动技能，在此时触发技能。

例如，回合结束时，对对方发起一次攻击，造成本回合全部伤害的50%。



**回合结束buff结算**：如果有”回合结束时“触发的buff效果，在此时触发buff结算。

例如：buff效果，回合结束时，造成100%的施加者攻击伤害。



**回合结束完毕**：进入敌方回合



敌方回合完毕，进入第二回合回合准备阶段。

某一方的宠物全部阵亡，战斗结束，进入战斗结算阶段。

### 3.6战斗结算阶段
播放结算界面，发放战斗奖励。



## 4.宠物死亡替换规则
![](https://cdn.nlark.com/yuque/0/2024/png/43733765/1717053871677-c3ac1612-5a1a-48c6-8d2d-d8fedf6cde8b.png)

### 4.1触发条件
队伍中宠物死亡后会进入死亡替换规则。

战斗流程中任何步骤导致了宠物死亡都会进入死亡替换规则。

### 4.2死亡
死亡：宠物生命值为0时，进入死亡状态。移除死亡清除的buff。

### 4.3复活
复活条件判定：宠物死亡时，即刻判断是否该宠物拥有可以复活的条件。

例如：”死亡时复活一次“的buff。

复活成功后，根据复活条件，至少恢复1点生命值。

如果无法复活。检查队列中是否还有可上阵的宠物。

### 4.4替换
将下一顺位的宠物召唤到战斗区，将死亡宠物移到备战区末位。

插入战斗序列：新上场宠物插入战斗序列时，不会改变回合状态。只替换战斗宠物。

### 4.5其他
暂时不考虑移到备战区的死亡宠物复活，如果出现特殊技能，在战斗队列中后加顺位。



## 5.技能释放流程


### 5.1技能类型
主动技能：需要拥有卡牌形象，会出现在玩家手牌区域，需要玩家主动选择释放的技能。

被动技能：没用真实的卡牌形象，不会出现在玩家手牌区域，拥有特定的触发条件，达到触发条件后会触发该技能生效



### 5.2触发情况
战斗准备时触发的技能：只要该宠物登场，触发技能执行一次。

回合前触发技能：在某方手动回合前，触发技能执行一次。

回合后触发技能：在某方手动回合后，触发技能执行一次。

条件触发技能：由触发条件控制。

比如触发闪避后，立即反击一次。死亡时触发一次自爆。



### 5.3技能释放顺序
单个技能的释放

![](https://cdn.nlark.com/yuque/0/2024/png/43733765/1717146853146-84b816f9-feed-4057-87c5-700a1056cc8e.png)

触发器：技能达到触发条件，进入技能触发流程

释放条件检查：判断能够执行技能的全部条件都满足。

筛选器：筛选技能目标

逐条执行技能事件。

确定技能事件类型：伤害（近战/远程）类型，buff类型，召唤类型等

技能结束，全部技能执行完毕。



### 5.4技能打断
技能打断，理论上技能可以被打断，但是打断的技能无法连续，即技能如果被打断，该技能结束。继续进行战斗流程。

举例，A连续攻击目标3次，在第一次时，B身上被攻击时眩晕A1回合生效，在完成第一次攻击后， A的攻击技能被打断。



### 5.5技能事件
![](https://cdn.nlark.com/yuque/0/2024/png/43733765/1717146991740-9dfda1eb-6b63-4596-bc0d-361595c28773.png)

每个技能会由多条技能事件组合而成，每个技能按顺序执行多个技能事件。具体技能的实现方式由技能的复杂程度确定。

执行技能技能中效果的一条行为，包括，造成伤害/施加buff/召唤单位等

举例技能事件：

近战伤害类型，

确定伤害点在行为的触发点，

确定需要带入计算的参数

带入参数进入伤害公式计算结果

伤害飘字



### 5.6伤害计算
在进入到伤害计算流程中时，按顺序对各种属性和效果进行计算，得出最终结果。

战斗属性和伤害公式，单独以数值给的表为准。

![](https://cdn.nlark.com/yuque/0/2024/png/43733765/1717651432004-29714322-42b1-4968-bdd1-3a8e0ab1df11.png)5.6.1命中判定：根据闪避几率，判断此次伤害是否进入后续流程

5.6.2计算理论伤害次数：根据技能设定，确定造成的伤害次数和伤害点位置。

5.6.3计算暴击：根据暴击几率，计算每次伤害是否触发暴击

5.6.4计算伤害总量：带入计算公式，计算出理论伤害总量和每次伤害的理论伤害数值。

5.6.5计算护盾吸收情况：护盾根据护盾规则能够吸收的伤害次数和伤害数值。

5.6.6计算实际伤害：伤害飘字显示的次数和每次的具体数值，如果暴击会有不同的飘字效果

5.6.7计算反伤：根据实际伤害计算反伤数值。

5.6.8计算吸血：根据实际伤害计算吸血数值。



### 5.7触发器
触发型技能和触发型buff在达到一定的条件的时候触发生效， 触发时会插入到战斗流程中。

触发器逐步开发，这里举例一些可能会用到的。

![](https://cdn.nlark.com/yuque/0/2024/png/43733765/1717395255144-c635970c-cf5d-4ee4-9667-abe810f61497.png)





### 5.8buff流程
基础添加buff的流程

![](https://cdn.nlark.com/yuque/0/2024/png/43733765/1717147754907-0387f0ee-8760-4c03-86dd-36202ece6eac.png)

5.8.1筛选器

buff的筛选器可以和技能的筛选器是同一个，在释放buff时选择buff对象。

5.8.2buff免疫

如果有互斥的buff，这里直接跳过。

5.8.3buff施加概率：大部分buff的命中都会受基础属性中的术法值影响。这里需要判断是否能加上buff

添加buff：这里可能能会有获得buff时/清除buff时的触发器

5.8.4buff首次结算：buff施加后，如果需要立刻结算一次的buff在此时有一次结算。 	

5.8.5buff结算的顺序：只针对同一个结算时刻，不同类型的buff的结算顺序。

1buff对应的属性增减，攻防血属性变化

2治疗类型buff提供的生命回复

3伤害类型buff造成的扣血。

4护盾类型buff提供的抵挡。



## 6特殊技能效果
召唤：召唤一个无法点击，无法选中的场景单位。提供协攻或者助战。

连击：技能拥有连击效果时，在使用一张技能卡后会再次重复释放一次，重复的这次不消耗能量，需要参数，连击次数，连击概率

反击：角色拥有反击效果时，在受到敌方技能牌攻击后触发反击技能，执行1次技能，完毕。



## 7.跳字
在对目标造成伤害时触发的朓字效果。根据不同的状态有不同类型的字体管理。己方和敌方的跳字显示暂时按相同的显示。

### 7.1伤害数字
直接伤害数字

暴击伤害数字

护盾吸收伤害数字

治疗/吸血恢复数字



### 7.2特殊效果
闪避

反伤



### 7.3buff效果
护盾

燃烧

冰冻

眩晕

等



