## 一、概述
### 1.1 文档说明
a、城市基础经济循环。包括经济补充、玩家经济生活产出等等

b、城市内基础功能入口。部分功能展出式得场景表演

c、城市场景美观表现。包括玩家表现和npc表现等



### 1.2 文档维护


| <font style="color:white;">版本</font> | <font style="color:white;">时间</font> | <font style="color:white;">负责人</font> | <font style="color:white;">修改内容</font> |
| --- | :---: | :---: | :--- |
| <font style="color:black;">v1.0</font> | <font style="color:black;">2024/7/1</font> | 姚仕达 | <font style="color:black;">文档创建</font> |
|  | <font style="color:black;"></font> |  | <font style="color:black;"></font> |


### 1.3 设计思路
设计目的：给与玩家一个基础且有代入感的山海世界主城体验，同时作为玩家在游戏内经济生活的底层支持。

玩法介绍：

a、城市财政作为玩家在一个城市经济活动的底层支持。玩家通过生产、打工、pvp等各种方式赚取城市中的一部分财产。并由消费、交易等方式流通。通过收税的形式收取一定的财政收入，在销毁一部分通缩资金后。再回流到城市经济中

b、城市的建筑作为几个主要功能和打工、挖矿等系统的入口区域。在一定程度上表现出宠物在城市内活动的状态

c、玩家在城市内可以看见一定数量的其他玩家，营造一个生态化的城市生活





### 1.4 系统框架图


![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1719811369537-2af87872-86d5-410a-89f5-612e3ab6e93e.jpeg)





## 二、功能说明
### 2.1 城市功能设定
a、天枢城（城市）：游戏中分为数个城市。玩家需要拥有属于该城市的血统纯正的宠物才能参与大部分该城市中的功能、经济玩法。但玩家本身可以在市政厅自由切换当前所在城市。城市分为开放和不开放，不开放的城市无法进入（通过市政厅功能切换，详见市政厅文档）

b、血统（户口）：每个城市都可以繁育出数量有限的血统纯正的宠物，玩家可以通过购买或者前期的运营活动获得带血统的宠物。其他城市血统的宠物会由运营逐步开放。



### 2.2 城市内基础功能定义
制造（打工）：城市基础功能之一，城市中存在数个制造区域。玩家通过安排宠物进入制造建筑，持续赚取货币。

采集（矿场）：城市基础功能之一，城市中存在数个采集区域。玩家通过安排宠物进入采集区域，持续产出可交易货物。

天枢（市政厅）：根据玩家消耗治理币的行为动态生成每日市政府工资表，玩家消耗治理币越多市政府工资越高。

领养所（养老团）：玩家前期获取免费宠物的主要途径，提供的非纯正血统的宠物。不可参与打工只能用来打主线挑战等非核心玩法。

训练场（图书馆）：pve内容，产出宠物经验（不可交易）和技能书碎片（可交易）

孵化所：玩家挂牌宠物，或者申请配对。孵化宠物宝宝的地方

交易行：玩家互相出售购买东西的地方

其他：城市需要一定的扩展性，以方便容纳后续的其他功能。

大门：野外功能入口



### 2.3 其他名词解释：
触发点：一个透明的碰撞区域，玩家碰撞后触发需要的逻辑

巡逻路线：巡逻路线用来设定人物或者宠物的行进轨迹。

表演事件：游戏内预先设定好的表演区域

事件点：表演事件需要额外的npc辅助表演的位置点

抓取：表演事件从附近巡逻路线上获取一个随机npc

城市位面：为了性能，根据玩家数量将玩家分配在不同的线路上，各自展现的城市效果是一样的。

挂点：模型上为了播放交互动画等各种逻辑，增加的一个标记

### 2.4 城市表现框架
![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1719899098705-e35d53f1-6c29-4e90-bb57-04c3be2feb00.jpeg)

a、场景：一个完整的城市场景，包括上述的所有区域



b、功能入口：城市中各个区域会有数个功能建筑，玩家在接触到对应功能建筑的触发点后，打开功能界面或者进入功能区域。触发点为一个矩形区域，需要可配置大小和位置。玩家点击建筑模型会寻路到对应模型位置并打开功能界面

每个功能都有自己的功能名字，需要在对应建筑上悬挂一个3Dui，上面显示功能名字。未开放时显示开放条件。玩家点击该ui和点击模型逻辑一致。

条件和开放等级由功能表控制

![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1720080471627-83ce2686-d848-4cca-b552-b926a607b066.png)

c、NPC：城市内有游戏自有的npc，npc会有城市中固定路线上巡逻和表演。这些npc有宠物也有人类。让整个主城呈现出类似GTA的繁荣生动的效果。行进的人群，偶发的事件等等

![](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1720080693713-4ac8504f-6ff9-41b7-9008-dc995080fa89.jpeg)

NPC ai分为巡逻逻辑、事件逻辑和碰撞逻辑

巡逻逻辑：巡逻逻辑用来设定人物或者宠物的行进轨迹。巡逻逻辑分固定模式和路径模式。

固定模式，为人物根据配置在某个位置循环播放某个动作。

路径模式为城市中会有数条配置好的巡逻路线，分起点和终点。每隔随机间隔会从起点刷新一个npc池中的npc。npc会沿着路线以特定速度行进（速度跟着路线配置），直到终点消失。

如果起终2点重叠则为循环路径，固定分配数个npc在路径上按间隔依次直接出现，根据配置的npcid种类不重复，npc出现后不断循环。



事件用来设定城市中会发生的一系列行为生态，比如：人群聚集、人物进店消费等等。

事件逻辑：在城市中会有数个配置好的事件点，每隔随机时间，事件点会激活，并抓取附近固定范围内的特定数条路线上的npc，npc会从被抓取的点寻路到事件点位置，参与事件播放，播放完成后返回之前的点位继续巡逻。

事件是一组提前配置好的的表演组，有事件本身和数个事件点组成。事件点是一个拥有位置、时间、动作、朝向等参数的挂点。

事件激活前事件组播放休眠阶段动画，激活后，抓取的npc模型会先走到事件点上，当到达事件点上时，开始播放事件的激活动画。播放结束后，被抓取得npc返回。事件返回休眠模式

![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1719985052410-ed6d4e71-cd87-4f18-a66c-4dcc9771bf97.jpeg)

避让逻辑：每个npc模型会有自己的碰撞区域。当npc遇到其他模型的碰撞区域时，会触发避让逻辑。npc会以当前点为起点，执行一次寻路逻辑，以最短可行进路线按路径前进方向返回路径上。

如果是同路径上的2个npc，后面的npc会等待前面npc前进后再沿着路径行动。



d、功能表演：每个功能建筑有自己独有的表现。

通用的表演为建筑模型自身的表演动画，另外也可能会有事件组在这些建筑上

打工和挖矿2种建筑有额外的功能化表演。比如当玩家把自己的宠物放进功能打工后，宠物会有特定的位置出现并播放打工动画。（这块具体到功能内制作）





e、玩家站街：一个城市内同时会显示数个玩家，每个玩家身后会跟随一个宠物。用玩家和宠物同时显示的方式，展示一个以宠物为主生态的世界观。

![](https://cdn.nlark.com/yuque/0/2024/webp/43733777/1720081663212-6d02bf7c-d711-4c56-bb1d-5daf2e1484d8.webp)



同屏数量按具体性能确定。在玩家进入城市时候按数量分配不同的位面，超过最大数量则新开一个位面。优先填补空缺的位置。如果一个位面的所有玩家都下线，则位面关闭。

玩家可以在宠物功能内选择一个最喜欢的宠物，被选择的宠物会跟随玩家出现在屏幕上

如果最喜欢的宠物被锁定，则按战力顺序显示。

宠物跟随：当玩家移动，宠物会一直寻路到玩家身后的一个点上。这个点的位置为玩家正后方，距离为玩家碰撞体半径+固定数值+宠物碰撞体半径； 如果玩家原地旋转，宠物不寻路，保持静止。





f、待开放区域：城市需要可扩展预留，这些区域可以用一些货物、路障表现阻止。玩家碰触到这些区域有空气墙不可行进。



g、时间、天气：根据现实时间和天气，动态表现城市的氛围和环境。涉及到光影、特效等变化（读取手机中时间和天气权限？）

时间按晚8和早6切换，白天到夜晚有个光影效果渐变的过程，城中会有火光、灯光的变化。具体需要美术介入

![](https://cdn.nlark.com/yuque/0/2024/webp/43733777/1720081477678-313ae50b-4a73-4d5c-a4b9-565ad158178a.webp)![](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1720081482923-95ec1bda-4468-4a90-bfcb-9d33254da34f.jpeg)



h、交互

交互判定：

当玩家进入另外一个可交互的宠物、npc、场景模型或者特效的一定距离内时，进入可交互状态

多个可交互模型同时进入可交互状态时，只有一个会出现交互菜单。玩家镜头瞄准的模型（类似抓宠的瞄准判定）>交互范围内最近的1个模型>距离内其他模型

可交互模型会弹出交互菜单。

![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1721626259378-eda337d1-6f81-421f-adcf-da7b38bc25e3.png)



a、宠物交互。

玩家在靠近其他人的宠物一定距离内，或者把镜头对准自己的宠物时（类似抓宠）时，宠物处于可交互状态

在可交互状态会弹出一个宠物交互菜单。目前只有抚摸交互

点击抚摸交互按钮后，主角和宠物会播放一段固定动画。播放固定动画时宠物模型会被固定在原地，并在播完后寻路到原本逻辑需要它所在的位置（大于一定距离可以直接传送过去）

![](https://cdn.nlark.com/yuque/0/2024/webp/43733777/1720081295739-25e3b801-d1af-44c7-a319-2fed27d8f781.webp)



b、玩家交互（待定）：玩家在靠近其他玩家一定距离内出现交互菜单。暂无交互行为



c、场景交互：坐椅子、开门等等

通用逻辑：模型上有固定的动作挂点，靠近模型出现交互菜单（同宠物），点击交互按钮，主角走到模型位置，并进入挂点位置，播放对应预设好的动画。如果此挂点有宠物的动作，则宠物也走表演逻辑，如果没有。隐藏宠物



室内外切换（需要聊下）：部分功能入口为室内npc，玩家需要有一个从室外进入室内的效果。

宝可梦为黑屏切换，

gta这种是触发开门动作无缝切换





### 2.5 城市经济框架（经济系统分散在各个功能内，这里做一个综述）
a、联邦财政：统筹所有城市产出，在按具体情况分发资金进入各个城市的财政池

b、城市财政：城市的各种经济活动的资金来源。并有联邦财政反哺经济池

c、玩家收入：玩家通过城市内提供的各功能、宠物的孵化，以及玩家之间的交易等方式赚取货币。

d、税收：玩家在城市内的各种交易活动会产生一部分税收，税收在扣除一部分通缩资金后会填补进联邦财政



![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1719909311092-c744a605-7af7-46ce-bbec-e86ea807a9b1.jpeg)



## 三、界面说明
### 3.1 功能入口ui
a、在功能对应的模型建筑门口，有一个竖排的3dui。模拟店铺招牌的感觉，上面显示功能名字。点击后人物寻路至功能对应的触发点位置，并打开功能

b、未开启的功能，ui置灰，显示开启条件。点击后飘字提示功能暂未开启

![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1719912102357-2f4164a0-2bc0-4eb0-85f2-a391b6ade15e.png)

### 3.2 宠物交互ui
a、在城市中点击宠物模型后出现互动行为，宠物行为时一段既定的表演。

d、可以支持有数种表演，点击后在表演库种随机播放一种

c、城中出现的所有宠物（自己的、其他玩家的、城市中的）都可以点击互动。被互动的宠物在互动结束前不会移动，不会有跟随逻辑触发。互动完后再寻路至需要的位置





## 四、城市美术需求
### 4.1 城市包装概述
大陆上矗立着一座座神秘的天枢。天枢是沟通天地的桥梁，聚集着大量的灵力。每一座天枢的灵力都有细微的差别。这些天枢的灵力外泄孕育了各种各样的灵兽（宠物）。人们为了获得这些灵兽的力量，围绕着天枢建造了一座座城市。城市的最中心就是围绕着天枢建造的天枢堡，由城中权势最高的人掌握。在天枢堡周围散布着各种各样的生活、生产、商店类建筑。

### 4.2 城市场景布局
主广场：玩家出生点区域，主要放置数个游戏内最重要的功能。此区域做为玩家进入游戏的第一个区域，需要视野开阔，美观。整体营造一个正前方为恢弘的主建筑天枢（市政厅），2侧为繁荣的商业区的感觉。

打工区：游戏有大量的挂机收益玩法，根据包装可能会划分出好多种类。整体氛围营造一个农业+轻工业区域的感觉。打工区主要集中这些工作建筑，每个城市2个建筑。一个是中世纪工业程度的加工建筑，里面有各种需要手工制作的部分。该建筑主要是室内造型。另外一个数量和占地面积更大，主要以农业和采集业为主。农田、矿场、果园等等。该类建筑大部分区域为露天区域，有小型的主建筑做为入口。

题材上，不同城市的采集业产出不同，对应的加工建筑也不同。一一对应，比如：麦田+面粉店、木林+木工坊、矿石+精炼场等等。

活动区：本质为一个预留的功能区，初版本可以用一些货物遮挡道路先不开放。为后续有活动需求或者有更多的功能需求时再开放。先做成一个开放式的广场即可

![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1720674978526-9853f161-25b7-474f-9202-5bc5f2b2b231.png)

视效参考：

![](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1717398154329-dc7e9e44-786b-4481-af4f-e56de9a19d5d.jpeg?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1085%2Climit_0%2Finterlace%2C1)

### 4.3 建筑视觉描述
a、天枢：整个城市最核心的建筑。以一个高耸入云的柱状天枢建筑为核心，整体是一个恢弘的城堡。此建筑做为玩家进入游戏的视觉中心，视觉效果层级最高。

参考：

天枢本体为中式概念建筑，考虑到我们游戏场景风格比较通用，可以调用天枢的概念，替换掉比较中式的元素，本质为一个高耸入云的垂直建筑，古人希望通过这个建筑和天沟通。也类似西方的方尖碑。

中式造型：

![](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1720083990894-cee2da9b-21ee-4c71-b428-5ec4329dcec7.jpeg)

游戏中变体：

![](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1720084089088-11799e5a-88da-4657-ab64-93ac799c8eb4.jpeg)![](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1720084167234-2410ef28-72c1-495e-8e01-e02d33cd5814.jpeg)

![](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1720084342317-25f31f35-89dc-4839-8f22-f682a7efc57a.jpeg)

考虑到我们是在城市内，所以围绕天枢的脚下需要有一个比较恢弘的城堡

![](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1717398154329-dc7e9e44-786b-4481-af4f-e56de9a19d5d.jpeg?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1085%2Climit_0%2Finterlace%2C1)

![](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1720084631586-a590f951-1648-4a79-a3f8-95817a0d2246.jpeg)



交易所：商业建筑，富裕、金钱的视觉感受

![](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1720095503860-886934a6-065e-43c2-90c2-8f5b8d7ba783.jpeg)![](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1720095531448-5514130a-1d73-4e76-a580-70860681c259.jpeg)



领养所：玩家领养前期使用的宠物的地方，整体偏住宅风格。低攻击性，温馨

孵化所：玩家孵化宠物宝宝的地方，整体偏住宅风格。低攻击性，温馨

这两个建筑都偏生活化，普通得房屋造型。在招牌上有所区别即可。孵化所可以带有一小片空地，用栅栏围起来，里面有小宠物活动

![](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1720096860567-1f056507-a3de-4db5-bb94-8fbc29649bdf.jpeg)



训练场：战斗训练区域，类似中世纪训练场。但需要一些宠物相关得元素。比如把假人替换成宠物得造型，盔甲换成宠物盔甲等等

![](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1720096550319-f7729073-244d-4e44-a68b-3bc5a7a0793a.jpeg)





铁匠铺（打工）：相比于采集建筑，有更大更明显的人工建筑。里面会雇佣宠物进行工作。有一片开放区域有数个炼铁和熔炉建筑。宠物会在这里工作。规模显得更整齐些。

主建筑

![](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1720094078325-c302dfd4-ee69-48be-a84c-8bc7dbfd7a30.jpeg)

工作区

![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1720094135645-8785b859-92da-45e2-bdff-9882521b41ec.png)

![](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1720096639582-e760fa66-23d4-4fca-995e-3858fb7198bf.jpeg)



木林（采集）：有大片的原生木林，刚进入有一小片空地，靠近街道的区域稀疏，背景为茂密的森林。有护林小屋，区域有木栅栏围起来。街道边会有一个小路通向林区，林区为待开发区域所以没有打工类的主建筑设定。玩家可以随意在这里砍伐

![](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1720093561647-1b81a885-5346-4b1b-8f4a-8709616fc4e5.jpeg)

矿场（采集）：开发了一半的矿场，和木林一样，有小路进入矿区。靠经街道的一侧有小片空地，往里有稀疏散落在外的矿床。背景有矿工小屋和人工的矿洞

![](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1720094521211-938a17af-5ed1-4d81-9cbd-a45aa1b98d15.jpeg)

![](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1720095246844-ca6d9340-ed95-476a-8322-dbd4e4e32c08.jpeg)

大门：宽敞的大门，能看到野外的布景。不需要太重的战斗感觉。

![](https://cdn.nlark.com/yuque/0/2024/webp/43733777/1720094697139-5cf91690-889d-46d1-ba96-0003e6c8419f.webp)

## 五、配置表说明
### 5.1 功能表
功能表中需要增加每个功能的触发点的区域和位置参数



### 5.2 路径表
![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1719989203631-0ad4eac2-eb80-4f9b-815f-007808aae440.png)

### 5.3 事件表
![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1719989217518-bd44e9d0-43ad-4471-8e0d-dbd371ba8f64.png)

## 六、功能需求清单






## 七、美术需求清单
### 7.1 界面需求
| **<font style="color:white;">编号</font>** | **<font style="color:white;">界面</font>** | **<font style="color:white;">性质</font>** |
| :---: | --- | --- |
| 1 | 功能标题 | 3d ui |
| 2 | 交互菜单 | 弹出框 |


### 7.2 主场景
| **<font style="color:white;">所属系统</font>** | **<font style="color:white;">场景类型</font>** | **<font style="color:white;">场景名称-美术</font>** | **<font style="color:white;">场景用途</font>** | **<font style="color:white;">描述</font>** |
| --- | --- | :---: | --- | --- |
| 主城 | 城市地图 | | 主城主场景 | 详见：四、城市美术需求 |


### 7.3 动态物件需求
详见需求文档

| **<font style="color:white;">分类</font>** | **<font style="color:white;">名称</font>** | **<font style="color:white;">用途</font>** | **<font style="color:white;">美术需求概述</font>** | **<font style="color:white;">美术需求链接</font>** |
| --- | :---: | --- | --- | :---: |
| 场景事件组 | | 主城表演 | 一组路人谈话 | |
| | | | | |
| | | | | |




## 八、string需求


| **<font style="color:white;">类别</font>** | **<font style="color:white;">目标操作</font>** | **<font style="color:white;">触发条件</font>** | **<font style="color:white;">提示形式</font>** | **<font style="color:white;">提示string</font>** |
| --- | --- | --- | --- | --- |
|  | 打开功能 | 功能未开启 | 飘字 | 功能暂未开启 |
| | |  |  | |














