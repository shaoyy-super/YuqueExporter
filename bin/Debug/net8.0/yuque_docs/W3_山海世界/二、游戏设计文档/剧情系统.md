## 一、概述
### 1.1 文档说明
包含游戏内几种剧情表演系统的文档

包括：通用剧情表演、npc交互剧情表演、小剧场



### 1.2 文档维护
| <font style="color:white;">版本</font> | <font style="color:white;">时间</font> | <font style="color:white;">负责人</font> | <font style="color:white;">修改内容</font> |
| --- | --- | --- | --- |
| <font style="color:black;">v1.0</font> | <font style="color:black;">2024/8/23</font> | 姚仕达 | <font style="color:black;">文档创建</font> |
|  |  |  |  |


### 1.3 设计思路
设计目的：增加游戏剧情表演向内容，完整游戏整体的带入体验。并且在一定程度上衔接不同系统之前的过度。

玩法思路：玩家通过一些途径进入剧情表演，通过点击不断观看预设好的剧情内容



## 二、功能说明
### 2.1 剧情名词
剧情对话分几种不同的展示方式，由表格配置调用

普通对话：常用的对话表现形式，是剧情表演的基础模板。包括剧情人物、剧情对话、镜头运动切换等等。

字幕剧情：全屏ui隐藏，居中显示一些文本的剧情表现形式。

选择向对话：需要玩家二选一的剧情对话

小剧场：特殊处理的整段表演，主要用在关键剧情或者开场剧情中



### 2.2 普通对话
#### 2.2.1 镜头
a、每句对话时镜头的位置由3个字段控制：

镜头中心：以某个模型为中心，默认为镜头正面朝向配置好的模型的位置。

镜头位置：配置相对之前镜头中心的模型的偏移量，由x；y；z控制。有速度配置则需要镜头位移过去（x；y；z；speed）

镜头旋转：配置相对镜头中心的旋转偏移，由x；y；z控制。有速度配置则需要镜头位移过去（x；y；z；speed）



b、镜头转场类型：

镜头转场的表现维度分3种，在表中有转场类型控制：

黑幕切换：在剧情开始就有大幅度的镜头变化，切在剧情播放过程中不断变化机位置。可在剧情中增加、减少任意数量的npc、特效。每次镜头的切换都有黑幕转场。这种类型下镜头直接切换。（此类型不读速度配置）

无黑幕切换：没有黑幕遮挡切换，镜头直接切换到需要的位置，如果有速度配置则需要运动到需要的位置



c、单句内镜头缓动

由进入剧情的镜头位置参数和镜头缓动位置参数形成一条直线的运动路径，在本句内，镜头不断的在两点之间运动。也分为位置和角度2个配置，需要配置速度（x；y；z；speed）



#### 2.2.2 NPC
a、npc调用。每段剧情的第一句会调用数个npc，需要配置这些npc的位置、朝向、动作（动作不配默认播放待机）

a-1、玩家的模型默认配置为-1。玩家的位置、朝向为-1时。默认保持触发前的动作朝向不变。

a-2、如果在发生剧情对话时，被调用的npc在需要调用位置较近，该npc会走到位置上。较远会直接刷新在需要的位置上，整段对话结束后会返回。如果npc的位置朝向为-1，则保持之前的动作朝向不变。

b、非剧情段第一句时，所有未配置的npc和其对应的参数都不做改变，默认播放待机。只改变配置的npc的参数。如果有新增npc则按第一句的逻辑加载。

c、说话npc：说话npc只影响对话上说话的npc名字显示。可配置多个npc同时说话



#### 2.2.3 文本
a、文本分为对话框文本 和选项框文本

b、对话框文本为主文本。在普通对话类型中为对话框中文本。在黑幕类型中为屏幕中间文本。文本需要可配置颜色。（有专门的表格控制不同情况下文本的出现速度，点击间隔等等参数）

c、选项文本可配置多个选项，每有一个配置增加一个选项。



#### 2.2.4 场景
a、配置场景id

a-1、如果配置的id和触发时玩家所在的地图id一致，则不切换场景

a-2、如果配置的场景非玩家当前所在的场景，则切换场景。并把对应的npc刷新出来。



#### 2.2.4 剧情id和后续切换
a、表头为合并单元格，所跨行数为同一段剧情

b、后续为对话id，需要配置每句对话后续会跳转的id，不可跨越剧情段

b-1、在有选项对话的时候，跳转id可配置多个对话id，不同的id可以跳转不同的后续剧情，不可跨越剧情段

c、需要可配置该段对话播放完毕后是否自动播放下一句。单句结束按配置的文本和动作都播放结束为节点，可以配置延迟多少秒才播放下一句。（下一句id；延迟秒数）

c-1、结束行，一段剧情结束后分2中表现方式。通过配置区分

黑幕，并直接回到剧情触发前的状态，并显示其他ui

镜头从当前位置，移动回到玩家身后的默认位置，然后显示其他界面ui。



#### 2.2.5 音效配置
a、bgm，配置bgm后，切换当前地图、或者前一句对话的bgm。

b、音效，直接播放需要的音效。

c、语音，直接播放需要的语音

d、玩家点击进入下一句时直接掐掉前一句的音频配置



### 2.3 文本动画效果
需要一个额外的表控制一些零散的表现效果  
a、文字播放显示速度，需要可配置每秒显示多少个字

b、播放间隔，玩家在通用的对话剧情中可以选择自动播放。需要可配置自动播放的间隔

c、双击间隔，剧情播放时 第一次点击显示所有文本，再点击切换下一个对话。这期间需要由点击间隔控制，防止过于快速的点击操作

d、如果需要bgm切换，控制渐变时间



### 2.4 小剧场
a、美术制作好的完整片段。在对话类型中配置对应的类型并配置对应的tmldi。直接切换播放



### 2.5 配置工具
剧情配置需要一定的辅助工具

辅助工具中调整的参数可以通过脚本直接生成到表格对应的字段中

#### 2.5.1 配置接口
需要一个专用的配置入口，进去后可以调用到具体的剧情段然后播放。读取正式配置中的场景、人物、对话和表演流程。

可停留在一个单句中，对其中的人物、镜头参数进行调整

策划会预先配置好剧情中需要调用的场景、人物、文本。其他流程需要在这个工具内调整

#### 2.5.2 镜头调整
镜头中心：需要在inspector中有选择本句对话的镜头中心是哪个人物或者模型id，显示本段剧情中配置的所有模型、npcid

镜头位置：inspector中有2种镜头位置配置（镜头位置和缓动镜头位置），可以分别选择调整哪个镜头。可以在单句表演内通过scene拖动剧情的镜头，inspector中读取对应的镜头参数。

转场类型：有选择菜单可以直接选择类型

#### 2.5.3 npc
npc选项中加载本句对话时所有的npc的调整选项，可以在scene中可以选择对某个npc的位置和角度进行调整，并将数值记录下来。

可选择npc调用的动作

需要一个z轴归零的按钮，保证在移动npc后npc可以正好站立在地面的碰撞体上

#### 2.5.4 流程控制
需要可选择此句文本是否自动播放下一句



### 2.6 不同调用情况流程预演
#### 2.6.1 功能场景不变触发剧情（比如：主城直接触发剧情）
直接触发，黑屏切换或者直接镜头移动都可以

#### 2.6.2 功能场景切换触发剧情（比如：通过关卡开始，进入关卡后触发的剧情）
选择关卡--进入关卡场景--触发剧情（尽量使用黑屏切换）--停留在战斗关卡--点击怪物进入战斗

#### 2.6.3 无功能场景剧情（比如：功能界面调用出的剧情）
尽量使用黑屏切换，结束后也通过黑屏结束。



## 三、界面说明
### 3.1 通用剧情界面
![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1724399838419-31e65d24-441a-4205-837e-6d580c368aea.png)

a、隐藏之前功能上的所有ui

b、最下方为剧情文本显示，包括当前说话的人物名字、剧情文本。下方有一个动态的点击提示

b-1、当说话的人物为玩家自己时，名字上显示为玩家的名字

c、右上角为跳过按钮，点击跳过整段剧情



### 3.2 选择向剧情
![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1724999065066-c53e7f81-7a2f-4903-b684-eeccc31de468.png)

a、选择向剧情中增加数个可点击的剧情对话选项，点击后跳转对应的后续文本

b、在自动播放的情况下默认选择第1个

c、选择剧情时，下面的主文本框下没有点击提示



### 3.3 旁白剧情
![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1724999158068-8f2a0fdd-6b67-4aa0-9b66-c4e25b44e16f.png)

a、旁白剧情·时，隐藏后面的npc和所有ui，只保留场景和跳过/自动播放按钮

b、有一个黑幕遮罩，上面直接显示文本。最下面是点击提示图标



## 四、配置表说明
### 4.1 剧情表
![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1724999351981-9bb609a0-26fc-41a6-a1a4-7b3419da26f9.png)



### 4.2 文本表现表![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1724999382137-9d1ebb85-8125-490f-a32f-7676a2075e0b.png)


## 五、功能需求清单






## 六、美术需求清单
### 6.1 界面需求
| **<font style="color:white;">编号</font>** | **<font style="color:white;">界面</font>** | **<font style="color:white;">性质</font>** |
| --- | --- | --- |
| 1 | 剧情界面 | 一级界面 |
| 2 | 选项剧情界面 | 一级界面 |
| 3 | 黑幕界面 | 一级界面 |






## 七、string需求


| **<font style="color:white;">类别</font>** | **<font style="color:white;">目标操作</font>** | **<font style="color:white;">触发条件</font>** | **<font style="color:white;">提示形式</font>** | **<font style="color:white;">提示string</font>** |
| :---: | :---: | :---: | :---: | :---: |
| | | | | |
| | | | | |










