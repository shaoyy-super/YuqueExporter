## 变更记录
> 记录每次修订的内容，方便追溯。
>

[此处为语雀卡片，点击链接查看](https://www.yuque.com/cod5mf/iwqppn/ds6eecnop09xnypg#FReK8)

Figma：[https://www.figma.com/design/2c1LfmuZHJ3PghpYq1Eywo/%E5%B1%B1%E6%B5%B7%E4%B8%96%E7%95%8C?node-id=39%3A332&t=tpjKQWYbn8rO4IVq-1](https://www.figma.com/design/2c1LfmuZHJ3PghpYq1Eywo/%E5%B1%B1%E6%B5%B7%E4%B8%96%E7%95%8C?node-id=39%3A332&t=tpjKQWYbn8rO4IVq-1)

## 1. 战斗系统简述
### 1.1 概述
1. 玩家可以在战斗前编辑自己的宠物编队，形成一个3宠物一队的战斗编队，然后进行战斗。
2. 战斗以回合制进行，3个宠物按编队顺序轮流上场进行车轮战。
3. 每个宠物拥有数个技能，战斗中技能需要花费一定的费用释放。
4. 每个回合有固定的费用上限，且随回合推进增加。单回合内玩家可在上限内选择性的释放技能。

### 1.2 参考对象
1. 炉石传说
2. Axie

### 1.3 思维导图
![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1714291977262-b1ea3f72-e11f-4dbb-b914-029cb83016fd.jpeg)

## 2. 战前编队系统
### 2.1 编队入口
主界面主功能按钮

### 2.2 阵容界面
#### ~~阵容主界面~~
![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1714297990707-26bb3ac5-aafc-4788-9b53-272ec2f70258.jpeg)

> 逻辑规则：
>

~~a、点击入口按钮后，跳转进入阵容编辑界面~~

~~b、上方左侧为返回按钮，点击后直接返回主界面；中间为功能名字~~

~~c、主区域左侧为队伍展示界面，按从左向右的顺序按玩家编辑的出场顺序依次排列展示3个宠物。~~

+ ~~宠物可以点击，点击后进入宠物的养成界面~~
+ ~~下方功能按钮从左到右依次为：删除当前配置、修改阵容、确认使用这套阵容~~

~~              点击删除当前配置时，会弹出二级弹窗让玩家确定确认删除~~

~~              如果当前阵容为玩家最后一套阵容，此按钮置灰，玩家点击后飘字提示玩家必须拥有一套可用的阵容~~

+ ~~宠物的展示可以直接用3d界面进行表现，宠物以正面的显示站立在场景中，并有基础的呼吸待机动作，随机间隔后，随机一个宠物会播放一次特殊动画（可以随机一个宠物其他系统中的任意动作，仅为表现展示）~~

~~d、主区域右侧为队伍列表，单个列表中包括：队伍名字、当前上阵阵容的标记、按出场顺序从左到右依次的宠物头像，以及后续可能需要的其他标记（待定）~~

+ ~~点击阵容列表中的任意列表，会切换左侧阵容的展示界面~~
+ ~~阵容列表可滑动，单页显示4行半，最下方显示一个带加号的空阵容，玩家点击后进入阵容编辑界面~~



#### 阵容编辑界面
![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1715664217437-cb6dd4d0-f702-40db-8b71-1a3e37233ad0.png)

a、入口分散在各个玩法的选择阵容步骤中。界面左上为返回按钮，中间为功能名字

b、界面下方为宠物列表，默认按战斗力排序，从左到右，可滑动。最左边有排序筛选按钮（筛选方式同养成界面）和跳转宠物养成界面的按钮。阵容选择完毕后点击右边的确认按钮确认。宠物上展示的信息和宠物养成界面保持一致。

c、点击宠物会上阵该宠物，被上阵的宠物会标记以上阵，并置灰排在队伍最后面。（每个功能可能会有对宠物本身的筛选，不能在此功能内使用的宠物不会显示在该列表中）

d、主区域为3个宠物栏位，分为：未上阵、已上阵两种状态。从左到右分别有1、2、3为上阵顺序

+ 未上阵：显示为一个半透明的加号按钮
+ 已上阵：显示宠物的造型，有基础的呼吸待机。再次点击会下阵该宠物
+ 玩家可以通过拖动，将一个宠物换到另外一个位置上，如果该位置有其他宠物，则两两调换。

e、最下方为确认按钮，点击确认进入战斗。每个功能在玩家确认后单独保存玩家上一次的阵容选择，第一次进入时为空。

+ 如果玩家在宠物数量小于3时点击确认按钮，则弹出二级界面，提示玩家无法创建阵容
+ 如果玩家用其他方式（bug或者强退）退出该界面，则不保存其改动



## 3. 战斗
### 3.1 战斗入口
根据不同功能具体需要制作

### 3.2 战斗基本规则
#### 1、出手顺序
a、单回合开始时，速度快的一方先出手

#### 2、发牌规则
a、每一回合开始时，根据玩家当前战斗的宠物的技能，把所有的技能卡依次发放到玩家的手牌区

b、回合结束时，回收所有手牌。

#### 3、费用规则
a、每回合游戏都有一定的总费用，使用技能会消耗费用。单回合结束时，未消耗的费用清零。（除特定技能外）

b、费用会随着回合数上涨，双方玩家都从1费开始。每个玩家每经过自己的一回合则增加1费

#### 4、出牌规则
a、玩家点选数张卡牌到屏幕指定的区域后，点选确定后结算卡牌的效果。

b、无论玩家使用了多少费用和技能，玩家都可以点击结束回合按钮结束回合

c、出牌阶段有一定的时间限制，到时后，会强制结束回合，并丢弃所有未使用的卡牌。已在出牌区域的卡牌会直接结算。

####  5、结算规则
a、根据玩家的编队顺序，宠物依次上场，宠物根据自己的属性有血量。血量为0时死亡

b、玩家的卡牌会依次结算，被攻击方的血量为0，则被攻击方替换下一只宠物。继续剩余结算

c、宠物死亡后自动替换下一只宠物。并完成当前回合

d、当一个玩家的所有宠物都为0时，战斗失败。

e、buff和debuff按回合计算，一回合消耗1层buff，buff在回合开始时结算，debuff在回合结束时计算

### 3.3 战斗表现逻辑
#### 战斗主界面预览
考虑到我们时3d游戏，可以参考宝可梦的战斗效果，宝可梦的战斗优先以局内的表现力度为主

![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1715664420452-3d95386c-82f8-46da-a8ca-18707b94d9a1.png)

![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1715664458994-85275129-a77a-4c8c-82a1-72e3e2503c3e.png)

![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1714993390393-2386cc42-daf8-41b5-ac97-6770b29b2049.jpeg)

整体战斗表现参考宝可梦剑盾

[bilibili](https://player.bilibili.com/player.html?bvid=BV1mV4y1C76D&p=1&page=1&autoplay=0)

#### 1、回合基本信息
a、界面顶端显示当前回合，双方各出手一次增加一个回合数。顶端左侧为投降按钮，玩家点击后出现二级弹窗，让玩家确认认输，认输按钮红色强提醒显示

b、回合数下方为单回合倒计时，倒计时结束后会强制结束玩家当前回合。当倒计时达到最后30s和最后10s时界面正中间会有较大的飘字提示，停留1s后消失。最后5s上方倒计时会变大，文字变红，随时间每过1s闪烁一次。需要根据战斗类型配置倒计时时间长度。

c、回合开始时，如果2边都有主角，则会先展示2个主角角色的位置，然后播放宠物出场动画（类似宝可梦）。如果一方为野生宠物，则有主角的一方播放出场，野生的一方直接在位置上待机。出场后镜头挪到战斗镜头位置。

d、每局开始时，速度快的一方先手，并提示开始回合

e、在玩家出牌阶段，玩家可以选择结束回合，在卡牌表演阶段，玩家可以选择跳过展示

f、回合数2侧位双方的待战宠物。数字标识位出场顺序，右下角位目前该宠物拥有的buff效果。按ui最终的ui大小确定排列数量。

f-1、宠物死亡后，头像置灰。位置1上的待战宠物上场，位置2的宠物移动到位置1上，死亡宠物显示在位置2上。位置2的宠物也上场时，待战宠物都死亡灰显。

![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1718681881305-5e26810f-5aa0-40f8-8da9-9b51b9ac1e75.png)



#### 2、宠物战斗区域
a、界面左下部分为友方宠物区域，如图所示展示友方宠物的造型。并在左下角有信息条，上面主要显示宠物的等级、名字和血量条。被攻击时血条会根据数值下降。血条右上方为buff显示位置，buff数字角标：左上为层数，右下为持续回合。血条左侧为护盾显示位置，随着护盾数值的增加，护盾的尺寸也会增加。当达到一个较高值时，允许超框。

b、以友方宠物所处位置向场景透视方向纵深，有2个宠物站立位，这里是展示的场下待上场的宠物，按出场顺序，左先右后。待战宠物会有基本的待机。

c、当主宠死亡，主宠会播放死亡动画并消失，待战宠物会进入主战宠物位置。之前的主战宠物会以半置灰的形式出现在待战的最后一个位置上，并保持死亡待机。

d、界面右上角为对方宠物，出战和待战逻辑同友方宠物

e、信息条右侧为自动战斗按钮，默认不自动，点击后为1倍速，再点击3倍速，再点击恢复。根据不同的战斗类型，记住玩家之前战斗结束时的选择，下次默认选中

f、当待战宠物和主战宠物有buff的时候，点击宠物头像或者buff图标会打开战斗buff信息界面。这里左侧展示宠物的立绘、等级、名字和品质。右侧展示宠物的技能和目前有的buff。点击空白处可关闭

f-1、单页技能展示6个半、buff展示4列半。数量大于时可左右滑动

![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1718681269041-c763d3a4-d42e-4d29-8ad8-2be86d06a952.png)

f-2、点击技能和buff图标后会替换左侧的例会变为技能和buff的详细信息展示。点击左侧详细展示可以切换立绘展示

![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1718681521126-4ba6523a-f800-417e-9611-c1b41f926b7e.png)

![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1718681535023-71d976ce-9386-4d84-94ff-65d27d78464f.png)





#### 3、卡牌区域
![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1715665110803-9f38829a-a8e2-4991-af3a-0173abfa9236.png)

a、右下区域为玩家手牌区域，手牌区域为固定大小，手牌数量多时会重叠排列。排列呈现一定的弧度，模拟手拿牌的既视感。点选卡牌会让该卡牌进入出牌区。在出牌区点选会回到手牌区

b、卡牌进入出牌区时。剩下手牌区的手牌会重置间隔排列逻辑。当卡牌又被选回手牌区时，会恢复之前的排列顺序。

c、出牌区会有一个出牌按钮，点击按钮，会进入出牌表演阶段，所出的牌会收纳到信息条右边，且该阶段会按顺序打出当前的卡牌

![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1715665207179-4d6e3dba-7bd3-4c26-8332-7cc6483c6c92.png)

d、如果玩家费用不够时，卡牌无法被点出手牌区，在玩家试图点击该手牌区时，费用展示的按钮红色闪烁提示，并弹出提示

#### 4、卡牌表现逻辑
![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1715665315758-335d73e7-f9eb-4eb9-b923-0a38ad0271d5.jpeg)

a、单张卡牌基本元素包括：费用、图画展示、卡牌名字、品质展示、技能描述

（这里主要体现卡片在战斗中的逻辑部分，卡牌本身需要跟着技能体系设计，这里不多做描述，只为方便理解）

b、当卡牌为buff类卡，玩家将卡牌选入出牌区时，会被buff的卡牌或者待战的宠物会有绿光增幅特效显示

c、当卡牌为debuff类卡，玩家将卡牌选入出牌区时，对手的宠物或者待战宠物会有红色降幅特效显示

e、当有本局常驻buff生效时，被生效的卡牌中对应的数字或者文本，如果被buff则一直显示buff后的数值并显示为绿色。如果被debuff，则一直显示debuff后的数值，并显示为红色。直到buff消失

f、如果该buff\debuff有小图标显示，则显示在宠物血条框的上方，层数用数字展示

#### 5、技能表现逻辑
a、技能被判定打出后，卡牌从玩家放开的位置，飞到屏幕中间，展示后消失。并会播放对应的技能表现，主要分为：攻击、弹道、受击。三个部分。默认情况依次播放，有特殊表演需要按照要求依次播放，可能出现3个部分播放节点互相交错的情况，可能需要动作或者特效上加事件帧。（逻辑上增益同受击）

b、攻击主要包括：宠物攻击动作、宠物攻击特效、宠物攻击特写等。可以根据根据技能的品级的要求，依次提升

| | 动作 | 特效 | 特写 | 运镜 |
| --- | --- | --- | --- | --- |
| 普通品质 | 普通攻击动作 | | | |
| 绿色品质 | 攻击动作 | 基础特效 | | |
| 蓝色品质 | 攻击动作 | 高级特效 | | |
| 紫色品质 | 攻击动作 | 高级特效 | 正面释放特写 | |
| 橙色品质 | 攻击动作 | 高级特效 | 正面释放特写 | 围绕宠物的运动镜头 |


c、弹道主要包括：弹道特效、特写等等。可以根据根据技能的品级的要求，依次提升

| | 特效 | 特写 |
| --- | --- | --- |
| 普通品质 | 无特效 | |
| 绿色品质 | 普通特效 |  |
| 蓝色品质 | 普通特效 |  |
| 紫色品质 | 高级特效 | 镜头特写 |
| 橙色品质 | 高级特效 | 镜头特写 |


弹道有一个起始点，需要根据模型上的固定点位释放对应的技能，一般有一个默认点用于默认悬挂所有技能。有特殊技能要求会额外增加，并可配置技能和起始点的对应关系，不配置则默认。

也有可能技能的有弹道特效但不需要起始点和受击点。这个要看具体情况具体分析。

d、受击主要包括：受击打动作、受击打特效、受击特写等等。可以根据根据技能打出的实际效果或者品级，依次提升

| | 动作 | 特效 | 特写 | 运镜 |
| --- | --- | --- | --- | --- |
| 普通品质 | 普通受击动作 | | | |
| 绿色品质 | 普通受击动作 | 基础特效 | | |
| 蓝色品质 | 受击动作 | 高级特效 | | |
| 紫色品质 | 受击动作 | 高级特效 | 受击特写 | |
| 橙色品质 | 受击动作 | 高级特效 | 受击特写 | 围绕受击效果的运动镜头 |


e、根据技能的种类表现上略有区分

| | 动作 | 弹道 | 受击 | 特写 | 运镜 |
| --- | --- | --- | --- | --- | --- |
| 单体目标 | 正常动作 | 单体弹道 | 单体受击 | 单个目标特效 | 单目标围绕运镜 |
| 群体目标 | 正常动作 | 被攻击目标群体弹道 | 被攻击目标群体受击 | 群体特写 | 群目标场景运镜 |


*当技能是针对场上场下所有目标时，需要根据技能，可能需要重新安排受击的3个宠物的镜头

#### 6、敌方回合
![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1715665681019-a9af9933-7128-434a-bd8b-0e52c168b7a9.png)

![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1715665699997-638b23aa-51d7-4274-b81c-5d211c091571.png)

a、玩家点击回合结束后，玩家手牌区卡牌消失，费用显示消失。然后界面中间出现对方回合飘字，镜头略微像对手拉伸，开始对手的回合，倒计时重置。

b、对方宠物位置显示思考中提示。

c、对方玩家打出技能牌也会显示在屏幕中央，步骤和循序同步。（同自己释放技能，但出发点和轨迹不同）

e、技能表现逻辑同自己释放，但对象和方向互换。表演阶段卡牌收纳位置在对方信息条下方

![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1715665806913-ad91bcbd-2091-415d-9b26-46089137c414.png)

f、对手结束回合，镜头复原，中间飘字提示进入自己的回合。

g、针对一些特殊关卡需要可以配置每个关卡的怪物数量和具体时哪些怪物。



### 3.4 战斗流程
a、战斗阶段\战斗开始

b、加载双方宠物属性、上阵顺序。主角信息

c、播放开战表演，表演流程固定（主角上场、召唤宠物等）

d、展示双方信息面板

e、计算开局前buff加成（结算双方3个宠物中所有对战斗全局、或者回合开始前的加成buff技能。速度快的一方优先结算。每场战斗只有第一回合前触发）

f、进入第一回合

g、结算开始回合时buff加成（当前出战双方宠物开局时结算的buff，速度快的一方优先结算）

h、比较当前战斗buff下双方当前出战宠物速度，速度快得一方优先回合

i、速度快的一方优先进行回合1，出现回合提示ui，出现倒计时。

j、计算实际费用（费用除本身随着回合增长，还受各种buff影响）

k、载入技能，计算收到buff影响的技能数值。发牌动画

m、玩家1释放技能流程

n、玩家点击确认后，进入技能释放表演。计算所有技能释放效果，然后依照顺序依次释放技能效果表演

n-1、一个技能释放时，优先判断技能类型，受目前回合前场上buff后的数值和效果，获取释放者和受击者数值信息

n-2、结算技能对宠物自身的临场效果（比如根据当时场面上的情况触发的效果）

n-3、结算技能对敌人的临场效果（比如根据当时场面上的情况触发的效果

n-4、执行伤害效果

n-5、扣除对方相应血量

n-6、判断是否进入死亡阶段，如果死亡进入死亡阶段判定n-10

n-7、未死亡，结算技能伤害后对宠物自身的效果

n-8、结算技能伤害后对敌人的效果

n-9、判断是否进入死亡阶段，如果死亡进入死亡阶段判定n-10

n-10、如果进入死亡阶段，结算死亡阶段buff

n-11、如果通过死亡判定，加载下一个宠物上场，并结算该宠物目前拥有的buff效果。如果所有宠物都死亡，直接跳至胜负判定阶段t

n-12、如果宠物1未死亡或者下一个宠物已上阵。释放下一个技能（镜像执行n这个流程）

o、检查玩家1的费用和手牌。如果玩家费用大于手牌中任意1张手牌的费用，则回到m流程。如果小于所有手牌的费用则回合结束

p、在m-o的流程中，如果玩家手动结束回合，则直接跳至结束回合流程

q、如果结束回合流程，结算回合结束时生效的buff效果

r、结算宠物状态和血量。如果有宠物血量归0，则替换下一只，所有都归0则进入胜负判定阶段t

s、进入对方回合，镜像执行上面整个回合

t、进入胜负判定阶段

u、宠物全部死亡的一方失败，另外一方获胜

v、弹出胜利失败界面









### 3.5 匹配机制（pvp）
待定

### 3.6 AI（pve）
pve战斗需要一套自动出牌的ai逻辑，适用所有pve的敌人和玩家自己的自动战斗。同时ai敌人也需要可以手动配置出牌顺序，以方便难度调整

a、ai基本规则

所有技能按类型分为攻击、回复、buff、debuff，每个技能都有自己的战斗力。在确定使用哪个类型的卡牌后，优先使用战斗力高的卡牌。

类别选取流程：（在选取时优先剔除所有费用超费的卡牌）

回复（血量低）>buff>debuff>战斗>回复（血量高）

*考虑到技能会不断增加，所以需要一个底层的保底逻辑，当上述方式找不到可用的卡牌时，优先使用战斗力高的卡牌

![画板](https://cdn.nlark.com/yuque/0/2024/jpeg/43733777/1714380663701-ae2a5294-1683-43ad-8161-a44fb0bc29c2.jpeg)



b、费用消耗完，或者不足以再释放任何技能时，结束回合

c、可配置的ai逻辑：需要针对怪物配置当他战斗时每一回合的战斗出牌顺序。有此配置时怪物会按配置出手，没有则按基本的ai逻辑出手

d、可配置ai也和自动ai一样，分出两种情况，分别对应血量高于30%和低于等于30%，两套配置。



## 4. 战斗结算
### 4.1战斗结算界面
a、当一方全部宠物血量归零或者一方投降时，战斗结束。

b、在播放完宠物死亡动画，或者飘字提示对手投降后。ui消失，界面压模糊遮罩，中间出现胜利失败页面

（界面中需要展示的项目根据具体比赛规则制定，默认只有一个胜利失败文字和头像展示）

c、结算背景：死亡失败，失败放所有宠物按死亡时的位置原位播放死亡动画。投降失败时，保留当前回合的位置、状态和动作

![](https://cdn.nlark.com/yuque/0/2024/png/43733777/1714444488113-2d993aec-6b47-44a1-9d49-c93d242535c5.png)



c、玩家点击后，进入奖励结算页面（待定）

### 4.2战斗奖励（待定）


## 5、战斗、技能数值
a、伤害计算公式

b、伤害类型（物伤、魔伤、恢复等等）

c、属性类型、属性克制（火、水、土、光、暗等等）

d、伤害频率（直伤、多段、Dot等等）

e、buff



## 6、表结构
战斗类型表（Battleinfo）

| <font style="color:black;">id</font> | <font style="color:black;">备注</font> | <font style="color:black;">战斗场景</font> | <font style="color:black;">回合限制</font> | <font style="color:black;">bgm</font> | <font style="color:black;">是否可以自动战斗</font> | <font style="color:black;">是否可以加速</font> | <font style="color:black;">是否可以跳过战斗阶段</font> | <font style="color:black;">ai战斗脚本</font> | <font style="color:black;">是否为pvp</font> | <font style="color:black;">倒计时上限</font> | <font style="color:black;">总费用上限</font> | <font style="color:black;">每回合费用增长值</font> | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| | | | | | | | | | | | | | |
| | | | | | | | | | | | | | |








<font style="background-color:#FADB14;"></font>





